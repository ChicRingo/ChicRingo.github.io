<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Go æ¯æ—¥ä¸€åº“ä¹‹ jobrunner | ChicRingoä¸ªäººåšå®¢</title>

<link rel="shortcut icon" href="https://ChicRingo.github.io/favicon.ico?v=1602400556049">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://ChicRingo.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            ChicRingoä¸ªäººåšå®¢
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            æ ‡ç­¾
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            å…³äº
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1602400556049" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Go æ¯æ—¥ä¸€åº“ä¹‹ jobrunner
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2020-09-03 Â·
                    </time>
                    
                </div>
                <div class="post-content">
                    <ol>
<li>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>æˆ‘ä»¬åœ¨ Web å¼€å‘ä¸­æ—¶å¸¸ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰§è¡Œä¸€ä¸ªæ“ä½œä¹‹åï¼Œéœ€è¦ç»™ç”¨æˆ·ä¸€å®šå½¢å¼çš„é€šçŸ¥ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ä¸‹å•ä¹‹åé€šè¿‡é‚®ä»¶å‘é€ç”µå­å‘ç¥¨ï¼Œç½‘ä¸Šè´­ç¥¨æ”¯ä»˜åé€šè¿‡çŸ­ä¿¡å‘é€è½¦æ¬¡ä¿¡æ¯ã€‚ä½†æ˜¯è¿™ç±»éœ€æ±‚å¹¶ä¸éœ€è¦éå¸¸åŠæ—¶ï¼Œå¦‚æœæ”¾åœ¨è¯·æ±‚æµç¨‹ä¸­å¤„ç†ï¼Œä¼šå½±å“è¯·æ±‚çš„å“åº”æ—¶é—´ã€‚è¿™ç±»ä»»åŠ¡æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥æ‰§è¡Œã€‚<code>jobrunner</code>å°±æ˜¯å…¶ä¸­ä¸€ä¸ªç”¨æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ Go è¯­è¨€åº“ã€‚å¾—ç›Šäºå¼ºå¤§çš„<code>cron</code>åº“ï¼Œå†æ­é…<code>jobrunner</code>çš„ä»»åŠ¡çŠ¶æ€ç›‘æ§ï¼Œ<code>jobrunner</code>éå¸¸æ˜“äºä½¿ç”¨ã€‚</p>
</li>
</ol>
<!-- more -->
<h2 id="å¿«é€Ÿä½¿ç”¨">å¿«é€Ÿä½¿ç”¨</h2>
<p>æœ¬æ–‡ä½¿ç”¨ Go Modulesã€‚</p>
<p>åˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ–ï¼š</p>
<pre><code>$ mkdir jobrunner &amp;&amp; cd jobrunner
$ go mod init github.com/darjun/go-daily-lib/jobrunner
</code></pre>
<p>å®‰è£…<code>jobrunner</code>ï¼š</p>
<pre><code>$ go get -u github.com/bamzi/jobrunner
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code>package main

import (
  &quot;fmt&quot;
  &quot;time&quot;

  &quot;github.com/bamzi/jobrunner&quot;
)

type GreetingJob struct {
  Name string
}

func (g GreetingJob) Run() {
  fmt.Println(&quot;Hello, &quot;, g.Name)
}

func main() {
  jobrunner.Start()
  jobrunner.Schedule(&quot;@every 5s&quot;, GreetingJob{Name: &quot;dj&quot;})

  time.Sleep(10 * time.Second)
}
</code></pre>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œæ¯éš” 5s æ‰“å°ä¸€æ¡æ¬¢è¿ä¿¡æ¯ã€‚ä»»åŠ¡çš„åˆ›å»ºå’Œæ‰§è¡Œä¸<code>cron</code>å®Œå…¨ç›¸åŒï¼Œè¯¦ç»†ä½¿ç”¨è§æˆ‘å‰é¢çš„ä¸€ç¯‡åšæ–‡ã€‚</p>
<p>æ³¨æ„ï¼Œ<code>jobrunner</code>éœ€è¦å…ˆ<code>Start()</code>ï¼Œç„¶åå†æ·»åŠ ä»»åŠ¡ã€‚å› ä¸ºåœ¨<code>Start()</code>ä¸­åˆ›å»º<code>MainCron</code>å¯¹è±¡ï¼Œå…ˆæ·»åŠ ä»»åŠ¡ä¼š<code>panic</code>ï¼ï¼ï¼</p>
<p>æ³¨æ„<code>main</code>å‡½æ•°å°¾çš„<code>time.Sleep(10 * time.Second)</code>ï¼Œå› ä¸ºä¸» goroutine ç»“æŸä¹‹åæ•´ä¸ªç¨‹åºå°±é€€å‡ºäº†ï¼Œ<code>jobrunner</code>ä¸­çš„ä»»åŠ¡å°±æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œäº†ã€‚åŠ ä¸Š<code>time.Sleep</code>æ˜¯ä¸ºäº†è®©å¤§å®¶èƒ½çœ‹åˆ°è¾“å‡ºï¼Œå®é™…ä½¿ç”¨ä¸­ä¸ä¼šè¿™æ ·åšã€‚</p>
<h2 id="ä¸-web-æ¡†æ¶æ•´åˆ">ä¸ web æ¡†æ¶æ•´åˆ</h2>
<p><code>jobrunner</code>èƒ½å¾ˆæ–¹ä¾¿åœ°ä¸å½“å‰å¸¸è§çš„ Web æ¡†æ¶æ•´åˆï¼Œå¦‚<code>Gin/Echo/Martini/Beego/Revel</code>ç­‰ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¼”ç¤ºå¦‚ä½•åœ¨ Gin ä¸­ä½¿ç”¨<code>jobrunner</code>ï¼šç”¨æˆ·ç™»å½•æ—¶ç»™ä»–çš„é‚®ç®±å‘é€ä¸€å°é‚®ä»¶ã€‚</p>
<p>é¦–å…ˆéœ€è¦å®‰è£…ç›¸åº”çš„åº“ï¼š</p>
<pre><code>$ go get -u github.com/gin-gonic/gin
$ github.com/jordan-wright/email
</code></pre>
<p>ç¼–å†™ä»£ç ï¼š</p>
<pre><code>package main

import (
  &quot;fmt&quot;
  &quot;net/smtp&quot;
  &quot;time&quot;

  &quot;github.com/bamzi/jobrunner&quot;
  &quot;github.com/gin-gonic/gin&quot;
  &quot;github.com/jordan-wright/email&quot;
)

type EmailJob struct {
  Name  string
  Email string
}

type User struct {
  Name  string `form:&quot;name&quot;`
  Email string `form:&quot;email&quot;`
}

func (j EmailJob) Run() {
  e := email.NewEmail()
  e.From = &quot;leedarjun@126.com&quot;
  e.To = []string{j.Email}
  e.Cc = []string{&quot;leedarjun@126.com&quot;}
  e.Subject = &quot;Welcome To Awesome-Web&quot;
  e.Text = []byte(fmt.Sprintf(`
  Hello, %s
  Welcome Back
  `, j.Name))

  err := e.Send(&quot;smtp.126.com:25&quot;, smtp.PlainAuth(&quot;&quot;, &quot;leedarjun@126.com&quot;, &quot;yyyyyy&quot;, &quot;smtp.126.com&quot;))
  if err != nil {
    fmt.Printf(&quot;failed to send email to %s, err:%v&quot;, j.Name, err)
  }
}

func login(c *gin.Context) {
  var u User
  if c.ShouldBind(&amp;u) == nil {
    c.String(200, &quot;login success&quot;)

    jobrunner.In(5*time.Second, EmailJob{Name: u.Name, Email: u.Email})
  } else {
    c.String(404, &quot;login failed&quot;)
  }
}

func main() {
  r := gin.Default()
  r.GET(&quot;/login&quot;, login)
  r.Run(&quot;:8888&quot;)
}
</code></pre>
<p>è¿™é‡Œåªæ˜¯ä¸ºäº†ç®€å•æ¼”ç¤ºï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç®€é™‹çš„<code>login</code>å‡½æ•°å¤„ç†ç™»å½•ï¼Œä¼ å…¥<code>name</code>å’Œ<code>email</code>ï¼Œç„¶åç»™è¯¥<code>email</code>å‘é€é‚®ä»¶ã€‚<code>email</code>åº“çš„è¯¦ç»†ä½¿ç”¨å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„åšæ–‡äº†è§£ã€‚</p>
<p>åªéœ€è¦åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>http://localhost:8888/login?name=dj&amp;email=935653229@qq.com</code>ï¼Œæˆ‘çš„ QQ é‚®ç®±å°±èƒ½æ”¶åˆ°é‚®ä»¶ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://mmbiz.qpic.cn/mmbiz_png/K8wfjf2LnNWiacxBicZx9GWLrWL3QCD5EFdk46hmzrPKRUwViakiad7HsW5wC2zVngb2rn0McfhNhoEG9q3lMyjmtQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" loading="lazy"></figure>
<h2 id="ç›‘æ§">ç›‘æ§</h2>
<p><code>jobrunner</code>å†…ç½®äº†ä¸€ä¸ªç›‘æ§æ¨¡å—ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é€šè¿‡ç½‘é¡µæˆ–è€… API è·å–å½“å‰çš„ä»»åŠ¡çŠ¶æ€æ•°æ®ï¼š</p>
<pre><code>package main

import (
  &quot;fmt&quot;
  &quot;html/template&quot;
  &quot;os&quot;
  &quot;time&quot;

  &quot;github.com/bamzi/jobrunner&quot;
  &quot;github.com/gin-gonic/gin&quot;
)

type GreetingJob struct {
  Name string
}

func (g GreetingJob) Run() {
  fmt.Println(&quot;Hello,&quot;, g.Name)
}

type EmailJob struct {
  Email string
}

func (e EmailJob) Run() {
  fmt.Println(&quot;Send,&quot;, e.Email)
}

func main() {
  r := gin.Default()

  jobrunner.Start()
  jobrunner.Every(5*time.Second, GreetingJob{Name: &quot;dj&quot;})
  jobrunner.Every(10*time.Second, EmailJob{Email: &quot;935653229@qq.com&quot;})

  r.GET(&quot;/jobrunner/json&quot;, JobJson)
  r.GET(&quot;/jobrunner/html&quot;, JobHtml)

  r.Run(&quot;:8888&quot;)
}

func JobJson(c *gin.Context) {
  c.JSON(200, jobrunner.StatusJson())
}

func JobHtml(c *gin.Context) {
  t, err := template.ParseFiles(os.Getenv(&quot;GOPATH&quot;) + &quot;/src/github.com/bamzi/jobrunner/views/Status.html&quot;)
  if err != nil {
    c.JSON(400, &quot;error&quot;)
  }
  t.Execute(c.Writer, jobrunner.StatusPage())
}
</code></pre>
<p>è¿è¡Œä¹‹åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>http://localhost:8888/jobrunner/html</code>æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://mmbiz.qpic.cn/mmbiz_png/K8wfjf2LnNWiacxBicZx9GWLrWL3QCD5EF2KYuh16uQkoqLkHok2cIH6oACuXYvLThnPaInUu2gicpg7N4a7A01pg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" loading="lazy"></figure>
<p>è¿™é‡Œæ˜¾ç¤ºä»»åŠ¡åã€ä»»åŠ¡ IDã€çŠ¶æ€ã€ä¸Šæ¬¡è¿è¡Œæ—¶é—´ã€ä¸‹æ¬¡è¿è¡Œæ—¶é—´ä»¥åŠå¤„ç†å»¶è¿Ÿã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>http://localhost:8888/jobrunner/json</code>è·å–åŸå§‹ JSON æ ¼å¼çš„æ•°æ®è‡ªå·±å¤„ç†ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://mmbiz.qpic.cn/mmbiz_png/K8wfjf2LnNWiacxBicZx9GWLrWL3QCD5EFMdLTUsC2a5kibeIj35PZOvmuVUMOhTpBow83yTBh7jdEUeRQsAiaQCxg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" loading="lazy"></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¤§å®¶å¦‚æœå‘ç°å¥½ç©ã€å¥½ç”¨çš„ Go è¯­è¨€åº“ï¼Œæ¬¢è¿åˆ° Go æ¯æ—¥ä¸€åº“ GitHub ä¸Šæäº¤ issueğŸ˜„</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ol>
<li>jobrunner GitHubï¼šhttps://github.com/bamzi/jobrunner</li>
<li>Go æ¯æ—¥ä¸€åº“ GitHubï¼šhttps://github.com/darjun/go-daily-lib</li>
</ol>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="https://ChicRingo.github.io/post/li-yong-go-fan-she-ji-zhi-shi-xian-pan-duan-slice-zhong-shi-fou-cun-zai-mou-ge-item/" class="post-title gt-a-link">
                    åˆ©ç”¨Goåå°„æœºåˆ¶å®ç°åˆ¤æ–­sliceä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªitem
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">æ¸©æ•…è€ŒçŸ¥æ–°</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://ChicRingo.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
