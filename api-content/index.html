{"posts":[{"title":"test","content":"func main() { t1 := T{1} //t2 := &amp;t1 //fmt.Printf(&quot;t2 is : %v\\n&quot;, t2) t1.testT() fmt.Printf(&quot;t2 is : %v\\n&quot;, t1) t1.testP() fmt.Printf(&quot;t2 is : %v\\n&quot;, t1) } func IsInSlice(value interface{}, sli interface{}) bool { switch reflect.TypeOf(sli).Kind() { case reflect.Slice, reflect.Array: s := reflect.ValueOf(sli) for i := 0; i &lt; s.Len(); i++ { if reflect.DeepEqual(value, s.Index(i).Interface()) { return true } } } return false } func worker(stopCh &lt;-chan struct{}) { go func() { defer fmt.Println(&quot;worker exit&quot;) // Using stop channel explicit exit for { select { case &lt;-stopCh: fmt.Println(&quot;Recv stop signal&quot;) return case &lt;-t.C: fmt.Println(&quot;Working .&quot;) } } }() return } ","link":"https://ChicRingo.github.io/post/test/"},{"title":"Go æ¯æ—¥ä¸€åº“ä¹‹ jobrunner","content":" ç®€ä»‹ æˆ‘ä»¬åœ¨ Web å¼€å‘ä¸­æ—¶å¸¸ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰§è¡Œä¸€ä¸ªæ“ä½œä¹‹åï¼Œéœ€è¦ç»™ç”¨æˆ·ä¸€å®šå½¢å¼çš„é€šçŸ¥ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ä¸‹å•ä¹‹åé€šè¿‡é‚®ä»¶å‘é€ç”µå­å‘ç¥¨ï¼Œç½‘ä¸Šè´­ç¥¨æ”¯ä»˜åé€šè¿‡çŸ­ä¿¡å‘é€è½¦æ¬¡ä¿¡æ¯ã€‚ä½†æ˜¯è¿™ç±»éœ€æ±‚å¹¶ä¸éœ€è¦éå¸¸åŠæ—¶ï¼Œå¦‚æœæ”¾åœ¨è¯·æ±‚æµç¨‹ä¸­å¤„ç†ï¼Œä¼šå½±å“è¯·æ±‚çš„å“åº”æ—¶é—´ã€‚è¿™ç±»ä»»åŠ¡æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥æ‰§è¡Œã€‚jobrunnerå°±æ˜¯å…¶ä¸­ä¸€ä¸ªç”¨æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ Go è¯­è¨€åº“ã€‚å¾—ç›Šäºå¼ºå¤§çš„cronåº“ï¼Œå†æ­é…jobrunnerçš„ä»»åŠ¡çŠ¶æ€ç›‘æ§ï¼Œjobrunneréå¸¸æ˜“äºä½¿ç”¨ã€‚ å¿«é€Ÿä½¿ç”¨ æœ¬æ–‡ä½¿ç”¨ Go Modulesã€‚ åˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ–ï¼š $ mkdir jobrunner &amp;&amp; cd jobrunner $ go mod init github.com/darjun/go-daily-lib/jobrunner å®‰è£…jobrunnerï¼š $ go get -u github.com/bamzi/jobrunner ä½¿ç”¨ï¼š package main import ( &quot;fmt&quot; &quot;time&quot; &quot;github.com/bamzi/jobrunner&quot; ) type GreetingJob struct { Name string } func (g GreetingJob) Run() { fmt.Println(&quot;Hello, &quot;, g.Name) } func main() { jobrunner.Start() jobrunner.Schedule(&quot;@every 5s&quot;, GreetingJob{Name: &quot;dj&quot;}) time.Sleep(10 * time.Second) } æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œæ¯éš” 5s æ‰“å°ä¸€æ¡æ¬¢è¿ä¿¡æ¯ã€‚ä»»åŠ¡çš„åˆ›å»ºå’Œæ‰§è¡Œä¸cronå®Œå…¨ç›¸åŒï¼Œè¯¦ç»†ä½¿ç”¨è§æˆ‘å‰é¢çš„ä¸€ç¯‡åšæ–‡ã€‚ æ³¨æ„ï¼Œjobrunneréœ€è¦å…ˆStart()ï¼Œç„¶åå†æ·»åŠ ä»»åŠ¡ã€‚å› ä¸ºåœ¨Start()ä¸­åˆ›å»ºMainCronå¯¹è±¡ï¼Œå…ˆæ·»åŠ ä»»åŠ¡ä¼španicï¼ï¼ï¼ æ³¨æ„mainå‡½æ•°å°¾çš„time.Sleep(10 * time.Second)ï¼Œå› ä¸ºä¸» goroutine ç»“æŸä¹‹åæ•´ä¸ªç¨‹åºå°±é€€å‡ºäº†ï¼Œjobrunnerä¸­çš„ä»»åŠ¡å°±æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œäº†ã€‚åŠ ä¸Štime.Sleepæ˜¯ä¸ºäº†è®©å¤§å®¶èƒ½çœ‹åˆ°è¾“å‡ºï¼Œå®é™…ä½¿ç”¨ä¸­ä¸ä¼šè¿™æ ·åšã€‚ ä¸ web æ¡†æ¶æ•´åˆ jobrunnerèƒ½å¾ˆæ–¹ä¾¿åœ°ä¸å½“å‰å¸¸è§çš„ Web æ¡†æ¶æ•´åˆï¼Œå¦‚Gin/Echo/Martini/Beego/Revelç­‰ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¼”ç¤ºå¦‚ä½•åœ¨ Gin ä¸­ä½¿ç”¨jobrunnerï¼šç”¨æˆ·ç™»å½•æ—¶ç»™ä»–çš„é‚®ç®±å‘é€ä¸€å°é‚®ä»¶ã€‚ é¦–å…ˆéœ€è¦å®‰è£…ç›¸åº”çš„åº“ï¼š $ go get -u github.com/gin-gonic/gin $ github.com/jordan-wright/email ç¼–å†™ä»£ç ï¼š package main import ( &quot;fmt&quot; &quot;net/smtp&quot; &quot;time&quot; &quot;github.com/bamzi/jobrunner&quot; &quot;github.com/gin-gonic/gin&quot; &quot;github.com/jordan-wright/email&quot; ) type EmailJob struct { Name string Email string } type User struct { Name string `form:&quot;name&quot;` Email string `form:&quot;email&quot;` } func (j EmailJob) Run() { e := email.NewEmail() e.From = &quot;leedarjun@126.com&quot; e.To = []string{j.Email} e.Cc = []string{&quot;leedarjun@126.com&quot;} e.Subject = &quot;Welcome To Awesome-Web&quot; e.Text = []byte(fmt.Sprintf(` Hello, %s Welcome Back `, j.Name)) err := e.Send(&quot;smtp.126.com:25&quot;, smtp.PlainAuth(&quot;&quot;, &quot;leedarjun@126.com&quot;, &quot;yyyyyy&quot;, &quot;smtp.126.com&quot;)) if err != nil { fmt.Printf(&quot;failed to send email to %s, err:%v&quot;, j.Name, err) } } func login(c *gin.Context) { var u User if c.ShouldBind(&amp;u) == nil { c.String(200, &quot;login success&quot;) jobrunner.In(5*time.Second, EmailJob{Name: u.Name, Email: u.Email}) } else { c.String(404, &quot;login failed&quot;) } } func main() { r := gin.Default() r.GET(&quot;/login&quot;, login) r.Run(&quot;:8888&quot;) } è¿™é‡Œåªæ˜¯ä¸ºäº†ç®€å•æ¼”ç¤ºï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç®€é™‹çš„loginå‡½æ•°å¤„ç†ç™»å½•ï¼Œä¼ å…¥nameå’Œemailï¼Œç„¶åç»™è¯¥emailå‘é€é‚®ä»¶ã€‚emailåº“çš„è¯¦ç»†ä½¿ç”¨å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„åšæ–‡äº†è§£ã€‚ åªéœ€è¦åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:8888/login?name=dj&amp;email=935653229@qq.comï¼Œæˆ‘çš„ QQ é‚®ç®±å°±èƒ½æ”¶åˆ°é‚®ä»¶ï¼š ç›‘æ§ jobrunnerå†…ç½®äº†ä¸€ä¸ªç›‘æ§æ¨¡å—ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é€šè¿‡ç½‘é¡µæˆ–è€… API è·å–å½“å‰çš„ä»»åŠ¡çŠ¶æ€æ•°æ®ï¼š package main import ( &quot;fmt&quot; &quot;html/template&quot; &quot;os&quot; &quot;time&quot; &quot;github.com/bamzi/jobrunner&quot; &quot;github.com/gin-gonic/gin&quot; ) type GreetingJob struct { Name string } func (g GreetingJob) Run() { fmt.Println(&quot;Hello,&quot;, g.Name) } type EmailJob struct { Email string } func (e EmailJob) Run() { fmt.Println(&quot;Send,&quot;, e.Email) } func main() { r := gin.Default() jobrunner.Start() jobrunner.Every(5*time.Second, GreetingJob{Name: &quot;dj&quot;}) jobrunner.Every(10*time.Second, EmailJob{Email: &quot;935653229@qq.com&quot;}) r.GET(&quot;/jobrunner/json&quot;, JobJson) r.GET(&quot;/jobrunner/html&quot;, JobHtml) r.Run(&quot;:8888&quot;) } func JobJson(c *gin.Context) { c.JSON(200, jobrunner.StatusJson()) } func JobHtml(c *gin.Context) { t, err := template.ParseFiles(os.Getenv(&quot;GOPATH&quot;) + &quot;/src/github.com/bamzi/jobrunner/views/Status.html&quot;) if err != nil { c.JSON(400, &quot;error&quot;) } t.Execute(c.Writer, jobrunner.StatusPage()) } è¿è¡Œä¹‹åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:8888/jobrunner/htmlæŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼š è¿™é‡Œæ˜¾ç¤ºä»»åŠ¡åã€ä»»åŠ¡ IDã€çŠ¶æ€ã€ä¸Šæ¬¡è¿è¡Œæ—¶é—´ã€ä¸‹æ¬¡è¿è¡Œæ—¶é—´ä»¥åŠå¤„ç†å»¶è¿Ÿã€‚ æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡http://localhost:8888/jobrunner/jsonè·å–åŸå§‹ JSON æ ¼å¼çš„æ•°æ®è‡ªå·±å¤„ç†ï¼š æ€»ç»“ å¤§å®¶å¦‚æœå‘ç°å¥½ç©ã€å¥½ç”¨çš„ Go è¯­è¨€åº“ï¼Œæ¬¢è¿åˆ° Go æ¯æ—¥ä¸€åº“ GitHub ä¸Šæäº¤ issueğŸ˜„ å‚è€ƒ jobrunner GitHubï¼šhttps://github.com/bamzi/jobrunner Go æ¯æ—¥ä¸€åº“ GitHubï¼šhttps://github.com/darjun/go-daily-lib ","link":"https://ChicRingo.github.io/post/go-mei-ri-yi-ku-zhi-jobrunner/"},{"title":"åˆ©ç”¨Goåå°„æœºåˆ¶å®ç°åˆ¤æ–­sliceä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªitem","content":"ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°éœ€è¦åˆ¤æ–­æŸä¸ª slice(æˆ–è€… array)ä¸­æ˜¯å¦åŒ…å«æŸä¸ª item çš„æƒ…å†µï¼Œæ¯”å¦‚åˆ¤æ–­ 10 æ˜¯å¦åœ¨[]int{1,2,3}ä¸­ æ€ä¹ˆåšï¼Ÿ ä¸€èˆ¬æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•æ˜¯éå† slice ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°äº†è¯¥å…ƒç´ ï¼Œå¦åˆ™è¿”å› falseï¼Œå¦‚ä¸‹ï¼š package main func IsInSlice(value int, sli []int) bool { for _, v := range sli { if value == v { return true } } return false } è¿™ç§æ–¹æ³•å®ç°ç•¥æ˜¾ç¬¨æ‹™ï¼Œå¹¶ä¸”é’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹æ— æ³•é€šç”¨ï¼Œå¦‚æœæœ‰ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œåˆ™å®¹æ˜“ç”Ÿæˆå¾ˆå¤šç›¸åŒåŠŸèƒ½çš„å‡½æ•°ï¼Œåªæ˜¯å‚æ•°ä¸åŒï¼Œè¿™æ ·çš„è¯ä»£ç å¯ç”¨æ€§å¹¶ä¸é«˜ã€‚ å¦‚ä½•æ”¹è¿› golang ä¸­å¯ä»¥é€šè¿‡ reflect åŒ…ä¸­çš„ TypeOf(), ValueOf()å’Œ DeepEqual()æ¥å£å¯¹æ–¹æ³•è¿›è¡Œæ”¹è¿›ï¼Œæ–¹æ³•å‚æ•°ä½¿ç”¨ interface{}ç±»å‹ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š package main import &quot;reflect&quot; func IsInSlice(value interface{}, sli interface{}) bool { switch reflect.TypeOf(sli).Kind() { case reflect.Slice, reflect.Array: s := reflect.ValueOf(sli) for i := 0; i &lt; s.Len(); i++ { if reflect.DeepEqual(value, s.Index(i).Interface()) { return true } } } return false } ç¬é—´ä¸ç”¨å†ä¸ºä¸åŒæ•°æ®ç±»å‹éœ€è¦å†™ä¸åŒå‡½æ•°è€Œå¿ƒçƒ¦äº†ï¼ æç¤º å› ä¸ºåå°„éœ€è¦çš„æ—¶é—´å¼€é”€æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥é€šç”¨å†™æ³•çš„æ•ˆç‡è‚¯å®šæ¯”ç‰¹å®šç±»å‹çš„å†™æ³•ä½ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥æƒè¡¡ä½¿ç”¨ï¼Œå¦‚ä¸‹æˆªå›¾ä¸º int ç±»å‹çš„åŸºå‡†æµ‹è¯•ï¼š åŸæ–‡ä½œè€…ï¼špyihe åŸæ–‡é“¾æ¥ï¼šhttps://pyihe.github.io/2020/05/29/Golang%E5%88%A4%E6%96%ADslice%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%9F%90%E4%B8%AAitem.html ","link":"https://ChicRingo.github.io/post/li-yong-go-fan-she-ji-zhi-shi-xian-pan-duan-slice-zhong-shi-fou-cun-zai-mou-ge-item/"},{"title":"ä½¿ç”¨Goå®ç°GoFçš„23ç§è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰","content":"ä½œè€…ï¼šå…ƒé—°å­ é“¾æ¥ï¼šhttps://juejin.im/post/6864011017384132621 æ¥æºï¼šæ˜é‡‘ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ å‰è¨€ ä¸Šä¸€ç¯‡æ–‡ç« ã€Šä½¿ç”¨Goå®ç°GoFçš„23ç§è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰ã€‹ä»‹ç»äº†23ç§è®¾è®¡æ¨¡å¼ä¸­çš„åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternï¼‰ï¼Œåˆ›å»ºå‹æ¨¡å¼æ˜¯å¤„ç†å¯¹è±¡åˆ›å»ºçš„ä¸€ç±»è®¾è®¡æ¨¡å¼ï¼Œä¸»è¦æ€æƒ³æ˜¯å‘å¯¹è±¡çš„ä½¿ç”¨è€…éšè—å¯¹è±¡åˆ›å»ºçš„å…·ä½“ç»†èŠ‚ï¼Œä»è€Œè¾¾åˆ°è§£è€¦çš„ç›®çš„ã€‚æœ¬æ–‡ä¸»è¦èšç„¦åœ¨ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternï¼‰ä¸Šï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯å°†å¤šä¸ªå¯¹è±¡ç»„è£…æˆè¾ƒå¤§çš„ç»“æ„ï¼Œå¹¶åŒæ—¶ä¿æŒç»“æ„çš„çµæ´»å’Œé«˜æ•ˆï¼Œä»ç¨‹åºçš„ç»“æ„ä¸Šè§£å†³æ¨¡å—ä¹‹é—´çš„è€¦åˆé—®é¢˜ã€‚ ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰ ç®€è¿° åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªå¸¸è§çš„å¯¹è±¡è®¾è®¡æ–¹æ³•ï¼Œç»„åˆå’Œç»§æ‰¿ï¼Œä¸¤è€…éƒ½å¯ä»¥è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨åè€…æ—¶å®¹æ˜“å‡ºç°ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ï¼Œå¯¹è±¡å…³ç³»è¿‡äºå¤æ‚çš„å‰¯ä½œç”¨ï¼Œä»è€Œå¯¼è‡´ä»£ç çš„å¯ç»´æŠ¤æ€§å˜å·®ã€‚å› æ­¤ï¼Œä¸€ä¸ªç»å…¸çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™æ˜¯ï¼šç»„åˆä¼˜äºç»§æ‰¿ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç»„åˆæ‰€è¡¨ç¤ºçš„è¯­ä¹‰ä¸ºâ€œhas-aâ€ï¼Œä¹Ÿå°±æ˜¯éƒ¨åˆ†å’Œæ•´ä½“çš„å…³ç³»ï¼Œæœ€ç»å…¸çš„ç»„åˆæ¨¡å¼æè¿°å¦‚ä¸‹ï¼š å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚ Goè¯­è¨€å¤©ç„¶å°±æ”¯æŒäº†ç»„åˆæ¨¡å¼ï¼Œè€Œä¸”ä»å®ƒä¸æ”¯æŒç»§æ‰¿å…³ç³»çš„ç‰¹ç‚¹æ¥çœ‹ï¼ŒGoä¹Ÿå¥‰è¡Œäº†ç»„åˆä¼˜äºç»§æ‰¿çš„åŸåˆ™ï¼Œé¼“åŠ±å¤§å®¶åœ¨è¿›è¡Œç¨‹åºè®¾è®¡æ—¶å¤šé‡‡ç”¨ç»„åˆçš„æ–¹æ³•ã€‚Goå®ç°ç»„åˆæ¨¡å¼çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ç›´æ¥ç»„åˆï¼ˆDirect Compositionï¼‰å’ŒåµŒå…¥ç»„åˆï¼ˆEmbedding Compositionï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¢è®¨è¿™ä¸¤ç§ä¸åŒçš„å®ç°æ–¹æ³•ã€‚ Goå®ç° ç›´æ¥ç»„åˆï¼ˆDirect Compositionï¼‰çš„å®ç°æ–¹å¼ç±»ä¼¼äºJava/C++ï¼Œå°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å±æ€§ã€‚ ä¸€ä¸ªå…¸å‹çš„å®ç°å¦‚ã€Šä½¿ç”¨Goå®ç°GoFçš„23ç§è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰ã€‹ä¸­æ‰€ä¸¾çš„ä¾‹å­ï¼Œä¸€ä¸ªMessageç»“æ„ä½“ï¼Œç”±Headerå’ŒBodyæ‰€ç»„æˆã€‚é‚£ä¹ˆMessageå°±æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œè€ŒHeaderå’ŒBodyåˆ™ä¸ºæ¶ˆæ¯çš„ç»„æˆéƒ¨åˆ†ã€‚ type Message struct { Header *Header Body *Body } å¤åˆ¶ä»£ç  ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼ŒåŒæ ·è€ƒè™‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€æè¿°çš„æ’ä»¶æ¶æ„é£æ ¼çš„æ¶ˆæ¯å¤„ç†ç³»ç»Ÿã€‚å‰é¢æˆ‘ä»¬ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼è§£å†³äº†æ’ä»¶åŠ è½½çš„é—®é¢˜ï¼Œé€šå¸¸ï¼Œæ¯ä¸ªæ’ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå¸¸è§çš„å°±æ˜¯å¯åŠ¨çŠ¶æ€å’Œåœæ­¢çŠ¶æ€ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨ç»„åˆæ¨¡å¼æ¥è§£å†³æ’ä»¶çš„å¯åŠ¨å’Œåœæ­¢é—®é¢˜ã€‚ é¦–å…ˆç»™Pluginæ¥å£æ·»åŠ å‡ ä¸ªç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•ï¼š package plugin ... // æ’ä»¶è¿è¡ŒçŠ¶æ€ type Status uint8 const ( Stopped Status = iota Started ) type Plugin interface { // å¯åŠ¨æ’ä»¶ Start() // åœæ­¢æ’ä»¶ Stop() // è¿”å›æ’ä»¶å½“å‰çš„è¿è¡ŒçŠ¶æ€ Status() Status } // Inputã€Filterã€Outputä¸‰ç±»æ’ä»¶æ¥å£çš„å®šä¹‰è·Ÿä¸Šä¸€ç¯‡æ–‡ç« ç±»ä¼¼ // è¿™é‡Œä½¿ç”¨Messageç»“æ„ä½“æ›¿ä»£äº†åŸæ¥çš„stringï¼Œä½¿å¾—è¯­ä¹‰æ›´æ¸…æ™° type Input interface { Plugin Receive() *msg.Message } type Filter interface { Plugin Process(msg *msg.Message) *msg.Message } type Output interface { Plugin Send(msg *msg.Message) } å¤åˆ¶ä»£ç  å¯¹äºæ’ä»¶åŒ–çš„æ¶ˆæ¯å¤„ç†ç³»ç»Ÿè€Œè¨€ï¼Œä¸€åˆ‡çš†æ˜¯æ’ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å°†Pipeineä¹Ÿè®¾è®¡æˆä¸€ä¸ªæ’ä»¶ï¼Œå®ç°Pluginæ¥å£ï¼š package pipeline ... // ä¸€ä¸ªPipelineç”±inputã€filterã€outputä¸‰ä¸ªPluginç»„æˆ type Pipeline struct { status plugin.Status input plugin.Input filter plugin.Filter output plugin.Output } func (p *Pipeline) Exec() { msg := p.input.Receive() msg = p.filter.Process(msg) p.output.Send(msg) } // å¯åŠ¨çš„é¡ºåº output -&gt; filter -&gt; input func (p *Pipeline) Start() { p.output.Start() p.filter.Start() p.input.Start() p.status = plugin.Started fmt.Println(&quot;Hello input plugin started.&quot;) } // åœæ­¢çš„é¡ºåº input -&gt; filter -&gt; output func (p *Pipeline) Stop() { p.input.Stop() p.filter.Stop() p.output.Stop() p.status = plugin.Stopped fmt.Println(&quot;Hello input plugin stopped.&quot;) } func (p *Pipeline) Status() plugin.Status { return p.status } å¤åˆ¶ä»£ç  ä¸€ä¸ªPipelineç”±Inputã€Filterã€Outputä¸‰ç±»æ’ä»¶ç»„æˆï¼Œå½¢æˆäº†â€œéƒ¨åˆ†-æ•´ä½“â€çš„å…³ç³»ï¼Œè€Œä¸”å®ƒä»¬éƒ½å®ç°äº†Pluginæ¥å£ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç»„åˆæ¨¡å¼çš„å®ç°ã€‚Clientæ— éœ€æ˜¾å¼åœ°å¯åŠ¨å’Œåœæ­¢Inputã€Filterå’ŒOutputæ’ä»¶ï¼Œåœ¨è°ƒç”¨Pipelineå¯¹è±¡çš„Startå’ŒStopæ–¹æ³•æ—¶ï¼ŒPipelineå°±å·²ç»å¸®ä½ æŒ‰é¡ºåºå®Œæˆå¯¹åº”æ’ä»¶çš„å¯åŠ¨å’Œåœæ­¢ã€‚ ç›¸æ¯”äºä¸Šä¸€ç¯‡æ–‡ç« ï¼Œåœ¨æœ¬æ–‡ä¸­å®ç°Inputã€Filterã€Outputä¸‰ç±»æ’ä»¶æ—¶ï¼Œéœ€è¦å¤šå®ç°3ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ã€‚è¿˜æ˜¯ä»¥ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„HelloInputã€UpperFilterå’ŒConsoleOutputä½œä¸ºä¾‹å­ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š package plugin ... type HelloInput struct { status Status } func (h *HelloInput) Receive() *msg.Message { // å¦‚æœæ’ä»¶æœªå¯åŠ¨ï¼Œåˆ™è¿”å›nil if h.status != Started { fmt.Println(&quot;Hello input plugin is not running, input nothing.&quot;) return nil } return msg.Builder(). WithHeaderItem(&quot;content&quot;, &quot;text&quot;). WithBodyItem(&quot;Hello World&quot;). Build() } func (h *HelloInput) Start() { h.status = Started fmt.Println(&quot;Hello input plugin started.&quot;) } func (h *HelloInput) Stop() { h.status = Stopped fmt.Println(&quot;Hello input plugin stopped.&quot;) } func (h *HelloInput) Status() Status { return h.status } å¤åˆ¶ä»£ç  package plugin ... type UpperFilter struct { status Status } func (u *UpperFilter) Process(msg *msg.Message) *msg.Message { if u.status != Started { fmt.Println(&quot;Upper filter plugin is not running, filter nothing.&quot;) return msg } for i, val := range msg.Body.Items { msg.Body.Items[i] = strings.ToUpper(val) } return msg } func (u *UpperFilter) Start() { u.status = Started fmt.Println(&quot;Upper filter plugin started.&quot;) } func (u *UpperFilter) Stop() { u.status = Stopped fmt.Println(&quot;Upper filter plugin stopped.&quot;) } func (u *UpperFilter) Status() Status { return u.status } å¤åˆ¶ä»£ç  package plugin ... type ConsoleOutput struct { status Status } func (c *ConsoleOutput) Send(msg *msg.Message) { if c.status != Started { fmt.Println(&quot;Console output is not running, output nothing.&quot;) return } fmt.Printf(&quot;Output:\\n\\tHeader:%+v, Body:%+v\\n&quot;, msg.Header.Items, msg.Body.Items) } func (c *ConsoleOutput) Start() { c.status = Started fmt.Println(&quot;Console output plugin started.&quot;) } func (c *ConsoleOutput) Stop() { c.status = Stopped fmt.Println(&quot;Console output plugin stopped.&quot;) } func (c *ConsoleOutput) Status() Status { return c.status } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestPipeline(t *testing.T) { p := pipeline.Of(pipeline.DefaultConfig()) p.Start() p.Exec() p.Stop() } // è¿è¡Œç»“æœ === RUN TestPipeline Console output plugin started. Upper filter plugin started. Hello input plugin started. Pipeline started. Output: Header:map[content:text], Body:[HELLO WORLD] Hello input plugin stopped. Upper filter plugin stopped. Console output plugin stopped. Hello input plugin stopped. --- PASS: TestPipeline (0.00s) PASS å¤åˆ¶ä»£ç  ç»„åˆæ¨¡å¼çš„å¦ä¸€ç§å®ç°ï¼ŒåµŒå…¥ç»„åˆï¼ˆEmbedding Compositionï¼‰ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº†Goè¯­è¨€çš„åŒ¿åæˆå‘˜ç‰¹æ€§ï¼Œæœ¬è´¨ä¸Šè·Ÿç›´æ¥ç»„åˆæ˜¯ä¸€è‡´çš„ã€‚ è¿˜æ˜¯ä»¥Messageç»“æ„ä½“ä¸ºä¾‹ï¼Œå¦‚æœé‡‡ç”¨åµŒå…¥ç»„åˆï¼Œåˆ™çœ‹èµ·æ¥åƒæ˜¯è¿™æ ·ï¼š type Message struct { Header Body } // ä½¿ç”¨æ—¶ï¼ŒMessageå¯ä»¥å¼•ç”¨Headerå’ŒBodyçš„æˆå‘˜å±æ€§ï¼Œä¾‹å¦‚ï¼š msg := &amp;Message{} msg.SrcAddr = &quot;192.168.0.1&quot; å¤åˆ¶ä»£ç  é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰ ç®€è¿° é€‚é…å™¨æ¨¡å¼æ˜¯æœ€å¸¸ç”¨çš„ç»“æ„å‹æ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒè®©åŸæœ¬å› ä¸ºæ¥å£ä¸åŒ¹é…è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªå¯¹è±¡èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œé€‚é…å™¨æ¨¡å¼ä¹Ÿæ˜¯å¤„å¤„å¯è§ï¼Œæ¯”å¦‚ç”µæºæ’å¤´è½¬æ¢å™¨ï¼Œå¯ä»¥è®©è‹±å¼çš„æ’å¤´å·¥ä½œåœ¨ä¸­å¼çš„æ’åº§ä¸Šã€‚é€‚é…å™¨æ¨¡å¼æ‰€åšçš„å°±æ˜¯å°†ä¸€ä¸ªæ¥å£Adapteeï¼Œé€šè¿‡é€‚é…å™¨Adapterè½¬æ¢æˆClientæ‰€æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£Targetæ¥ä½¿ç”¨ï¼Œå®ç°åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯Adapteré€šè¿‡å®ç°Targetæ¥å£ï¼Œå¹¶åœ¨å¯¹åº”çš„æ–¹æ³•ä¸­è°ƒç”¨Adapteeçš„æ¥å£å®ç°ã€‚ ä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œç³»ç»Ÿä¸­ä¸€ä¸ªè€çš„æ¥å£å·²ç»è¿‡æ—¶å³å°†åºŸå¼ƒï¼Œä½†å› ä¸ºå†å²åŒ…è¢±æ²¡æ³•ç«‹å³å°†è€æ¥å£å…¨éƒ¨æ›¿æ¢ä¸ºæ–°æ¥å£ï¼Œè¿™æ—¶å¯ä»¥æ–°å¢ä¸€ä¸ªé€‚é…å™¨ï¼Œå°†è€çš„æ¥å£é€‚é…æˆæ–°çš„æ¥å£æ¥ä½¿ç”¨ã€‚é€‚é…å™¨æ¨¡å¼å¾ˆå¥½çš„è·µè¡Œäº†é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™é‡Œçš„å¼€é—­åŸåˆ™ï¼ˆopen/closed principleï¼‰ï¼Œæ–°å¢ä¸€ä¸ªæ¥å£æ—¶ä¹Ÿæ— éœ€ä¿®æ”¹è€æ¥å£ï¼Œåªéœ€å¤šåŠ ä¸€ä¸ªé€‚é…å±‚å³å¯ã€‚ Goå®ç° ç»§ç»­è€ƒè™‘ä¸Šä¸€èŠ‚çš„æ¶ˆæ¯å¤„ç†ç³»ç»Ÿä¾‹å­ï¼Œç›®å‰ä¸ºæ­¢ï¼Œç³»ç»Ÿçš„è¾“å…¥éƒ½æºè‡ªäºHelloInputï¼Œç°åœ¨å‡è®¾éœ€è¦ç»™ç³»ç»Ÿæ–°å¢ä»Kafkaæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¥æ”¶æ•°æ®çš„åŠŸèƒ½ï¼Œå…¶ä¸­Kafkaæ¶ˆè´¹è€…çš„æ¥å£å¦‚ä¸‹ï¼š package kafka ... type Records struct { Items []string } type Consumer interface { Poll() Records } å¤åˆ¶ä»£ç  ç”±äºå½“å‰Pipelineçš„è®¾è®¡æ˜¯é€šè¿‡plugin.Inputæ¥å£æ¥è¿›è¡Œæ•°æ®æ¥æ”¶ï¼Œå› æ­¤kafka.Consumerå¹¶ä¸èƒ½ç›´æ¥é›†æˆåˆ°ç³»ç»Ÿä¸­ã€‚ æ€ä¹ˆåŠï¼Ÿä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼ ä¸ºäº†èƒ½è®©Pipelineèƒ½å¤Ÿä½¿ç”¨kafka.Consumeræ¥å£ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªé€‚é…å™¨å¦‚ä¸‹ï¼š package plugin ... type KafkaInput struct { status Status consumer kafka.Consumer } func (k *KafkaInput) Receive() *msg.Message { records := k.consumer.Poll() if k.status != Started { fmt.Println(&quot;Kafka input plugin is not running, input nothing.&quot;) return nil } return msg.Builder(). WithHeaderItem(&quot;content&quot;, &quot;kafka&quot;). WithBodyItems(records.Items). Build() } // åœ¨è¾“å…¥æ’ä»¶æ˜ å°„å…³ç³»ä¸­åŠ å…¥kafkaï¼Œç”¨äºé€šè¿‡åå°„åˆ›å»ºinputå¯¹è±¡ func init() { inputNames[&quot;hello&quot;] = reflect.TypeOf(HelloInput{}) inputNames[&quot;kafka&quot;] = reflect.TypeOf(KafkaInput{}) } ... å¤åˆ¶ä»£ç  å› ä¸ºGoè¯­è¨€å¹¶æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œå¦‚æœæŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºKafkaInputï¼Œé‚£ä¹ˆå¾—åˆ°çš„å®ä¾‹ä¸­çš„consumeræˆå‘˜å› ä¸ºæ²¡æœ‰è¢«åˆå§‹åŒ–è€Œä¼šæ˜¯nilã€‚å› æ­¤ï¼Œéœ€è¦ç»™Pluginæ¥å£æ–°å¢ä¸€ä¸ªInitæ–¹æ³•ï¼Œç”¨äºå®šä¹‰æ’ä»¶çš„ä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¹¶åœ¨å·¥å‚è¿”å›å®ä¾‹å‰è°ƒç”¨ã€‚ package plugin ... type Plugin interface { Start() Stop() Status() Status // æ–°å¢åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨æ’ä»¶å·¥å‚è¿”å›å®ä¾‹å‰è°ƒç”¨ Init() } // ä¿®æ”¹åçš„æ’ä»¶å·¥å‚å®ç°å¦‚ä¸‹ func (i *InputFactory) Create(conf Config) Plugin { t, _ := inputNames[conf.Name] p := reflect.New(t).Interface().(Plugin) // è¿”å›æ’ä»¶å®ä¾‹å‰è°ƒç”¨Initå‡½æ•°ï¼Œå®Œæˆç›¸å…³åˆå§‹åŒ–æ–¹æ³• p.Init() return p } // KakkaInputçš„Initå‡½æ•°å®ç° func (k *KafkaInput) Init() { k.consumer = &amp;kafka.MockConsumer{} } å¤åˆ¶ä»£ç  ä¸Šè¿°ä»£ç ä¸­çš„kafka.MockConsumerä¸ºæˆ‘ä»¬æ¨¡å¼Kafkaæ¶ˆè´¹è€…çš„ä¸€ä¸ªå®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š package kafka ... type MockConsumer struct {} func (m *MockConsumer) Poll() *Records { records := &amp;Records{} records.Items = append(records.Items, &quot;i am mock consumer.&quot;) return records } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestKafkaInputPipeline(t *testing.T) { config := pipeline.Config{ Name: &quot;pipeline2&quot;, Input: plugin.Config{ PluginType: plugin.InputType, Name: &quot;kafka&quot;, }, Filter: plugin.Config{ PluginType: plugin.FilterType, Name: &quot;upper&quot;, }, Output: plugin.Config{ PluginType: plugin.OutputType, Name: &quot;console&quot;, }, } p := pipeline.Of(config) p.Start() p.Exec() p.Stop() } // è¿è¡Œç»“æœ === RUN TestKafkaInputPipeline Console output plugin started. Upper filter plugin started. Kafka input plugin started. Pipeline started. Output: Header:map[content:kafka], Body:[I AM MOCK CONSUMER.] Kafka input plugin stopped. Upper filter plugin stopped. Console output plugin stopped. Pipeline stopped. --- PASS: TestKafkaInputPipeline (0.00s) PASS å¤åˆ¶ä»£ç  æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰ ç®€è¿° æ¡¥æ¥æ¨¡å¼ä¸»è¦ç”¨äºå°†æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†è¿›è¡Œè§£è€¦ï¼Œä½¿å¾—å®ƒä»¬èƒ½å¤Ÿå„è‡ªå¾€ç‹¬ç«‹çš„æ–¹å‘å˜åŒ–ã€‚å®ƒè§£å†³äº†åœ¨æ¨¡å—æœ‰å¤šç§å˜åŒ–æ–¹å‘çš„æƒ…å†µä¸‹ï¼Œç”¨ç»§æ‰¿æ‰€å¯¼è‡´çš„ç±»çˆ†ç‚¸é—®é¢˜ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªäº§å“æœ‰å½¢çŠ¶å’Œé¢œè‰²ä¸¤ä¸ªç‰¹å¾ï¼ˆå˜åŒ–æ–¹å‘ï¼‰ï¼Œå…¶ä¸­å½¢çŠ¶åˆ†ä¸ºæ–¹å½¢å’Œåœ†å½¢ï¼Œé¢œè‰²åˆ†ä¸ºçº¢è‰²å’Œè“è‰²ã€‚å¦‚æœé‡‡ç”¨ç»§æ‰¿çš„è®¾è®¡æ–¹æ¡ˆï¼Œé‚£ä¹ˆå°±éœ€è¦æ–°å¢4ä¸ªäº§å“å­ç±»ï¼šæ–¹å½¢çº¢è‰²ã€åœ†å½¢çº¢è‰²ã€æ–¹å½¢è“è‰²ã€åœ†å½¢çº¢è‰²ã€‚å¦‚æœå½¢çŠ¶æ€»å…±æœ‰mç§å˜åŒ–ï¼Œé¢œè‰²æœ‰nç§å˜åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦æ–°å¢m*nä¸ªäº§å“å­ç±»ï¼ç°åœ¨æˆ‘ä»¬ä½¿ç”¨æ¡¥æ¥æ¨¡å¼è¿›è¡Œä¼˜åŒ–ï¼Œå°†å½¢çŠ¶å’Œé¢œè‰²åˆ†åˆ«è®¾è®¡ä¸ºä¸€ä¸ªæŠ½è±¡æ¥å£ç‹¬ç«‹å‡ºæ¥ï¼Œè¿™æ ·éœ€è¦æ–°å¢2ä¸ªå½¢çŠ¶å­ç±»ï¼šæ–¹å½¢å’Œåœ†å½¢ï¼Œä»¥åŠ2ä¸ªé¢œè‰²å­ç±»ï¼šçº¢è‰²å’Œè“è‰²ã€‚åŒæ ·ï¼Œå¦‚æœå½¢çŠ¶æ€»å…±æœ‰mç§å˜åŒ–ï¼Œé¢œè‰²æœ‰nç§å˜åŒ–ï¼Œæ€»å…±åªéœ€è¦æ–°å¢m+nä¸ªå­ç±»ï¼ ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å°†å½¢çŠ¶å’Œé¢œè‰²æŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£ï¼Œä½¿äº§å“ä¸å†ä¾èµ–äºå…·ä½“çš„å½¢çŠ¶å’Œé¢œè‰²ç»†èŠ‚ï¼Œä»è€Œè¾¾åˆ°äº†è§£è€¦çš„ç›®çš„ã€‚æ¡¥æ¥æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ï¼Œå¯ä»¥ç»™ç³»ç»Ÿå¸¦æ¥å¾ˆå¥½çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å­˜åœ¨å¤šä¸ªå˜åŒ–çš„æ–¹å‘ï¼Œè€Œä¸”æ¯ä¸ªå˜åŒ–æ–¹å‘éƒ½éœ€è¦æ‰©å±•ï¼Œé‚£ä¹ˆä½¿ç”¨æ¡¥æ¥æ¨¡å¼è¿›è¡Œè®¾è®¡é‚£æ˜¯å†åˆé€‚ä¸è¿‡äº†ã€‚ Goå®ç° å›åˆ°æ¶ˆæ¯å¤„ç†ç³»ç»Ÿçš„ä¾‹å­ï¼Œä¸€ä¸ªPipelineå¯¹è±¡ä¸»è¦ç”±Inputã€Filterã€Outputä¸‰ç±»æ’ä»¶ç»„æˆï¼ˆ3ä¸ªç‰¹å¾ï¼‰ï¼Œå› ä¸ºæ˜¯æ’ä»¶åŒ–çš„ç³»ç»Ÿï¼Œä¸å¯é¿å…çš„å°±è¦æ±‚æ”¯æŒå¤šç§Inputã€Filterã€Outputçš„å®ç°ï¼Œå¹¶èƒ½å¤Ÿçµæ´»ç»„åˆï¼ˆæœ‰å¤šä¸ªå˜åŒ–çš„æ–¹å‘ï¼‰ã€‚æ˜¾ç„¶ï¼ŒPipelineå°±éå¸¸é€‚åˆä½¿ç”¨æ¡¥æ¥æ¨¡å¼è¿›è¡Œè®¾è®¡ï¼Œå®é™…ä¸Šæˆ‘ä»¬ä¹Ÿè¿™ä¹ˆåšäº†ã€‚æˆ‘ä»¬å°†Inputã€Filterã€Outputåˆ†åˆ«è®¾è®¡æˆä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œå®ƒä»¬æŒ‰ç…§å„è‡ªçš„æ–¹å‘å»æ‰©å±•ã€‚Pipelineåªä¾èµ–çš„è¿™3ä¸ªæŠ½è±¡æ¥å£ï¼Œå¹¶ä¸æ„ŸçŸ¥å…·ä½“å®ç°çš„ç»†èŠ‚ã€‚ package plugin ... type Input interface { Plugin Receive() *msg.Message } type Filter interface { Plugin Process(msg *msg.Message) *msg.Message } type Output interface { Plugin Send(msg *msg.Message) } å¤åˆ¶ä»£ç  package pipeline ... // ä¸€ä¸ªPipelineç”±inputã€filterã€outputä¸‰ä¸ªPluginç»„æˆ type Pipeline struct { status plugin.Status input plugin.Input filter plugin.Filter output plugin.Output } // é€šè¿‡æŠ½è±¡æ¥å£æ¥ä½¿ç”¨ï¼Œçœ‹ä¸åˆ°åº•å±‚çš„å®ç°ç»†èŠ‚ func (p *Pipeline) Exec() { msg := p.input.Receive() msg = p.filter.Process(msg) p.output.Send(msg) } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestPipeline(t *testing.T) { p := pipeline.Of(pipeline.DefaultConfig()) p.Start() p.Exec() p.Stop() } // è¿è¡Œç»“æœ === RUN TestPipeline Console output plugin started. Upper filter plugin started. Hello input plugin started. Pipeline started. Output: Header:map[content:text], Body:[HELLO WORLD] Hello input plugin stopped. Upper filter plugin stopped. Console output plugin stopped. Pipeline stopped. --- PASS: TestPipeline (0.00s) PASS å¤åˆ¶ä»£ç  æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ç»“æ„å‹æ¨¡å¼ä¸­çš„ç»„åˆæ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼ã€‚ç»„åˆæ¨¡å¼ä¸»è¦è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ï¼Œç›¸æ¯”äºç»§æ‰¿å…³ç³»ï¼Œç»„åˆæ¨¡å¼å¯ä»¥é¿å…ç»§æ‰¿å±‚æ¬¡è¿‡æ·±å¯¼è‡´çš„ä»£ç å¤æ‚é—®é¢˜ï¼Œå› æ­¤é¢å‘å¯¹è±¡è®¾è®¡é¢†åŸŸæµä¼ ç€ç»„åˆä¼˜äºç»§æ‰¿çš„åŸåˆ™ï¼Œè€ŒGoè¯­è¨€çš„è®¾è®¡ä¹Ÿå¾ˆå¥½å®è·µäº†è¯¥åŸåˆ™ï¼›é€‚é…å™¨æ¨¡å¼å¯ä»¥çœ‹ä½œæ˜¯ä¸¤ä¸ªä¸å…¼å®¹æ¥å£ä¹‹é—´çš„æ¡¥æ¢ï¼Œå¯ä»¥å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆClientæ‰€å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œè§£å†³äº†æ¨¡å—ä¹‹é—´å› ä¸ºæ¥å£ä¸å…¼å®¹è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„é—®é¢˜ï¼›æ¡¥æ¥æ¨¡å¼å°†æ¨¡å—çš„æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†è¿›è¡Œåˆ†ç¦»ï¼Œè®©å®ƒä»¬èƒ½å¤Ÿå¾€å„è‡ªçš„æ–¹å‘æ‰©å±•ï¼Œä»è€Œè¾¾åˆ°è§£è€¦çš„ç›®çš„ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ç»§ç»­èšç„¦äºç»“æ„å‹æ¨¡å¼ï¼Œä»‹ç»å®Œå‰©ä½™çš„4ç§ç»“æ¨¡å¼ï¼šè£…é¥°æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€äº«å…ƒæ¨¡å¼å’Œä»£ç†æ¨¡å¼ã€‚ ","link":"https://ChicRingo.github.io/post/shi-yong-go-shi-xian-gof-de-23-chong-she-ji-mo-shi-er/"},{"title":"ä½¿ç”¨Goå®ç°GoFçš„23ç§è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰","content":"ä½œè€…ï¼šå…ƒé—°å­ é“¾æ¥ï¼šhttps://juejin.im/post/6859015515344633863 æ¥æºï¼šæ˜é‡‘ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ å‰è¨€ ä»1995å¹´GoFæå‡º23ç§è®¾è®¡æ¨¡å¼åˆ°ç°åœ¨ï¼Œ25å¹´è¿‡å»äº†ï¼Œè®¾è®¡æ¨¡å¼ä¾æ—§æ˜¯è½¯ä»¶é¢†åŸŸçš„çƒ­é—¨è¯é¢˜ã€‚åœ¨å½“ä¸‹ï¼Œå¦‚æœä½ ä¸ä¼šä¸€ç‚¹è®¾è®¡æ¨¡å¼ï¼Œéƒ½ä¸å¥½æ„æ€è¯´è‡ªå·±æ˜¯ä¸€ä¸ªåˆæ ¼çš„ç¨‹åºå‘˜ã€‚è®¾è®¡æ¨¡å¼é€šå¸¸è¢«å®šä¹‰ä¸ºï¼š è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£å¹¶ä¸”ä¿è¯ä»£ç å¯é æ€§ã€‚ ä»å®šä¹‰ä¸Šçœ‹ï¼Œè®¾è®¡æ¨¡å¼å…¶å®æ˜¯ä¸€ç§ç»éªŒçš„æ€»ç»“ï¼Œæ˜¯é’ˆå¯¹ç‰¹å®šé—®é¢˜çš„ç®€æ´è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚æ—¢ç„¶æ˜¯ç»éªŒæ€»ç»“ï¼Œé‚£ä¹ˆå­¦ä¹ è®¾è®¡æ¨¡å¼æœ€ç›´æ¥çš„å¥½å¤„å°±åœ¨äºå¯ä»¥ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šè§£å†³è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€äº›ç‰¹å®šé—®é¢˜ã€‚ç„¶è€Œï¼Œå­¦ä¹ è®¾è®¡æ¨¡å¼çš„æœ€é«˜å¢ƒç•Œæ˜¯ä¹ å¾—å…¶ä¸­è§£å†³é—®é¢˜æ‰€ç”¨åˆ°çš„æ€æƒ³ï¼Œå½“ä½ æŠŠå®ƒä»¬çš„æœ¬è´¨æ€æƒ³åƒé€äº†ï¼Œä¹Ÿå°±èƒ½åšåˆ°å³ä½¿å·²ç»å¿˜æ‰æŸä¸ªè®¾è®¡æ¨¡å¼çš„åç§°å’Œç»“æ„ï¼Œä¹Ÿèƒ½åœ¨è§£å†³ç‰¹å®šé—®é¢˜æ—¶ä¿¡æ‰‹æ‹ˆæ¥ã€‚ å¥½çš„ä¸œè¥¿æœ‰äººå¹æ§ï¼Œå½“ç„¶ä¹Ÿä¼šæ‹›é»‘ã€‚è®¾è®¡æ¨¡å¼è¢«æŠ¨å‡»ä¸»è¦å› ä¸ºä»¥ä¸‹ä¸¤ç‚¹ï¼š 1ã€è®¾è®¡æ¨¡å¼ä¼šå¢åŠ ä»£ç é‡ï¼ŒæŠŠç¨‹åºé€»è¾‘å˜å¾—å¤æ‚ã€‚è¿™ä¸€ç‚¹æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½ä»…ä»…åªè€ƒè™‘å¼€å‘é˜¶æ®µçš„æˆæœ¬ã€‚æœ€ç®€å•çš„ç¨‹åºå½“ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°ä»å¤´å†™åˆ°å°¾ï¼Œä½†æ˜¯è¿™æ ·åæœŸçš„ç»´æŠ¤æˆæœ¬ä¼šå˜å¾—éå¸¸å¤§ï¼›è€Œè®¾è®¡æ¨¡å¼è™½ç„¶å¢åŠ äº†ä¸€ç‚¹å¼€å‘æˆæœ¬ï¼Œä½†æ˜¯èƒ½è®©äººä»¬å†™å‡ºå¯å¤ç”¨ã€å¯ç»´æŠ¤æ€§é«˜çš„ç¨‹åºã€‚å¼•ç”¨ã€Šè½¯ä»¶è®¾è®¡çš„å“²å­¦ã€‹é‡Œçš„æ¦‚å¿µï¼Œå‰è€…å°±æ˜¯æˆ˜æœ¯ç¼–ç¨‹ï¼Œåè€…å°±æ˜¯æˆ˜ç•¥ç¼–ç¨‹ï¼Œæˆ‘ä»¬åº”è¯¥å¯¹æˆ˜æœ¯ç¼–ç¨‹Say Noï¼ï¼ˆè¯·ç§»æ­¥ã€Šä¸€æ­¥æ­¥é™ä½è½¯ä»¶å¤æ‚æ€§ã€‹ï¼‰ 2ã€æ»¥ç”¨è®¾è®¡æ¨¡å¼ã€‚è¿™æ˜¯åˆå­¦è€…æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ï¼Œå½“å­¦åˆ°ä¸€ä¸ªæ¨¡å¼æ—¶ï¼Œæ¨ä¸å¾—åœ¨æ‰€æœ‰çš„ä»£ç éƒ½ç”¨ä¸Šï¼Œä»è€Œåœ¨ä¸è¯¥ä½¿ç”¨æ¨¡å¼çš„åœ°æ–¹åˆ»æ„åœ°ä½¿ç”¨äº†æ¨¡å¼ï¼Œå¯¼è‡´äº†ç¨‹åºå˜å¾—å¼‚å¸¸å¤æ‚ã€‚å…¶å®æ¯ä¸ªè®¾è®¡æ¨¡å¼éƒ½æœ‰å‡ ä¸ªå…³é”®è¦ç´ ï¼šé€‚ç”¨åœºæ™¯ã€è§£å†³æ–¹æ³•ã€ä¼˜ç¼ºç‚¹ã€‚æ¨¡å¼å¹¶ä¸æ˜¯ä¸‡èƒ½è¯ï¼Œå®ƒåªæœ‰åœ¨ç‰¹å®šçš„é—®é¢˜ä¸Šæ‰èƒ½æ˜¾ç°å‡ºæ•ˆæœã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªæ¨¡å¼å‰ï¼Œå…ˆé—®é—®è‡ªå·±ï¼Œå½“å‰çš„è¿™ä¸ªåœºæ™¯é€‚ç”¨è¿™ä¸ªæ¨¡å¼å—ï¼Ÿ ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦çš„å‰¯æ ‡é¢˜æ˜¯â€œå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€â€ï¼Œä½†å¹¶ä¸æ„å‘³ç€åªæœ‰é¢å‘å¯¹è±¡è¯­è¨€æ‰èƒ½ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚æ¨¡å¼åªæ˜¯ä¸€ç§è§£å†³ç‰¹å®šé—®é¢˜çš„æ€æƒ³ï¼Œè·Ÿè¯­è¨€æ— å…³ã€‚å°±åƒGoè¯­è¨€ä¸€æ ·ï¼Œå®ƒå¹¶éæ˜¯åƒC++å’ŒJavaä¸€æ ·çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä½†æ˜¯è®¾è®¡æ¨¡å¼åŒæ ·é€‚ç”¨ã€‚æœ¬ç³»åˆ—æ–‡ç« å°†ä½¿ç”¨Goè¯­è¨€æ¥å®ç°GoFæå‡ºçš„23ç§è®¾è®¡æ¨¡å¼ï¼ŒæŒ‰ç…§åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternï¼‰ä¸‰ç§ç±»åˆ«è¿›è¡Œç»„ç»‡ï¼Œæ–‡æœ¬ä¸»è¦ä»‹ç»å…¶ä¸­çš„åˆ›å»ºå‹æ¨¡å¼ã€‚ å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰ ç®€è¿° å•ä¾‹æ¨¡å¼ç®—æ˜¯23ä¸­è®¾è®¡æ¨¡å¼é‡Œæœ€ç®€å•çš„ä¸€ä¸ªäº†ï¼Œå®ƒä¸»è¦ç”¨äºä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œæœ‰ä¸€äº›å¯¹è±¡é€šå¸¸æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå…±äº«çš„å®ä¾‹ï¼Œæ¯”å¦‚çº¿ç¨‹æ± ã€å…¨å±€ç¼“å­˜ã€å¯¹è±¡æ± ç­‰ï¼Œè¿™ç§åœºæ™¯ä¸‹å°±é€‚åˆä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚ ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰å…¨å±€å”¯ä¸€çš„åœºæ™¯éƒ½é€‚åˆä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚æ¯”å¦‚ï¼Œè€ƒè™‘éœ€è¦ç»Ÿè®¡ä¸€ä¸ªAPIè°ƒç”¨çš„æƒ…å†µï¼Œæœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼ŒæˆåŠŸè°ƒç”¨æ¬¡æ•°å’Œå¤±è´¥è°ƒç”¨æ¬¡æ•°ã€‚è¿™ä¸¤ä¸ªæŒ‡æ ‡éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œæ‰€ä»¥æœ‰äººå¯èƒ½ä¼šå°†å…¶å»ºæ¨¡æˆä¸¤ä¸ªå•ä¾‹SuccessApiMetricå’ŒFailApiMetricã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œéšç€æŒ‡æ ‡æ•°é‡çš„å¢å¤šï¼Œä½ ä¼šå‘ç°ä»£ç é‡Œç±»çš„å®šä¹‰ä¼šè¶Šæ¥è¶Šå¤šï¼Œä¹Ÿè¶Šæ¥è¶Šè‡ƒè‚¿ã€‚è¿™ä¹Ÿæ˜¯å•ä¾‹æ¨¡å¼æœ€å¸¸è§çš„è¯¯ç”¨åœºæ™¯ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯å°†ä¸¤ä¸ªæŒ‡æ ‡è®¾è®¡æˆä¸€ä¸ªå¯¹è±¡ApiMetricä¸‹çš„ä¸¤ä¸ªå®ä¾‹ApiMetic successå’ŒApiMetic failã€‚ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦åº”è¯¥è¢«å»ºæ¨¡æˆå•ä¾‹ï¼Ÿ é€šå¸¸ï¼Œè¢«å»ºæ¨¡æˆå•ä¾‹çš„å¯¹è±¡éƒ½æœ‰â€œä¸­å¿ƒç‚¹â€çš„å«ä¹‰ï¼Œæ¯”å¦‚çº¿ç¨‹æ± å°±æ˜¯ç®¡ç†æ‰€æœ‰çº¿ç¨‹çš„ä¸­å¿ƒã€‚æ‰€ä»¥ï¼Œåœ¨åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦é€‚åˆå•ä¾‹æ¨¡å¼æ—¶ï¼Œå…ˆæ€è€ƒä¸‹ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªä¸­å¿ƒç‚¹å—ï¼Ÿ Goå®ç° åœ¨å¯¹æŸä¸ªå¯¹è±¡å®ç°å•ä¾‹æ¨¡å¼æ—¶ï¼Œæœ‰ä¸¤ä¸ªç‚¹å¿…é¡»è¦æ³¨æ„ï¼šï¼ˆ1ï¼‰é™åˆ¶è°ƒç”¨è€…ç›´æ¥å®ä¾‹åŒ–è¯¥å¯¹è±¡ï¼›ï¼ˆ2ï¼‰ä¸ºè¯¥å¯¹è±¡çš„å•ä¾‹æä¾›ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è®¿é—®æ–¹æ³•ã€‚ å¯¹äºC++/Javaè€Œè¨€ï¼Œåªéœ€æŠŠç±»çš„æ„é€ å‡½æ•°è®¾è®¡æˆç§æœ‰çš„ï¼Œå¹¶æä¾›ä¸€ä¸ªstaticæ–¹æ³•å»è®¿é—®è¯¥ç±»ç‚¹å”¯ä¸€å®ä¾‹å³å¯ã€‚ä½†å¯¹äºGoè¯­è¨€æ¥è¯´ï¼Œå³æ²¡æœ‰æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼Œä¹Ÿæ²¡æœ‰staticæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å¦å¯»å‡ºè·¯ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Goè¯­è¨€packageçš„è®¿é—®è§„åˆ™æ¥å®ç°ï¼Œå°†å•ä¾‹ç»“æ„ä½“è®¾è®¡æˆé¦–å­—æ¯å°å†™ï¼Œå°±èƒ½é™å®šå…¶è®¿é—®èŒƒå›´åªåœ¨å½“å‰packageä¸‹ï¼Œæ¨¡æ‹Ÿäº†C++/Javaä¸­çš„ç§æœ‰æ„é€ å‡½æ•°ï¼›å†åœ¨å½“å‰packageä¸‹å®ç°ä¸€ä¸ªé¦–å­—æ¯å¤§å†™çš„è®¿é—®å‡½æ•°ï¼Œå°±ç›¸å½“äºstaticæ–¹æ³•çš„ä½œç”¨äº†ã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ã€‚é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ä¸€åˆ™æ¶ˆè€—CPUï¼ŒäºŒåˆ™å†…å­˜çš„åˆ©ç”¨ç‡ä¹Ÿä¸é«˜ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨å¯¹è±¡æ± æŠ€æœ¯æ¥è¿›è¡Œä¼˜åŒ–ã€‚è€ƒè™‘æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡æ± ï¼Œå› ä¸ºæ˜¯å…¨å±€çš„ä¸­å¿ƒç‚¹ï¼Œç®¡ç†æ‰€æœ‰çš„Messageå®ä¾‹ï¼Œæ‰€ä»¥å°†å…¶å®ç°æˆå•ä¾‹ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š package msgpool ... // æ¶ˆæ¯æ±  type messagePool struct { pool *sync.Pool } // æ¶ˆæ¯æ± å•ä¾‹ var msgPool = &amp;messagePool{ // å¦‚æœæ¶ˆæ¯æ± é‡Œæ²¡æœ‰æ¶ˆæ¯ï¼Œåˆ™æ–°å»ºä¸€ä¸ªCountå€¼ä¸º0çš„Messageå®ä¾‹ pool: &amp;sync.Pool{New: func() interface{} { return &amp;Message{Count: 0} }}, } // è®¿é—®æ¶ˆæ¯æ± å•ä¾‹çš„å”¯ä¸€æ–¹æ³• func Instance() *messagePool { return msgPool } // å¾€æ¶ˆæ¯æ± é‡Œæ·»åŠ æ¶ˆæ¯ func (m *messagePool) AddMsg(msg *Message) { m.pool.Put(msg) } // ä»æ¶ˆæ¯æ± é‡Œè·å–æ¶ˆæ¯ func (m *messagePool) GetMsg() *Message { return m.pool.Get().(*Message) } ... å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestMessagePool(t *testing.T) { msg0 := msgpool.Instance().GetMsg() if msg0.Count != 0 { t.Errorf(&quot;expect msg count %d, but actual %d.&quot;, 0, msg0.Count) } msg0.Count = 1 msgpool.Instance().AddMsg(msg0) msg1 := msgpool.Instance().GetMsg() if msg1.Count != 1 { t.Errorf(&quot;expect msg count %d, but actual %d.&quot;, 1, msg1.Count) } } // è¿è¡Œç»“æœ === RUN TestMessagePool --- PASS: TestMessagePool (0.00s) PASS å¤åˆ¶ä»£ç  ä»¥ä¸Šçš„å•ä¾‹æ¨¡å¼å°±æ˜¯å…¸å‹çš„â€œé¥¿æ±‰æ¨¡å¼â€ï¼Œå®ä¾‹åœ¨ç³»ç»ŸåŠ è½½çš„æ—¶å€™å°±å·²ç»å®Œæˆäº†åˆå§‹åŒ–ã€‚å¯¹åº”åœ°ï¼Œè¿˜æœ‰ä¸€ç§â€œæ‡’æ±‰æ¨¡å¼â€ï¼Œåªæœ‰ç­‰åˆ°å¯¹è±¡è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šå»åˆå§‹åŒ–å®ƒï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸ŠèŠ‚çœäº†å†…å­˜ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œâ€œæ‡’æ±‰æ¨¡å¼â€ä¼šå¸¦æ¥çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡æ™®é€šåŠ é”ï¼Œæˆ–è€…æ›´é«˜æ•ˆçš„åŒé‡æ£€éªŒé”æ¥ä¼˜åŒ–ã€‚å¯¹äºâ€œæ‡’æ±‰æ¨¡å¼â€ï¼ŒGoè¯­è¨€æœ‰ä¸€ä¸ªæ›´ä¼˜é›…çš„å®ç°æ–¹å¼ï¼Œé‚£å°±æ˜¯åˆ©ç”¨sync.Onceï¼Œå®ƒæœ‰ä¸€ä¸ªDoæ–¹æ³•ï¼Œå…¶å…¥å‚æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼ŒGoè¯­è¨€ä¼šä¿è¯ä»…ä»…åªè°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ã€‚ // å•ä¾‹æ¨¡å¼çš„â€œæ‡’æ±‰æ¨¡å¼â€å®ç° package msgpool ... var once = &amp;sync.Once{} // æ¶ˆæ¯æ± å•ä¾‹ï¼Œåœ¨é¦–æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ– var msgPool *messagePool // å…¨å±€å”¯ä¸€è·å–æ¶ˆæ¯æ± poolåˆ°æ–¹æ³• func Instance() *messagePool { // åœ¨åŒ¿åå‡½æ•°ä¸­å®ç°åˆå§‹åŒ–é€»è¾‘ï¼ŒGoè¯­è¨€ä¿è¯åªä¼šè°ƒç”¨ä¸€æ¬¡ once.Do(func() { msgPool = &amp;messagePool{ // å¦‚æœæ¶ˆæ¯æ± é‡Œæ²¡æœ‰æ¶ˆæ¯ï¼Œåˆ™æ–°å»ºä¸€ä¸ªCountå€¼ä¸º0çš„Messageå®ä¾‹ pool: &amp;sync.Pool{New: func() interface{} { return &amp;Message{Count: 0} }}, } }) return msgPool } ... å¤åˆ¶ä»£ç  å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰ ç®€è¿° åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸é‡åˆ°ä¸€äº›å¤æ‚çš„å¯¹è±¡ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šæˆå‘˜å±æ€§ï¼Œç”šè‡³åµŒå¥—ç€å¤šä¸ªå¤æ‚çš„å¯¹è±¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ›å»ºè¿™ä¸ªå¤æ‚å¯¹è±¡å°±ä¼šå˜å¾—å¾ˆç¹çã€‚å¯¹äºC++/Javaè€Œè¨€ï¼Œæœ€å¸¸è§çš„è¡¨ç°å°±æ˜¯æ„é€ å‡½æ•°æœ‰ç€é•¿é•¿çš„å‚æ•°åˆ—è¡¨ï¼š MyObject obj = new MyObject(param1, param2, param3, param4, param5, param6, ...) å¤åˆ¶ä»£ç  è€Œå¯¹äºGoè¯­è¨€æ¥è¯´ï¼Œæœ€å¸¸è§çš„è¡¨ç°å°±æ˜¯å¤šå±‚çš„åµŒå¥—å®ä¾‹åŒ–ï¼š obj := &amp;MyObject{ Field1: &amp;Field1 { Param1: &amp;Param1 { Val: 0, }, Param2: &amp;Param2 { Val: 1, }, ... }, Field2: &amp;Field2 { Param3: &amp;Param3 { Val: 2, }, ... }, ... } å¤åˆ¶ä»£ç  ä¸Šè¿°çš„å¯¹è±¡åˆ›å»ºæ–¹æ³•æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰å¯¹å¯¹è±¡ä½¿ç”¨è€…ä¸å‹å¥½ï¼Œä½¿ç”¨è€…åœ¨åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦çŸ¥é“çš„ç»†èŠ‚å¤ªå¤šï¼›ï¼ˆ2ï¼‰ä»£ç å¯è¯»æ€§å¾ˆå·®ã€‚ é’ˆå¯¹è¿™ç§å¯¹è±¡æˆå‘˜è¾ƒå¤šï¼Œåˆ›å»ºå¯¹è±¡é€»è¾‘è¾ƒä¸ºç¹ççš„åœºæ™¯ï¼Œå°±é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥è¿›è¡Œä¼˜åŒ–ã€‚ å»ºé€ è€…æ¨¡å¼çš„ä½œç”¨æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š 1ã€å°è£…å¤æ‚å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä½¿å¯¹è±¡ä½¿ç”¨è€…ä¸æ„ŸçŸ¥å¤æ‚çš„åˆ›å»ºé€»è¾‘ã€‚ 2ã€å¯ä»¥ä¸€æ­¥æ­¥æŒ‰ç…§é¡ºåºå¯¹æˆå‘˜è¿›è¡Œèµ‹å€¼ï¼Œæˆ–è€…åˆ›å»ºåµŒå¥—å¯¹è±¡ï¼Œå¹¶æœ€ç»ˆå®Œæˆç›®æ ‡å¯¹è±¡çš„åˆ›å»ºã€‚ 3ã€å¯¹å¤šä¸ªå¯¹è±¡å¤ç”¨åŒæ ·çš„å¯¹è±¡åˆ›å»ºé€»è¾‘ã€‚ å…¶ä¸­ï¼Œç¬¬1å’Œç¬¬2ç‚¹æ¯”è¾ƒå¸¸ç”¨ï¼Œä¸‹é¢å¯¹å»ºé€ è€…æ¨¡å¼çš„å®ç°ä¹Ÿä¸»è¦æ˜¯é’ˆå¯¹è¿™ä¸¤ç‚¹è¿›è¡Œç¤ºä¾‹ã€‚ Goå®ç° è€ƒè™‘å¦‚ä¸‹çš„ä¸€ä¸ªMessageç»“æ„ä½“ï¼Œå…¶ä¸»è¦æœ‰Headerå’ŒBodyç»„æˆï¼š package msg ... type Message struct { Header *Header Body *Body } type Header struct { SrcAddr string SrcPort uint64 DestAddr string DestPort uint64 Items map[string]string } type Body struct { Items []string } ... å¤åˆ¶ä»£ç  å¦‚æœæŒ‰ç…§ç›´æ¥çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œåˆ›å»ºé€»è¾‘åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š // å¤šå±‚çš„åµŒå¥—å®ä¾‹åŒ– message := msg.Message{ Header: &amp;msg.Header{ SrcAddr: &quot;192.168.0.1&quot;, SrcPort: 1234, DestAddr: &quot;192.168.0.2&quot;, DestPort: 8080, Items: make(map[string]string), }, Body: &amp;msg.Body{ Items: make([]string, 0), }, } // éœ€è¦çŸ¥é“å¯¹è±¡çš„å®ç°ç»†èŠ‚ message.Header.Items[&quot;contents&quot;] = &quot;application/json&quot; message.Body.Items = append(message.Body.Items, &quot;record1&quot;) message.Body.Items = append(message.Body.Items, &quot;record2&quot;) å¤åˆ¶ä»£ç  è™½ç„¶Messageç»“æ„ä½“åµŒå¥—çš„å±‚æ¬¡ä¸å¤šï¼Œä½†æ˜¯ä»å…¶åˆ›å»ºçš„ä»£ç æ¥çœ‹ï¼Œç¡®å®å­˜åœ¨å¯¹å¯¹è±¡ä½¿ç”¨è€…ä¸å‹å¥½å’Œä»£ç å¯è¯»æ€§å·®çš„ç¼ºç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬å¼•å…¥å»ºé€ è€…æ¨¡å¼å¯¹ä»£ç è¿›è¡Œé‡æ„ï¼š package msg ... // Messageå¯¹è±¡çš„Builderå¯¹è±¡ type builder struct { once *sync.Once msg *Message } // è¿”å›Builderå¯¹è±¡ func Builder() *builder { return &amp;builder{ once: &amp;sync.Once{}, msg: &amp;Message{Header: &amp;Header{}, Body: &amp;Body{}}, } } // ä»¥ä¸‹æ˜¯å¯¹Messageæˆå‘˜å¯¹æ„å»ºæ–¹æ³• func (b *builder) WithSrcAddr(srcAddr string) *builder { b.msg.Header.SrcAddr = srcAddr return b } func (b *builder) WithSrcPort(srcPort uint64) *builder { b.msg.Header.SrcPort = srcPort return b } func (b *builder) WithDestAddr(destAddr string) *builder { b.msg.Header.DestAddr = destAddr return b } func (b *builder) WithDestPort(destPort uint64) *builder { b.msg.Header.DestPort = destPort return b } func (b *builder) WithHeaderItem(key, value string) *builder { // ä¿è¯mapåªåˆå§‹åŒ–ä¸€æ¬¡ b.once.Do(func() { b.msg.Header.Items = make(map[string]string) }) b.msg.Header.Items[key] = value return b } func (b *builder) WithBodyItem(record string) *builder { b.msg.Body.Items = append(b.msg.Body.Items, record) return b } // åˆ›å»ºMessageå¯¹è±¡ï¼Œåœ¨æœ€åä¸€æ­¥è°ƒç”¨ func (b *builder) Build() *Message { return b.msg } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestMessageBuilder(t *testing.T) { // ä½¿ç”¨æ¶ˆæ¯å»ºé€ è€…è¿›è¡Œå¯¹è±¡åˆ›å»º message := msg.Builder(). WithSrcAddr(&quot;192.168.0.1&quot;). WithSrcPort(1234). WithDestAddr(&quot;192.168.0.2&quot;). WithDestPort(8080). WithHeaderItem(&quot;contents&quot;, &quot;application/json&quot;). WithBodyItem(&quot;record1&quot;). WithBodyItem(&quot;record2&quot;). Build() if message.Header.SrcAddr != &quot;192.168.0.1&quot; { t.Errorf(&quot;expect src address 192.168.0.1, but actual %s.&quot;, message.Header.SrcAddr) } if message.Body.Items[0] != &quot;record1&quot; { t.Errorf(&quot;expect body item0 record1, but actual %s.&quot;, message.Body.Items[0]) } } // è¿è¡Œç»“æœ === RUN TestMessageBuilder --- PASS: TestMessageBuilder (0.00s) PASS å¤åˆ¶ä»£ç  ä»æµ‹è¯•ä»£ç å¯çŸ¥ï¼Œä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥è¿›è¡Œå¯¹è±¡åˆ›å»ºï¼Œä½¿ç”¨è€…ä¸å†éœ€è¦çŸ¥é“å¯¹è±¡å…·ä½“çš„å®ç°ç»†èŠ‚ï¼Œä»£ç å¯è¯»æ€§ä¹Ÿæ›´å¥½ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Method Patternï¼‰ ç®€è¿° å·¥å‚æ–¹æ³•æ¨¡å¼è·Ÿä¸Šä¸€èŠ‚è®¨è®ºçš„å»ºé€ è€…æ¨¡å¼ç±»ä¼¼ï¼Œéƒ½æ˜¯å°†å¯¹è±¡åˆ›å»ºçš„é€»è¾‘å°è£…èµ·æ¥ï¼Œä¸ºä½¿ç”¨è€…æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å¯¹è±¡åˆ›å»ºæ¥å£ã€‚ä¸¤è€…åœ¨åº”ç”¨åœºæ™¯ä¸Šç¨æœ‰åŒºåˆ«ï¼Œå»ºé€ è€…æ¨¡å¼æ›´å¸¸ç”¨äºéœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°æ¥è¿›è¡Œå®ä¾‹åŒ–çš„åœºæ™¯ã€‚ ä½¿ç”¨å·¥å‚æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ä¸»è¦æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š 1ã€ä»£ç å¯è¯»æ€§æ›´å¥½ã€‚ç›¸æ¯”äºä½¿ç”¨C++/Javaä¸­çš„æ„é€ å‡½æ•°ï¼Œæˆ–è€…Goä¸­çš„{}æ¥åˆ›å»ºå¯¹è±¡ï¼Œå·¥å‚æ–¹æ³•å› ä¸ºå¯ä»¥é€šè¿‡å‡½æ•°åæ¥è¡¨è¾¾ä»£ç å«ä¹‰ï¼Œä»è€Œå…·å¤‡æ›´å¥½çš„å¯è¯»æ€§ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨å·¥å‚æ–¹æ³•productA := CreateProductA()åˆ›å»ºä¸€ä¸ªProductAå¯¹è±¡ï¼Œæ¯”ç›´æ¥ä½¿ç”¨productA := ProductA{}çš„å¯è¯»æ€§è¦å¥½ã€‚ 2ã€ä¸ä½¿ç”¨è€…ä»£ç è§£è€¦ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¯¹è±¡çš„åˆ›å»ºå¾€å¾€æ˜¯ä¸€ä¸ªå®¹æ˜“å˜åŒ–çš„ç‚¹ï¼Œé€šè¿‡å·¥å‚æ–¹æ³•æ¥å°è£…å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¯ä»¥åœ¨åˆ›å»ºé€»è¾‘å˜æ›´æ—¶ï¼Œé¿å…éœ°å¼¹å¼ä¿®æ”¹ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šï¼ˆ1ï¼‰æä¾›ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨å·¥å‚å¯¹è±¡çš„å·¥å‚æ–¹æ³•æ¥åˆ›å»ºäº§å“å¯¹è±¡ï¼›ï¼ˆ2ï¼‰å°†å·¥å‚æ–¹æ³•é›†æˆåˆ°äº§å“å¯¹è±¡ä¸­ï¼ˆC++/Javaä¸­å¯¹è±¡çš„staticæ–¹æ³•ï¼ŒGoä¸­åŒä¸€packageä¸‹çš„å‡½æ•°ï¼‰ Goå®ç° è€ƒè™‘æœ‰ä¸€ä¸ªäº‹ä»¶å¯¹è±¡Eventï¼Œåˆ†åˆ«æœ‰ä¸¤ç§æœ‰æ•ˆçš„æ—¶é—´ç±»å‹Startå’ŒEndï¼š package event ... type Type uint8 // äº‹ä»¶ç±»å‹å®šä¹‰ const ( Start Type = iota End ) // äº‹ä»¶æŠ½è±¡æ¥å£ type Event interface { EventType() Type Content() string } // å¼€å§‹äº‹ä»¶ï¼Œå®ç°äº†Eventæ¥å£ type StartEvent struct{ content string } ... // ç»“æŸäº‹ä»¶ï¼Œå®ç°äº†Eventæ¥å£ type EndEvent struct{ content string } ... å¤åˆ¶ä»£ç  1ã€æŒ‰ç…§ç¬¬ä¸€ç§å®ç°æ–¹å¼ï¼Œä¸ºEventæä¾›ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š package event ... // äº‹ä»¶å·¥å‚å¯¹è±¡ type Factory struct{} // æ›´å…·äº‹ä»¶ç±»å‹åˆ›å»ºå…·ä½“äº‹ä»¶ func (e *Factory) Create(etype Type) Event { switch etype { case Start: return &amp;StartEvent{ content: &quot;this is start event&quot;, } case End: return &amp;EndEvent{ content: &quot;this is end event&quot;, } default: return nil } } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestEventFactory(t *testing.T) { factory := event.Factory{} e := factory.Create(event.Start) if e.EventType() != event.Start { t.Errorf(&quot;expect event.Start, but actual %v.&quot;, e.EventType()) } e = factory.Create(event.End) if e.EventType() != event.End { t.Errorf(&quot;expect event.End, but actual %v.&quot;, e.EventType()) } } // è¿è¡Œç»“æœ === RUN TestEventFactory --- PASS: TestEventFactory (0.00s) PASS å¤åˆ¶ä»£ç  2ã€æŒ‰ç…§ç¬¬äºŒç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«ç»™Startå’ŒEndç±»å‹çš„Eventå•ç‹¬æä¾›ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š package event ... // Startç±»å‹Eventçš„å·¥å‚æ–¹æ³• func OfStart() Event { return &amp;StartEvent{ content: &quot;this is start event&quot;, } } // Endç±»å‹Eventçš„å·¥å‚æ–¹æ³• func OfEnd() Event { return &amp;EndEvent{ content: &quot;this is end event&quot;, } } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package event ... func TestEvent(t *testing.T) { e := event.OfStart() if e.EventType() != event.Start { t.Errorf(&quot;expect event.Start, but actual %v.&quot;, e.EventType()) } e = event.OfEnd() if e.EventType() != event.End { t.Errorf(&quot;expect event.End, but actual %v.&quot;, e.EventType()) } } // è¿è¡Œç»“æœ === RUN TestEvent --- PASS: TestEvent (0.00s) PASS å¤åˆ¶ä»£ç  æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰ ç®€è¿° åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå·¥å‚å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªäº§å“æ—ï¼Œå…·ä½“åˆ›å»ºå“ªä¸ªäº§å“ï¼Œåˆ™é€šè¿‡swtich-caseçš„æ–¹å¼å»åˆ¤æ–­ã€‚è¿™ä¹Ÿæ„å‘³ç€è¯¥äº§å“ç»„ä¸Šï¼Œæ¯æ–°å¢ä¸€ç±»äº§å“å¯¹è±¡ï¼Œéƒ½å¿…é¡»ä¿®æ”¹åŸæ¥å·¥å‚å¯¹è±¡çš„ä»£ç ï¼›è€Œä¸”éšç€äº§å“çš„ä¸æ–­å¢å¤šï¼Œå·¥å‚å¯¹è±¡çš„èŒè´£ä¹Ÿè¶Šæ¥è¶Šé‡ï¼Œè¿åäº†å•ä¸€èŒè´£åŸåˆ™ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼é€šè¿‡ç»™å·¥å‚ç±»æ–°å¢ä¸€ä¸ªæŠ½è±¡å±‚è§£å†³äº†è¯¥é—®é¢˜ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒFactoryAå’ŒFactoryBéƒ½å®ç°Â·æŠ½è±¡å·¥å‚æ¥å£ï¼Œåˆ†åˆ«ç”¨äºåˆ›å»ºProductAå’ŒProductBã€‚å¦‚æœåç»­æ–°å¢äº†ProductCï¼Œåªéœ€æ–°å¢ä¸€ä¸ªFactoryCå³å¯ï¼Œæ— éœ€ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼›å› ä¸ºæ¯ä¸ªå·¥å‚åªè´Ÿè´£åˆ›å»ºä¸€ä¸ªäº§å“ï¼Œå› æ­¤ä¹Ÿéµå¾ªäº†å•ä¸€èŒè´£åŸåˆ™ã€‚ Goå®ç° è€ƒè™‘éœ€è¦å¦‚ä¸‹ä¸€ä¸ªæ’ä»¶æ¶æ„é£æ ¼çš„æ¶ˆæ¯å¤„ç†ç³»ç»Ÿï¼Œpipelineæ˜¯æ¶ˆæ¯å¤„ç†çš„ç®¡é“ï¼Œå…¶ä¸­åŒ…å«äº†inputã€filterå’Œoutputä¸‰ä¸ªæ’ä»¶ã€‚æˆ‘ä»¬éœ€è¦å®ç°æ ¹æ®é…ç½®æ¥åˆ›å»ºpipeline ï¼ŒåŠ è½½æ’ä»¶è¿‡ç¨‹çš„å®ç°éå¸¸é€‚åˆä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œå…¶ä¸­inputã€filterå’Œoutputä¸‰ç±»æ’ä»¶çš„åˆ›å»ºä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œè€Œpipelineçš„åˆ›å»ºåˆ™ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚ å„ç±»æ’ä»¶å’Œpipelineçš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š package plugin ... // æ’ä»¶æŠ½è±¡æ¥å£å®šä¹‰ type Plugin interface {} // è¾“å…¥æ’ä»¶ï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯ type Input interface { Plugin Receive() string } // è¿‡æ»¤æ’ä»¶ï¼Œç”¨äºå¤„ç†æ¶ˆæ¯ type Filter interface { Plugin Process(msg string) string } // è¾“å‡ºæ’ä»¶ï¼Œç”¨äºå‘é€æ¶ˆæ¯ type Output interface { Plugin Send(msg string) } å¤åˆ¶ä»£ç  package pipeline ... // æ¶ˆæ¯ç®¡é“çš„å®šä¹‰ type Pipeline struct { input plugin.Input filter plugin.Filter output plugin.Output } // ä¸€ä¸ªæ¶ˆæ¯çš„å¤„ç†æµç¨‹ä¸º input -&gt; filter -&gt; output func (p *Pipeline) Exec() { msg := p.input.Receive() msg = p.filter.Process(msg) p.output.Send(msg) } å¤åˆ¶ä»£ç  æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰inputã€filterã€outputä¸‰ç±»æ’ä»¶æ¥å£çš„å…·ä½“å®ç°ï¼š package plugin ... // inputæ’ä»¶åç§°ä¸ç±»å‹çš„æ˜ å°„å…³ç³»ï¼Œä¸»è¦ç”¨äºé€šè¿‡åå°„åˆ›å»ºinputå¯¹è±¡ var inputNames = make(map[string]reflect.Type) // Hello inputæ’ä»¶ï¼Œæ¥æ”¶â€œHello Worldâ€æ¶ˆæ¯ type HelloInput struct {} func (h *HelloInput) Receive() string { return &quot;Hello World&quot; } // åˆå§‹åŒ–inputæ’ä»¶æ˜ å°„å…³ç³»è¡¨ func init() { inputNames[&quot;hello&quot;] = reflect.TypeOf(HelloInput{}) } å¤åˆ¶ä»£ç  package plugin ... // filteræ’ä»¶åç§°ä¸ç±»å‹çš„æ˜ å°„å…³ç³»ï¼Œä¸»è¦ç”¨äºé€šè¿‡åå°„åˆ›å»ºfilterå¯¹è±¡ var filterNames = make(map[string]reflect.Type) // Upper filteræ’ä»¶ï¼Œå°†æ¶ˆæ¯å…¨éƒ¨å­—æ¯è½¬æˆå¤§å†™ type UpperFilter struct {} func (u *UpperFilter) Process(msg string) string { return strings.ToUpper(msg) } // åˆå§‹åŒ–filteræ’ä»¶æ˜ å°„å…³ç³»è¡¨ func init() { filterNames[&quot;upper&quot;] = reflect.TypeOf(UpperFilter{}) } å¤åˆ¶ä»£ç  package plugin ... // outputæ’ä»¶åç§°ä¸ç±»å‹çš„æ˜ å°„å…³ç³»ï¼Œä¸»è¦ç”¨äºé€šè¿‡åå°„åˆ›å»ºoutputå¯¹è±¡ var outputNames = make(map[string]reflect.Type) // Console outputæ’ä»¶ï¼Œå°†æ¶ˆæ¯è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Š type ConsoleOutput struct {} func (c *ConsoleOutput) Send(msg string) { fmt.Println(msg) } // åˆå§‹åŒ–outputæ’ä»¶æ˜ å°„å…³ç³»è¡¨ func init() { outputNames[&quot;console&quot;] = reflect.TypeOf(ConsoleOutput{}) } å¤åˆ¶ä»£ç  ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰æ’ä»¶æŠ½è±¡å·¥å‚æ¥å£ï¼Œä»¥åŠå¯¹åº”æ’ä»¶çš„å·¥å‚å®ç°ï¼š package plugin ... // æ’ä»¶æŠ½è±¡å·¥å‚æ¥å£ type Factory interface { Create(conf Config) Plugin } // inputæ’ä»¶å·¥å‚å¯¹è±¡ï¼Œå®ç°Factoryæ¥å£ type InputFactory struct{} // è¯»å–é…ç½®ï¼Œé€šè¿‡åå°„æœºåˆ¶è¿›è¡Œå¯¹è±¡å®ä¾‹åŒ– func (i *InputFactory) Create(conf Config) Plugin { t, _ := inputNames[conf.Name] return reflect.New(t).Interface().(Plugin) } // filterå’Œoutputæ’ä»¶å·¥å‚å®ç°ç±»ä¼¼ type FilterFactory struct{} func (f *FilterFactory) Create(conf Config) Plugin { t, _ := filterNames[conf.Name] return reflect.New(t).Interface().(Plugin) } type OutputFactory struct{} func (o *OutputFactory) Create(conf Config) Plugin { t, _ := outputNames[conf.Name] return reflect.New(t).Interface().(Plugin) } å¤åˆ¶ä»£ç  æœ€åå®šä¹‰pipelineçš„å·¥å‚æ–¹æ³•ï¼Œè°ƒç”¨plugin.FactoryæŠ½è±¡å·¥å‚å®Œæˆpipelienå¯¹è±¡çš„å®ä¾‹åŒ–ï¼š package pipeline ... // ä¿å­˜ç”¨äºåˆ›å»ºPluginçš„å·¥å‚å®ä¾‹ï¼Œå…¶ä¸­mapçš„keyä¸ºæ’ä»¶ç±»å‹ï¼Œvalueä¸ºæŠ½è±¡å·¥å‚æ¥å£ var pluginFactories = make(map[plugin.Type]plugin.Factory) // æ ¹æ®plugin.Typeè¿”å›å¯¹åº”Pluginç±»å‹çš„å·¥å‚å®ä¾‹ func factoryOf(t plugin.Type) plugin.Factory { factory, _ := pluginFactories[t] return factory } // pipelineå·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®åˆ›å»ºä¸€ä¸ªPipelineå®ä¾‹ func Of(conf Config) *Pipeline { p := &amp;Pipeline{} p.input = factoryOf(plugin.InputType).Create(conf.Input).(plugin.Input) p.filter = factoryOf(plugin.FilterType).Create(conf.Filter).(plugin.Filter) p.output = factoryOf(plugin.OutputType).Create(conf.Output).(plugin.Output) return p } // åˆå§‹åŒ–æ’ä»¶å·¥å‚å¯¹è±¡ func init() { pluginFactories[plugin.InputType] = &amp;plugin.InputFactory{} pluginFactories[plugin.FilterType] = &amp;plugin.FilterFactory{} pluginFactories[plugin.OutputType] = &amp;plugin.OutputFactory{} } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestPipeline(t *testing.T) { // å…¶ä¸­pipeline.DefaultConfig()çš„é…ç½®å†…å®¹è§ã€æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºä¾‹å›¾ã€‘ // æ¶ˆæ¯å¤„ç†æµç¨‹ä¸º HelloInput -&gt; UpperFilter -&gt; ConsoleOutput p := pipeline.Of(pipeline.DefaultConfig()) p.Exec() } // è¿è¡Œç»“æœ === RUN TestPipeline HELLO WORLD --- PASS: TestPipeline (0.00s) PASS å¤åˆ¶ä»£ç  åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰ ç®€è¿° åŸå‹æ¨¡å¼ä¸»è¦è§£å†³å¯¹è±¡å¤åˆ¶çš„é—®é¢˜ï¼Œå®ƒçš„æ ¸å¿ƒå°±æ˜¯clone()æ–¹æ³•ï¼Œè¿”å›Prototypeå¯¹è±¡çš„å¤åˆ¶å“ã€‚åœ¨ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°æœ‰ä¸€äº›åœºæ™¯éœ€è¦å¤§é‡ç›¸åŒçš„å¯¹è±¡ï¼Œå¦‚æœä¸ä½¿ç”¨åŸå‹æ¨¡å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·è¿›è¡Œå¯¹è±¡çš„åˆ›å»ºï¼šæ–°åˆ›å»ºä¸€ä¸ªç›¸åŒå¯¹è±¡çš„å®ä¾‹ï¼Œç„¶åéå†åŸå§‹å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œ å¹¶å°†æˆå‘˜å˜é‡å€¼å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œé‚£å°±æ˜¯ä½¿ç”¨è€…å¿…é¡»çŸ¥é“å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œå¯¼è‡´ä»£ç ä¹‹é—´çš„è€¦åˆã€‚å¦å¤–ï¼Œå¯¹è±¡å¾ˆæœ‰å¯èƒ½å­˜åœ¨é™¤äº†å¯¹è±¡æœ¬èº«ä»¥å¤–ä¸å¯è§çš„å˜é‡ï¼Œè¿™ç§æƒ…å†µä¸‹è¯¥æ–¹æ³•å°±è¡Œä¸é€šäº†ã€‚ å¯¹äºè¿™ç§æƒ…å†µï¼Œæ›´å¥½çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨åŸå‹æ¨¡å¼ï¼Œå°†å¤åˆ¶é€»è¾‘å§”æ‰˜ç»™å¯¹è±¡æœ¬èº«ï¼Œè¿™æ ·ï¼Œä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ä¹Ÿéƒ½è¿åˆƒè€Œè§£äº†ã€‚ Goå®ç° è¿˜æ˜¯ä»¥å»ºé€ è€…æ¨¡å¼ä¸€èŠ‚ä¸­çš„Messageä½œä¸ºä¾‹å­ï¼Œç°åœ¨è®¾è®¡ä¸€ä¸ªPrototypeæŠ½è±¡æ¥å£ï¼š package prototype ... // åŸå‹å¤åˆ¶æŠ½è±¡æ¥å£ type Prototype interface { clone() Prototype } type Message struct { Header *Header Body *Body } func (m *Message) clone() Prototype { msg := *m return &amp;msg } å¤åˆ¶ä»£ç  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š package test ... func TestPrototype(t *testing.T) { message := msg.Builder(). WithSrcAddr(&quot;192.168.0.1&quot;). WithSrcPort(1234). WithDestAddr(&quot;192.168.0.2&quot;). WithDestPort(8080). WithHeaderItem(&quot;contents&quot;, &quot;application/json&quot;). WithBodyItem(&quot;record1&quot;). WithBodyItem(&quot;record2&quot;). Build() // å¤åˆ¶ä¸€ä»½æ¶ˆæ¯ newMessage := message.Clone().(*msg.Message) if newMessage.Header.SrcAddr != message.Header.SrcAddr { t.Errorf(&quot;Clone Message failed.&quot;) } if newMessage.Body.Items[0] != message.Body.Items[0] { t.Errorf(&quot;Clone Message failed.&quot;) } } // è¿è¡Œç»“æœ === RUN TestPrototype --- PASS: TestPrototype (0.00s) PASS å¤åˆ¶ä»£ç  æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»äº†GoFçš„23ç§è®¾è®¡æ¨¡å¼ä¸­çš„5ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œåˆ›å»ºå‹æ¨¡å¼çš„ç›®çš„éƒ½æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œè®©å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ä¸ä½¿ç”¨è€…è§£è€¦ã€‚å…¶ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸»è¦ç”¨äºä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ï¼›å»ºé€ è€…æ¨¡å¼ä¸»è¦è§£å†³éœ€è¦åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œæˆ–è€…å¯¹åˆå§‹åŒ–é¡ºåºæœ‰è¦æ±‚çš„åœºæ™¯ï¼›å·¥å‚æ–¹æ³•æ¨¡å¼é€šè¿‡æä¾›ä¸€ä¸ªå·¥å‚å¯¹è±¡æˆ–è€…å·¥å‚æ–¹æ³•ï¼Œä¸ºä½¿ç”¨è€…éšè—äº†å¯¹è±¡åˆ›å»ºçš„ç»†èŠ‚ï¼›æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å¯¹å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¼˜åŒ–ï¼Œé€šè¿‡ä¸ºå·¥å‚å¯¹è±¡æ–°å¢ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè®©å·¥å‚å¯¹è±¡éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œä¹Ÿé¿å…äº†éœ°å¼¹å¼ä¿®æ”¹ï¼›åŸå‹æ¨¡å¼åˆ™è®©å¯¹è±¡å¤åˆ¶æ›´åŠ ç®€å•ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œå°†ä»‹ç»23ç§è®¾è®¡æ¨¡å¼ä¸­çš„7ç§ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternï¼‰ï¼ŒåŠå…¶Goè¯­è¨€çš„å®ç°ã€‚ ","link":"https://ChicRingo.github.io/post/shi-yong-go-shi-xian-gof-de-23-chong-she-ji-mo-shi-yi/"},{"title":"ç”¨ golang å®ç°çš„åå¤§ç»å…¸æ’åº","content":"ç”¨goè¯­è¨€å®ç°çš„åå¤§ç»å…¸æ’åº å†’æ³¡æ’åº // å†’æ³¡æ’åº func bubble(nums []int) []int { numLen := len(nums) for i := 0; i &lt; numLen; i++ { // æŒ‰ç›¸é‚»ä¸¤ä¸ªä¸€èµ·æ¯”è¾ƒï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªä¸ç”¨éå† -1,å·²ç»æ’åºçš„ä¹Ÿä¸ç”¨é‡æ–°æ’åºï¼Œæ‰€ä»¥-iï¼Œä¸å†™ä¹Ÿå¯ for j := 0; j &lt; numLen-1-i; j++ { // å½“å‰å€¼å¤§äºåä¸€ä¸ªå€¼ï¼Œåˆ™å¯¹æ¢ä½ç½® if nums[j] &gt; nums[j+1] { nums[j], nums[j+1] = nums[j+1], nums[j] } } } return nums } é€‰æ‹©æ’åº func selection(nums []int) []int { numLen := len(nums) //æœ€åä¸€ä¸ªä¸ç”¨æ’åºäº† for i := 0; i &lt; numLen-1; i++ { //æ¯æ¬¡æœ€å°å€¼çš„ä½ç½®index var minIndex = i // ä»ç¬¬äºŒä¸ªå¼€å§‹æ’åºï¼Œä¹Ÿå°±æ˜¯i+1 for j := i + 1; j &lt; numLen; j++ { if nums[j] &lt; nums[minIndex] { minIndex = j } } nums[i], nums[minIndex] = nums[minIndex], nums[i] } return nums } æ’å…¥æ’åº func insertion(nums []int) []int { // ç½‘ä¸Šå†™æ³• for i, tmp := range nums { // å‰ä¸€ä¸ªç´¢å¼•å€¼ preIndex := i - 1 // å®šä¹‰ä¸€ä¸ªä¸´æ—¶å˜é‡å–å½“å‰çš„å€¼ï¼ˆæŒ–å‡ºæ¥è…¾åœ°æ–¹ï¼Œç»™å‰é¢çš„å¾€åæŒªä½ç½®çš„ç©ºé—´ //tmp := nums[i] // å¦‚æœå½“å‰å€¼ tmp å°äºå‰é¢çš„å€¼ï¼Œå°±æŠŠå‰é¢çš„å€¼å¾€åæŒªï¼Œå› ä¸ºtmpå·²ç»ä¿å­˜è¿‡ç›¸å½“äºç©ºçš„ for preIndex &gt;= 0 &amp;&amp; tmp &lt; nums[preIndex] { nums[preIndex+1] = nums[preIndex] preIndex-- } // ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶æ—¶ï¼Œè¯´æ˜æ²¡æœ‰æ¯”tmpæ›´å°çš„ï¼Œå°±ä¿å­˜tmpå½“å‰å€¼åˆ°æ–°çš„ä½ç½® nums[preIndex+1] = tmp } // è‡ªå·±å†™æ³• //numLen := len(nums) //for i := 1; i &lt; numLen; i++ { //ä»ç¬¬2ä¸ªå¼€å§‹ï¼Œi=1å¼€å§‹ // // temp := nums[i] // å®šä¹‰ä¸€ä¸ªä¸´æ—¶å˜é‡å–å½“å‰çš„å€¼ // // æŠŠè¯¥å€¼tmpä¸ä¹‹å‰çš„æ•° ä»åå¾€å‰è¿›è¡Œæ¯”è¾ƒ // for j := i - 1; j &gt;= 0; j-- { // // å½“ å½“å‰å€¼tmp æ¯”ä¹‹å‰çš„æŸä¸ªå€¼å¤§,é‚£ä¹ˆæ’å…¥,å¦åˆ™æŠŠæ¯ä¸ªå€¼å¾€åç§»ä¸€ä½ // if temp &gt; nums[j] { // nums[j+1] = temp // break // } else { // nums[j+1] = nums[j] // } // // å¦‚æœéƒ½ç§»åŠ¨äº†,ç„¶åéå†åˆ°0äº†,è¯´æ˜å½“å‰å€¼æ˜¯æœ€å°çš„,æŠŠå½“å‰å€¼æ”¾åˆ°æœ€å°çš„ä½ç½® // if j == 0 { // nums[0] = temp // } // } //} return nums } å¸Œå°”æ’åº å½’å¹¶æ’åº å¿«é€Ÿæ’åº func partition(nums []int, left, right int) int { // è®¾åŸºå‡†å€¼ privot ä¸ºleft privot := left index := privot + 1 for i := index; i &lt;= right; i++ { if nums[i] &lt; nums[privot] { nums[i], nums[index] = nums[index], nums[i] index++ } } nums[privot], nums[index-1] = nums[index-1], nums[privot] return index - 1 } func quickSort(nums []int, left, right int) { // å¦‚æœæ•°ç»„é•¿åº¦å°äºç­‰äº1ï¼Œè¯´æ˜è¿™ä¸ªæ•°ç»„åˆ†åŒºä¸éœ€è¦å†æ’åºäº†ï¼Œç›´æ¥return if len(nums) &lt;= 1 { return } // å¦‚æœå·¦å°äºå³ï¼Œ if left &lt; right { partIndex := partition(nums, left, right) quickSort(nums, left, partIndex-1) quickSort(nums, partIndex+1, right) } return } å †æ’åº ","link":"https://ChicRingo.github.io/post/yong-golang-shi-xian-de-shi-da-jing-dian-pai-xu/"},{"title":"æˆ‘æ“¦~å­—ç¬¦ä¸²è½¬å­—èŠ‚åˆ‡ç‰‡åï¼Œåˆ‡ç‰‡çš„å®¹é‡ç«Ÿç„¶åƒå¥‡ç™¾æ€ª","content":"å­—ç¬¦ä¸²è½¬å­—èŠ‚åˆ‡ç‰‡æ­¥éª¤å¦‚ä¸‹ åˆ¤æ–­æ˜¯å¦æ˜¯å¸¸é‡ï¼Œ å¦‚æœæ˜¯å¸¸é‡åˆ™è½¬æ¢ä¸ºç­‰å®¹é‡ç­‰é•¿çš„å­—èŠ‚åˆ‡ç‰‡ å¦‚æœæ˜¯å˜é‡ï¼Œ å…ˆåˆ¤æ–­ç”Ÿæˆçš„åˆ‡ç‰‡æ˜¯å¦å‘ç”Ÿå˜é‡é€ƒé€¸ å¦‚æœé€ƒé€¸æˆ–è€…å­—ç¬¦ä¸²é•¿åº¦&gt;32ï¼Œ åˆ™æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦å¯ä»¥è®¡ç®—å‡ºä¸åŒçš„å®¹é‡ å¦‚æœæœªé€ƒé€¸ä¸”å­—ç¬¦ä¸²é•¿åº¦&lt;=32, åˆ™å­—ç¬¦åˆ‡ç‰‡å®¹é‡ä¸º32 ä»¥ä¸‹æ–‡ç« æ¥æºäºæ–°ä¸–ç•Œæ‚è´§é“º ï¼Œä½œè€…è®¸æ–‡ æ–°ä¸–ç•Œæ‚è´§é“ºä½œä¸ºä¸€åGopherï¼Œ æˆ‘æ„¿ç§°ä¹‹ä¸ºGoçš„å¹²(æ‚)è´§é“ºå­ï¼ ç¥å¥‡çš„ç°è±¡ åˆ‡ç‰‡ï¼Œ åˆ‡ç‰‡ï¼Œ åˆæ˜¯åˆ‡ç‰‡! ä»Šå¤©é‡åˆ°çš„ç¥å¥‡é—®é¢˜å’Œåˆ‡ç‰‡æœ‰å…³ï¼Œ å…·ä½“æ€ä¹ˆä¸ªç¥å¥‡æ³•ï¼Œ æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢å‡ ä¸ªç°è±¡ ç°è±¡ä¸€ a := &quot;abc&quot; bs := []byte(a) fmt.Println(bs, len(bs), cap(bs)) // è¾“å‡ºï¼š [97 98 99] 3 8 ç°è±¡äºŒ a := &quot;abc&quot; bs := []byte(a) fmt.Println(len(bs), cap(bs)) // è¾“å‡º: 3 32 ç°è±¡ä¸‰ bs := []byte(&quot;abc&quot;) fmt.Println(len(bs), cap(bs)) // è¾“å‡º: 3 3 ç°è±¡å›› a := &quot;&quot; bs := []byte(a) fmt.Println(bs, len(bs), cap(bs)) // è¾“å‡º: [] 0 0 ç°è±¡äº” a := &quot;&quot; bs := []byte(a) fmt.Println(len(bs), cap(bs)) // è¾“å‡º: 0 32 åˆ†æ åˆ°è¿™å„¿æˆ‘å·²ç»æ»¡è„‘å­é—®å·äº† å­—ç¬¦ä¸²å˜é‡è½¬åˆ‡ç‰‡ ä¸€ä¸ªå°å°çš„å­—ç¬¦ä¸²è½¬åˆ‡ç‰‡ï¼Œ å†…éƒ¨ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Œ ç«Ÿç„¶å¦‚æ­¤çš„ç¥å¥‡ã€‚è¿™ç§æ—¶å€™åªå¥½ç¥­å‡ºæ±‡ç¼–å¤§æ³•ï¼Œ çœ‹çœ‹æ±‡ç¼–ä»£ç (å¸Œæœ›ä¹‹åæœ‰æœºä¼šèƒ½å¤Ÿå¯¹goçš„æ±‡ç¼–è¯­æ³•è¿›è¡Œç®€å•çš„ä»‹ç»)æœ‰æ²¡æœ‰ä»€ä¹ˆå…³é”®è¯èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ ä»¥ä¸‹ä¸ºç°è±¡ä¸€è½¬æ¢çš„æ±‡ç¼–ä»£ç å…³é”®éƒ¨åˆ† &quot;&quot;.main STEXT size=495 args=0x0 locals=0xd8 0x0000 00000 (test.go:5) TEXT &quot;&quot;.main(SB), ABIInternal, $216-0 0x0000 00000 (test.go:5) MOVQ (TLS), CX 0x0009 00009 (test.go:5) LEAQ -88(SP), AX 0x000e 00014 (test.go:5) CMPQ AX, 16(CX) 0x0012 00018 (test.go:5) JLS 485 0x0018 00024 (test.go:5) SUBQ $216, SP 0x001f 00031 (test.go:5) MOVQ BP, 208(SP) 0x0027 00039 (test.go:5) LEAQ 208(SP), BP 0x002f 00047 (test.go:5) FUNCDATA $0, gclocalsÂ·7be4bbacbfdb05fb3044e36c22b41e8b(SB) 0x002f 00047 (test.go:5) FUNCDATA $1, gclocalsÂ·648d0b72bb9d7f59fbfdbee57a078eee(SB) 0x002f 00047 (test.go:5) FUNCDATA $2, gclocalsÂ·2dfddcc7190380b1ae77e69d81f0a101(SB) 0x002f 00047 (test.go:5) FUNCDATA $3, &quot;&quot;.main.stkobj(SB) 0x002f 00047 (test.go:6) PCDATA $0, $1 0x002f 00047 (test.go:6) PCDATA $1, $0 0x002f 00047 (test.go:6) LEAQ go.string.&quot;abc&quot;(SB), AX 0x0036 00054 (test.go:6) MOVQ AX, &quot;&quot;.a+96(SP) 0x003b 00059 (test.go:6) MOVQ $3, &quot;&quot;.a+104(SP) 0x0044 00068 (test.go:7) MOVQ $0, (SP) 0x004c 00076 (test.go:7) PCDATA $0, $0 0x004c 00076 (test.go:7) MOVQ AX, 8(SP) 0x0051 00081 (test.go:7) MOVQ $3, 16(SP) 0x005a 00090 (test.go:7) CALL runtime.stringtoslicebyte(SB) 0x005f 00095 (test.go:7) MOVQ 40(SP), AX 0x0064 00100 (test.go:7) MOVQ 32(SP), CX 0x0069 00105 (test.go:7) PCDATA $0, $2 0x0069 00105 (test.go:7) MOVQ 24(SP), DX 0x006e 00110 (test.go:7) PCDATA $0, $0 0x006e 00110 (test.go:7) PCDATA $1, $1 0x006e 00110 (test.go:7) MOVQ DX, &quot;&quot;.bs+112(SP) 0x0073 00115 (test.go:7) MOVQ CX, &quot;&quot;.bs+120(SP) 0x0078 00120 (test.go:7) MOVQ AX, &quot;&quot;.bs+128(SP) ä»¥ä¸‹ä¸ºç°è±¡äºŒè½¬æ¢çš„æ±‡ç¼–ä»£ç å…³é”®éƒ¨åˆ† &quot;&quot;.main STEXT size=393 args=0x0 locals=0xe0 0x0000 00000 (test.go:5) TEXT &quot;&quot;.main(SB), ABIInternal, $224-0 0x0000 00000 (test.go:5) MOVQ (TLS), CX 0x0009 00009 (test.go:5) LEAQ -96(SP), AX 0x000e 00014 (test.go:5) CMPQ AX, 16(CX) 0x0012 00018 (test.go:5) JLS 383 0x0018 00024 (test.go:5) SUBQ $224, SP 0x001f 00031 (test.go:5) MOVQ BP, 216(SP) 0x0027 00039 (test.go:5) LEAQ 216(SP), BP 0x002f 00047 (test.go:5) FUNCDATA $0, gclocalsÂ·0ce64bbc7cfa5ef04d41c861de81a3d7(SB) 0x002f 00047 (test.go:5) FUNCDATA $1, gclocalsÂ·00590b99cfcd6d71bbbc6e05cb4f8bf8(SB) 0x002f 00047 (test.go:5) FUNCDATA $2, gclocalsÂ·8dcadbff7c52509cfe2d26e4d7d24689(SB) 0x002f 00047 (test.go:5) FUNCDATA $3, &quot;&quot;.main.stkobj(SB) 0x002f 00047 (test.go:6) PCDATA $0, $1 0x002f 00047 (test.go:6) PCDATA $1, $0 0x002f 00047 (test.go:6) LEAQ go.string.&quot;abc&quot;(SB), AX 0x0036 00054 (test.go:6) MOVQ AX, &quot;&quot;.a+120(SP) 0x003b 00059 (test.go:6) MOVQ $3, &quot;&quot;.a+128(SP) 0x0047 00071 (test.go:7) PCDATA $0, $2 0x0047 00071 (test.go:7) LEAQ &quot;&quot;..autotmp_5+64(SP), CX 0x004c 00076 (test.go:7) PCDATA $0, $1 0x004c 00076 (test.go:7) MOVQ CX, (SP) 0x0050 00080 (test.go:7) PCDATA $0, $0 0x0050 00080 (test.go:7) MOVQ AX, 8(SP) 0x0055 00085 (test.go:7) MOVQ $3, 16(SP) 0x005e 00094 (test.go:7) CALL runtime.stringtoslicebyte(SB) 0x0063 00099 (test.go:7) MOVQ 40(SP), AX 0x0068 00104 (test.go:7) MOVQ 32(SP), CX 0x006d 00109 (test.go:7) PCDATA $0, $3 0x006d 00109 (test.go:7) MOVQ 24(SP), DX 0x0072 00114 (test.go:7) PCDATA $0, $0 0x0072 00114 (test.go:7) PCDATA $1, $1 0x0072 00114 (test.go:7) MOVQ DX, &quot;&quot;.bs+136(SP) 0x007a 00122 (test.go:7) MOVQ CX, &quot;&quot;.bs+144(SP) 0x0082 00130 (test.go:7) MOVQ AX, &quot;&quot;.bs+152(SP) åœ¨çœ‹æ±‡ç¼–ä»£ç ä¹‹å‰ï¼Œ æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€çœ‹runtime.stringtoslicebyteçš„å‡½æ•°ç­¾å func stringtoslicebyte(buf *tmpBuf, s string) []byte åˆ°è¿™é‡Œåªé å…³é”®è¯å·²ç»æ— æ³•çœ‹å‡ºæ›´å¤šçš„ä¿¡æ¯äº†,è¿˜æ˜¯éœ€è¦ç¨å¾®äº†è§£ä¸€ä¸‹æ±‡ç¼–çš„è¯­æ³•,ç¬”è€…åœ¨è¿™é‡Œåˆ—å‡ºä¸€ç‚¹ç®€å•çš„åˆ†æï¼Œ ä¹‹åæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡å–å·§çš„æ–¹æ³•å‘ç°æ›´å¤šçš„ä¸œè¥¿ // ç°è±¡ä¸€ç»™runtime.stringtoslicebyteçš„ä¼ å‚ 0x002f 00047 (test.go:6) LEAQ go.string.&quot;abc&quot;(SB), AX // å°†å­—ç¬¦ä¸²&quot;abc&quot;æ”¾å…¥å¯„å­˜å™¨AX 0x0036 00054 (test.go:6) MOVQ AX, &quot;&quot;.a+96(SP) // å°†AXä¸­çš„å†…å®¹å­˜å…¥å˜é‡aä¸­ 0x003b 00059 (test.go:6) MOVQ $3, &quot;&quot;.a+104(SP) // å°†å­—ç¬¦ä¸²é•¿åº¦3å­˜å…¥å˜é‡aä¸­ 0x0044 00068 (test.go:7) MOVQ $0, (SP) // å°†0 ä¼ é€’ä¸ªruntime.stringtoslicebyte(SB)çš„ç¬¬ä¸€ä¸ªå‚æ•°(ç¬”è€…çŒœæµ‹å¯¹åº”goä¸­çš„nil) 0x004c 00076 (test.go:7) PCDATA $0, $0 // æ®è¯´å’Œgcæœ‰å…³ï¼Œ å…·ä½“è¿˜ä¸æ¸…æ¥šï¼Œ ä¸€èˆ¬æƒ…å†µå¯ä»¥å¿½ç•¥ 0x004c 00076 (test.go:7) MOVQ AX, 8(SP) // å°†AXä¸­çš„å†…å®¹ä¼ é€’ç»™runtime.stringtoslicebyte(SB)çš„ç¬¬äºŒä¸ªå‚æ•° 0x0051 00081 (test.go:7) MOVQ $3, 16(SP) // å°†å­—ç¬¦ä¸²é•¿åº¦ä¼ é€’ç»™runtime.stringtoslicebyte(SB)çš„ç¬¬äºŒä¸ªå‚æ•° 0x005a 00090 (test.go:7) CALL runtime.stringtoslicebyte(SB) // è°ƒç”¨å‡½æ•°ï¼Œ æ­¤è¡Œåé¢çš„å‡ è¡Œä»£ç æ˜¯å°†è¿”å›å€¼èµ‹å€¼ç»™å˜é‡bs // ç°è±¡äºŒç»™runtime.stringtoslicebyteçš„ä¼ å‚ 0x002f 00047 (test.go:6) LEAQ go.string.&quot;abc&quot;(SB), AX // å°†å­—ç¬¦ä¸²&quot;abc&quot;æ”¾å…¥å¯„å­˜å™¨AX 0x0036 00054 (test.go:6) MOVQ AX, &quot;&quot;.a+120(SP) // å°†AXä¸­çš„å†…å®¹å­˜å…¥å˜é‡aä¸­ 0x003b 00059 (test.go:6) MOVQ $3, &quot;&quot;.a+128(SP) // å°†å­—ç¬¦ä¸²é•¿åº¦3å­˜å…¥å˜é‡aä¸­ 0x0047 00071 (test.go:7) PCDATA $0, $2 0x0047 00071 (test.go:7) LEAQ &quot;&quot;..autotmp_5+64(SP), CX // å°†å†…éƒ¨å˜é‡autotmp_5æ”¾å…¥å¯„å­˜å™¨CX 0x004c 00076 (test.go:7) PCDATA $0, $1 0x004c 00076 (test.go:7) MOVQ CX, (SP) // å°†CXä¸­çš„å†…å®¹ä¼ é€’ç»™runtime.stringtoslicebyte(SB)çš„ç¬¬ä¸€ä¸ªå‚æ•° 0x0050 00080 (test.go:7) PCDATA $0, $0 0x0050 00080 (test.go:7) MOVQ AX, 8(SP) // å°†AXä¸­çš„å†…å®¹ä¼ é€’ç»™runtime.stringtoslicebyte(SB)çš„ç¬¬äºŒä¸ªå‚æ•° 0x0055 00085 (test.go:7) MOVQ $3, 16(SP) // å°†å­—ç¬¦ä¸²é•¿åº¦ä¼ é€’ç»™runtime.stringtoslicebyte(SB)çš„ç¬¬äºŒä¸ªå‚æ•° 0x005e 00094 (test.go:7) CALL runtime.stringtoslicebyte(SB) é€šè¿‡ä¸Šé¢æ±‡ç¼–ä»£ç çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œç°è±¡ä¸€å’Œç°è±¡äºŒçš„åŒºåˆ«å°±æ˜¯ä¼ é€’ç»™runtime.stringtoslicebyteçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸åŒã€‚é€šè¿‡å¯¹runtimeåŒ…ä¸­stringtoslicebyteå‡½æ•°åˆ†æï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦æœ‰å€¼å’Œå­—ç¬¦ä¸²é•¿åº¦ä¼šå½±å“ä»£ç æ‰§è¡Œçš„åˆ†æ”¯ï¼Œä»è€Œç”Ÿæˆä¸åŒçš„åˆ‡ç‰‡ï¼Œ å› æ­¤å®¹é‡ä¸ä¸€æ ·ä¹Ÿæ˜¯å¸¸ç†ä¹‹ä¸­ï¼Œ ä¸‹é¢æˆ‘ä»¬çœ‹æºç  func stringtoslicebyte(buf *tmpBuf, s string) []byte { var b []byte if buf != nil &amp;&amp; len(s) &lt;= len(buf) { *buf = tmpBuf{} b = buf[:len(s)] } else { b = rawbyteslice(len(s)) } copy(b, s) return b } ç„¶è€Œï¼Œ stringtoslicebyteçš„ç¬¬ä¸€ä¸ªå‚æ•°ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šæœ‰å€¼ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¸ºnil, æˆ‘ä»¬ä»ç„¶ä¸æ¸…æ¥šã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Œ åªå¥½ç¥­å‡ºå…¨å±€æœç´¢å¤§æ³•ï¼š # åœ¨goæºç æ ¹ç›®å½•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ grep stringtoslicebyte -r . | grep -v &quot;//&quot; æœ€ç»ˆåœ¨goçš„ç¼–è¯‘å™¨æºç cmd/compile/internal/gc/walk.goå‘ç°äº†å¦‚ä¸‹ä»£ç å— æˆ‘ä»¬æŸ¥çœ‹mkcall å‡½æ•°ç­¾åå¯ä»¥çŸ¥é“, ä»ç¬¬å››ä¸ªå‚æ•°å¼€å§‹çš„æ‰€æœ‰å˜é‡éƒ½ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ç¬¬ä¸€ä¸ªå‚æ•°å¯¹åº”çš„å‡½æ•°ï¼Œ æœ€åç”Ÿæˆä¸€ä¸ª*Nodeçš„å˜é‡ã€‚å…¶ä¸­Nodeç»“æ„ä½“è§£é‡Šå¦‚ä¸‹: // A Node is a single node in the syntax tree. // Actually the syntax tree is a syntax DAG, because there is only one // node with Op=ONAME for a given instance of a variable x. // The same is true for Op=OTYPE and Op=OLITERAL. See Node.mayBeShared. ç»¼åˆä¸Šè¿°ä¿¡æ¯æˆ‘ä»¬å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œç¼–è¯‘å™¨ä¼šå¯¹stringtoslicebyteçš„å‡½æ•°è°ƒç”¨ç”Ÿæˆä¸€ä¸ªAST(æŠ½è±¡è¯­æ³•æ ‘)å¯¹åº”çš„èŠ‚ç‚¹ã€‚å› æ­¤æˆ‘ä»¬ä¹ŸçŸ¥é“ä¼ é€’ç»™stringtoslicebyteå‡½æ•°çš„ç¬¬ä¸€ä¸ªå˜é‡ä¹Ÿå°±å¯¹åº”äºä¸Šå›¾ä¸­çš„å˜é‡a. å…¶ä¸­açš„åˆå§‹å€¼ä¸ºnodnil()çš„è¿”å›å€¼ï¼Œå³é»˜è®¤ä¸ºnil. ä½†æ˜¯n.Esc == EscNoneæ—¶ï¼Œaä¼šå˜æˆä¸€ä¸ªæ•°ç»„ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹EscNoneçš„è§£é‡Š. // æ­¤ä»£ç ä½äºcmd/compile/internal/gc/esc.goä¸­ const ( // ... EscNone // Does not escape to heap, result, or parameters. ... ) ç”±ä¸Šå¯çŸ¥, EscNoneç”¨æ¥åˆ¤æ–­å˜é‡æ˜¯å¦é€ƒé€¸,åˆ°è¿™å„¿äº†æˆ‘ä»¬å°±å¾ˆå¥½åŠäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ç°è±¡ä¸€å’Œç°è±¡äºŒçš„ä»£ç è¿›è¡Œé€ƒé€¸åˆ†æ. # æ‰§è¡Œå˜é‡é€ƒé€¸åˆ†æå‘½ä»¤: go run -gcflags '-m -l' test.go # ç°è±¡ä¸€é€ƒé€¸åˆ†æå¦‚ä¸‹ï¼š ./test.go:7:14: ([]byte)(a) escapes to heap ./test.go:8:13: main ... argument does not escape ./test.go:8:13: bs escapes to heap ./test.go:8:21: len(bs) escapes to heap ./test.go:8:30: cap(bs) escapes to heap [97 98 99] 3 8 # ç°è±¡äºŒé€ƒé€¸åˆ†æå¦‚ä¸‹ï¼š ./test.go:7:14: main ([]byte)(a) does not escape ./test.go:8:13: main ... argument does not escape ./test.go:8:17: len(bs) escapes to heap ./test.go:8:26: cap(bs) escapes to heap 3 32 æ ¹æ®ä¸Šé¢çš„ä¿¡æ¯æˆ‘ä»¬çŸ¥é“åœ¨ç°è±¡ä¸€ä¸­ï¼Œbså˜é‡å‘ç”Ÿäº†é€ƒé€¸ï¼Œç°è±¡äºŒä¸­å˜é‡æœªå‘ç”Ÿé€ƒé€¸ï¼Œä¹Ÿå°±æ˜¯è¯´stringtoslicebyteå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°åœ¨å˜é‡æœªå‘ç”Ÿé€ƒé€¸æ—¶å…¶å€¼ä¸ä¸ºnil,å˜é‡å‘ç”Ÿé€ƒé€¸æ—¶å…¶å€¼ä¸ºnilã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»ææ˜ç™½stringtoslicebyteçš„ç¬¬ä¸€ä¸ªå‚æ•°äº†ï¼Œ é‚£æˆ‘ä»¬ç»§ç»­åˆ†æstringtoslicebyteçš„å†…éƒ¨é€»è¾‘ æˆ‘ä»¬åœ¨runtime/string.goä¸­çœ‹åˆ°stringtoslicebyteç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š const tmpStringBufSize = 32 type tmpBuf [tmpStringBufSize]byte ç»¼ä¸Š: ç°è±¡äºŒä¸­bså˜é‡æœªå‘ç”Ÿå˜é‡é€ƒé€¸, stringtoslicebyteç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¸ºç©ºä¸”æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º32çš„byteæ•°ç»„, å› æ­¤åœ¨ç°è±¡äºŒä¸­ç”Ÿæˆäº†ä¸€ä¸ªå®¹é‡ä¸º32çš„åˆ‡ç‰‡ æ ¹æ®å¯¹stringtoslicebyteçš„æºç åˆ†æï¼Œ æˆ‘ä»¬çŸ¥é“ç°è±¡ä¸€è°ƒç”¨äº†rawbytesliceå‡½æ•° func rawbyteslice(size int) (b []byte) { cap := roundupsize(uintptr(size)) p := mallocgc(cap, nil, false) if cap != uintptr(size) { memclrNoHeapPointers(add(p, uintptr(size)), cap-uintptr(size)) } *(*slice)(unsafe.Pointer(&amp;b)) = slice{p, size, int(cap)} return } ç”±ä¸Šé¢çš„ä»£ç çŸ¥é“ï¼Œ åˆ‡ç‰‡çš„å®¹é‡é€šè¿‡runtime/msize.goä¸­çš„roundupsizeå‡½æ•°è®¡ç®—å¾—å‡º, å…¶ä¸­_MaxSmallSizeå’Œclass_to_sizeå‡å®šä¹‰åœ¨runtime/sizeclasses.go func roundupsize(size uintptr) uintptr { if size &lt; _MaxSmallSize { if size &lt;= smallSizeMax-8 { return uintptr(class_to_size[size_to_class8[(size+smallSizeDiv-1)/smallSizeDiv]]) } else { return uintptr(class_to_size[size_to_class128[(size-smallSizeMax+largeSizeDiv-1)/largeSizeDiv]]) } } if size+_PageSize &lt; size { return size } return round(size, _PageSize) } ç”±äºå­—ç¬¦ä¸²abcçš„é•¿åº¦å°äº_MaxSmallSize(32768)ï¼Œæ•…åˆ‡ç‰‡çš„é•¿åº¦åªèƒ½å–æ•°ç»„class_to_sizeä¸­çš„å€¼ï¼Œ å³0, 8, 16, 32, 48, 64, 80, 96, 112, 128....s è‡³æ­¤, ç°è±¡ä¸€ä¸­åˆ‡ç‰‡å®¹é‡ä¸ºä»€ä¹ˆä¸º8ä¹ŸçœŸç›¸å¤§ç™½äº†ã€‚ç›¸ä¿¡åˆ°è¿™é‡Œå¾ˆå¤šäººå·²ç»æ˜ç™½ç°è±¡å››å’Œç°è±¡äº”æ˜¯æ€ä¹ˆå›äº‹å„¿äº†, å…¶é€»è¾‘åˆ†åˆ«ä¸ç°è±¡ä¸€å’Œç°è±¡äºŒæ˜¯ä¸€è‡´çš„ï¼Œ æœ‰å…´è¶£çš„ï¼Œ å¯ä»¥åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šé¢è¯•ä¸€è¯•ã€‚ å­—ç¬¦ä¸²ç›´æ¥è½¬åˆ‡ç‰‡ é‚£ä½ è¯´äº†è¿™ä¹ˆå¤šï¼Œ ç°è±¡ä¸‰è¿˜æ˜¯ä¸èƒ½è§£é‡Šå•Šã€‚è¯·å„ä½çœ‹å®˜è«æ€¥ï¼Œ æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æã€‚ ç›¸ä¿¡å„ä½ç»†å¿ƒçš„å°ä¼™ä¼´åº”è¯¥æ—©å°±å‘ç°äº†æˆ‘ä»¬åœ¨ä¸Šé¢çš„cmd/compile/internal/gc/walk.goæºç å›¾ä¸­æŠ˜å äº†éƒ¨åˆ†ä»£ç ï¼Œ ç°åœ¨æˆ‘ä»¬å°±å°†è¿™å—ç¥ç§˜çš„ä»£ç èµ¤è£¸è£¸çš„å±•ç¤ºå‡ºæ¥ æˆ‘ä»¬åˆ†æè¿™å—ä»£ç å‘ç°,goç¼–è¯‘å™¨åœ¨å°†å­—ç¬¦ä¸²è½¬å­—èŠ‚åˆ‡ç‰‡ç”ŸæˆASTæ—¶ï¼Œæ€»å…±åˆ†ä¸ºä¸‰æ­¥ã€‚ å…ˆåˆ¤æ–­è¯¥å˜é‡æ˜¯å¦æ˜¯å¸¸é‡å­—ç¬¦ä¸²,å¦‚æœæ˜¯å¸¸é‡å­—ç¬¦ä¸²,åˆ™ç›´æ¥é€šè¿‡types.NewArrayåˆ›å»ºä¸€ä¸ªå’Œå­—ç¬¦ä¸²ç­‰é•¿çš„æ•°ç»„ å¸¸é‡å­—ç¬¦ä¸²ç”Ÿæˆçš„åˆ‡ç‰‡å˜é‡ä¹Ÿè¦è¿›è¡Œé€ƒé€¸åˆ†æï¼Œå¹¶åˆ¤æ–­å…¶å¤§å°æ˜¯å¦å¤§äºå‡½æ•°æ ˆå…è®¸åˆ†é…ç»™å˜é‡çš„æœ€å¤§é•¿åº¦ï¼Œ ä»è€Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯åˆ†é…åœ¨æ ˆä¸Šè¿˜æ˜¯åœ¨å †ä¸Š æœ€åï¼Œå¦‚æœå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¤§äº0ï¼Œ å°†å­—ç¬¦ä¸²å†…å®¹å¤åˆ¶åˆ°å­—èŠ‚åˆ‡ç‰‡ä¸­ï¼Œ ç„¶åè¿”å›ã€‚å› æ­¤ç°è±¡ä¸‰ä¸­çš„åˆ‡ç‰‡å®¹é‡æ˜¯3ä¹Ÿå°±å®Œå…¨æ¸…æ¥šäº† ç»“è®º å­—ç¬¦ä¸²è½¬å­—èŠ‚åˆ‡ç‰‡æ­¥éª¤å¦‚ä¸‹ åˆ¤æ–­æ˜¯å¦æ˜¯å¸¸é‡ï¼Œ å¦‚æœæ˜¯å¸¸é‡åˆ™è½¬æ¢ä¸ºç­‰å®¹é‡ç­‰é•¿çš„å­—èŠ‚åˆ‡ç‰‡ å¦‚æœæ˜¯å˜é‡ï¼Œ å…ˆåˆ¤æ–­ç”Ÿæˆçš„åˆ‡ç‰‡æ˜¯å¦å‘ç”Ÿå˜é‡é€ƒé€¸ å¦‚æœé€ƒé€¸æˆ–è€…å­—ç¬¦ä¸²é•¿åº¦&gt;32ï¼Œ åˆ™æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦å¯ä»¥è®¡ç®—å‡ºä¸åŒçš„å®¹é‡ å¦‚æœæœªé€ƒé€¸ä¸”å­—ç¬¦ä¸²é•¿åº¦&lt;=32, åˆ™å­—ç¬¦åˆ‡ç‰‡å®¹é‡ä¸º32 æ‰©å±• å¸¸è§é€ƒé€¸æƒ…å†µ å‡½æ•°è¿”å›å±€éƒ¨æŒ‡é’ˆ æ ˆç©ºé—´ä¸è¶³é€ƒé€¸ åŠ¨æ€ç±»å‹é€ƒé€¸, å¾ˆå¤šå‡½æ•°å‚æ•°ä¸ºinterfaceç±»å‹ï¼Œæ¯”å¦‚fmt.Println(a ...interface{})ï¼Œç¼–è¯‘æœŸé—´å¾ˆéš¾ç¡®å®šå…¶å‚æ•°çš„å…·ä½“ç±»å‹, ä¹Ÿä¼šå‘ç”Ÿé€ƒé€¸ é—­åŒ…å¼•ç”¨å¯¹è±¡é€ƒé€¸ æ³¨: å†™æœ¬æ–‡æ—¶ï¼Œ ç¬”è€…æ‰€ç”¨goç‰ˆæœ¬ä¸º: go1.13.4 ç”Ÿå‘½ä¸æ¯ï¼Œ æ¢ç´¢ä¸æ­¢ï¼Œ åç»­å°†æŒç»­æ›´æ–°æœ‰å…³äºgoçš„æŠ€æœ¯æ¢ç´¢ ","link":"https://ChicRingo.github.io/post/wo-ca-~zi-fu-chuan-zhuan-zi-jie-qie-pian-hou-qie-pian-de-rong-liang-jing-ran-qian-qi-bai-guai/"},{"title":"ä½¿ç”¨ Hugo æ­å»ºåšå®¢","content":"https://www.diguage.com/post/building-blog-with-hugo/ ","link":"https://ChicRingo.github.io/post/shi-yong-hugo-da-jian-bo-ke/"},{"title":"ä½¿ç”¨2ä¸ªgoroutineè½®æµæ‰“å°ä¸€ä¸ªæ•°ç»„","content":"ä»Šå¤©é‡åˆ°ç¾¤å‹çš„ä¸€åˆ°é¢è¯•é¢˜ï¼Œæ„Ÿè§‰åœ¨å„ç§åœ°æ–¹çœ‹åˆ°å¾ˆå¤šæ¬¡è¿™ç§ç±»ä¼¼çš„é¢˜ç›®ï¼Œæ¯”å¦‚ä¸¤ä¸ªgoroutineè½®æµæ‰“å°å¥‡å¶æ•°ï¼Œæ‰€ä»¥è®°å½•æ•´ç†ä¸‹æ¥ã€‚ package main import ( &quot;fmt&quot; &quot;sync&quot; ) // ä½¿ç”¨2ä¸ªgoroutineè½®æµæ‰“å°ä¸€ä¸ªæ•°ç»„ var wg sync.WaitGroup var ch = make(chan bool) var send = make(chan int) func main() { wg.Add(3) nums := []int{1, 2, 3, 4, 5, 6, 7, 8, 9} l := len(nums) go Send(nums, l) // å‘é€ go printOdd(l) // æ‰“å°å¥‡æ•° go printEven(l) // æ‰“å°å¶æ•° wg.Wait() } // å‘é€æ•°ç»„å…ƒç´  func Send(nums []int, l int) { defer wg.Done() for i := 0; i &lt; l; i++ { a := nums[i] send &lt;- a } } // æ‰“å°å¥‡æ•° func printEven(l int) { defer wg.Done() for i := 0; i &lt; l; i++ { ch &lt;- true if i&amp;1 == 0 { a := &lt;-send fmt.Println(&quot;printEven:&quot;, a) } } } // æ‰“å°å¶æ•° func printOdd(l int) { defer wg.Done() for i := 0; i &lt; l; i++ { &lt;-ch if i&amp;1 == 1 { a := &lt;-send fmt.Println(&quot;printOdd: &quot;, a) } } } ","link":"https://ChicRingo.github.io/post/shi-yong-2-ge-goroutine-lun-liu-da-yin-yi-ge-shu-zu/"},{"title":"Golang å¹¶å‘æ§åˆ¶çš„ä¸¤ç§æ¨¡å¼","content":"Golang ä¸¤ç§å¸¸ç”¨çš„å¹¶å‘æ§åˆ¶ï¼Œä½¿ç”¨ channel å’Œ WaitGroup ä¸¤ç§æ¨¡å¼ package main import ( &quot;fmt&quot; &quot;sync&quot; &quot;time&quot; ) func main() { fmt.Println(&quot;Hello, ä¸–ç•Œ&quot;) handle1() handle2() } func handle1() { // é€šè¿‡æ— ç¼“å†²é€šé“æ¥å®ç°å¤š goroutine å¹¶å‘æ§åˆ¶ // create channel to synchronize done := make(chan bool) // æ— ç¼“å†²é€šé“ defer close(done) go func() { time.Sleep(1 * time.Second) fmt.Println(&quot;one done&quot;) done &lt;- true }() go func() { time.Sleep(1 * time.Second) fmt.Println(&quot;two done&quot;) done &lt;- true }() // wait until both are done for c := 0; c &lt; 2; c++ { &lt;-done } fmt.Println(&quot;handle1 done&quot;) // å½“ä¸» goroutine è¿è¡Œåˆ° &lt;-done æ¥å— channel çš„å€¼çš„æ—¶å€™ï¼Œå¦‚æœè¯¥ channel ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±ä¼šä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æœ‰å€¼ã€‚ } func handle2() { // é€šè¿‡syncåŒ…ä¸­çš„WaitGroup å®ç°å¹¶å‘æ§åˆ¶ var wg sync.WaitGroup wg.Add(1) go func() { time.Sleep(1 * time.Second) fmt.Println(&quot;1 done&quot;) wg.Done() }() wg.Add(1) go func() { time.Sleep(1 * time.Second) fmt.Println(&quot;2 done&quot;) wg.Done() }() wg.Wait() fmt.Println(&quot;handle2 done&quot;) // åœ¨ sync åŒ…ä¸­ï¼Œæä¾›äº† WaitGroup ï¼Œå®ƒä¼šç­‰å¾…å®ƒæ”¶é›†çš„æ‰€æœ‰ goroutine ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œåœ¨ä¸» goroutine ä¸­ Add(delta int) ç´¢è¦ç­‰å¾…goroutine çš„æ•°é‡ã€‚åœ¨æ¯ä¸€ä¸ª goroutine å®Œæˆå Done() è¡¨ç¤ºè¿™ä¸€ä¸ªgoroutine å·²ç»å®Œæˆï¼Œå½“æ‰€æœ‰çš„ goroutine éƒ½å®Œæˆåï¼Œåœ¨ä¸» goroutine ä¸­ WaitGroup è¿”å›ã€‚ } ","link":"https://ChicRingo.github.io/post/golang-bing-fa-kong-zhi-de-liang-chong-mo-shi/"},{"title":"Golangå¹¶å‘æ¨¡å‹ï¼šå¹¶å‘åç¨‹çš„ä¼˜é›…é€€å‡º","content":"æ–‡ç« æ¥æºï¼šGolangå¹¶å‘æ¨¡å‹ï¼šå¹¶å‘åç¨‹çš„ä¼˜é›…é€€å‡º goroutineä½œä¸ºGolangå¹¶å‘çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬ä¸ä»…è¦å…³æ³¨å®ƒä»¬çš„åˆ›å»ºå’Œç®¡ç†ï¼Œå½“ç„¶è¿˜è¦å…³æ³¨å¦‚ä½•åˆç†çš„é€€å‡ºè¿™äº›åç¨‹ï¼Œä¸ï¼ˆåˆç†ï¼‰é€€å‡ºä¸ç„¶å¯èƒ½ä¼šé€ æˆé˜»å¡ã€panicã€ç¨‹åºè¡Œä¸ºå¼‚å¸¸ã€æ•°æ®ç»“æœä¸æ­£ç¡®ç­‰é—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»ï¼Œå¦‚ä½•åˆç†çš„é€€å‡ºgoroutineï¼Œå‡å°‘è½¯ä»¶bugã€‚ goroutineåœ¨é€€å‡ºæ–¹é¢ï¼Œä¸åƒçº¿ç¨‹å’Œè¿›ç¨‹ï¼Œä¸èƒ½é€šè¿‡æŸç§æ‰‹æ®µå¼ºåˆ¶å…³é—­å®ƒä»¬ï¼Œåªèƒ½ç­‰å¾…goroutineä¸»åŠ¨é€€å‡ºã€‚ä½†ä¹Ÿæ— éœ€ä¸ºé€€å‡ºã€å…³é—­goroutineè€Œçƒ¦æ¼ï¼Œä¸‹é¢å°±ä»‹ç»3ç§ä¼˜é›…é€€å‡ºgoroutineçš„æ–¹æ³•ï¼Œåªè¦é‡‡ç”¨è¿™ç§æœ€ä½³å®è·µå»è®¾è®¡ï¼ŒåŸºæœ¬ä¸Šå°±å¯ä»¥ç¡®ä¿goroutineé€€å‡ºä¸Šä¸ä¼šæœ‰é—®é¢˜ï¼Œå°½æƒ…äº«ç”¨ã€‚ 1ï¼šä½¿ç”¨for-rangeé€€å‡º for-rangeæ˜¯ä½¿ç”¨é¢‘ç‡å¾ˆé«˜çš„ç»“æ„ï¼Œå¸¸ç”¨å®ƒæ¥éå†æ•°æ®ï¼Œrangeèƒ½å¤Ÿæ„ŸçŸ¥channelçš„å…³é—­ï¼Œå½“channelè¢«å‘é€æ•°æ®çš„åç¨‹å…³é—­æ—¶ï¼Œrangeå°±ä¼šç»“æŸï¼Œæ¥ç€é€€å‡ºforå¾ªç¯ã€‚ å®ƒåœ¨å¹¶å‘ä¸­çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼šå½“åç¨‹åªä»1ä¸ªchannelè¯»å–æ•°æ®ï¼Œç„¶åè¿›è¡Œå¤„ç†ï¼Œå¤„ç†ååç¨‹é€€å‡ºã€‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ç¨‹åºï¼Œå½“iné€šé“è¢«å…³é—­æ—¶ï¼Œåç¨‹å¯è‡ªåŠ¨é€€å‡ºã€‚ go func(in &lt;-chan int) { // Using for-range to exit goroutine // range has the ability to detect the close/end of a channel for x := range in { fmt.Printf(&quot;Process %d\\n&quot;, x) } }(inCh) 2ï¼šä½¿ç”¨,oké€€å‡º for-selectä¹Ÿæ˜¯ä½¿ç”¨é¢‘ç‡å¾ˆé«˜çš„ç»“æ„ï¼Œselectæä¾›äº†å¤šè·¯å¤ç”¨çš„èƒ½åŠ›ï¼Œæ‰€ä»¥for-selectå¯ä»¥è®©å‡½æ•°å…·æœ‰æŒç»­å¤šè·¯å¤„ç†å¤šä¸ªchannelçš„èƒ½åŠ›ã€‚ä½†selectæ²¡æœ‰æ„ŸçŸ¥channelçš„å…³é—­ï¼Œè¿™å¼•å‡ºäº†2ä¸ªé—®é¢˜ï¼š ç»§ç»­åœ¨å…³é—­çš„é€šé“ä¸Šè¯»ï¼Œä¼šè¯»åˆ°é€šé“ä¼ è¾“æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œå¦‚æœæ˜¯æŒ‡é’ˆç±»å‹ï¼Œè¯»åˆ°nilï¼Œç»§ç»­å¤„ç†è¿˜ä¼šäº§ç”Ÿnilã€‚ ç»§ç»­åœ¨å…³é—­çš„é€šé“ä¸Šå†™ï¼Œå°†ä¼španicã€‚ é—®é¢˜2å¯ä»¥è¿™æ ·è§£å†³ï¼Œé€šé“åªç”±å‘é€æ–¹å…³é—­ï¼Œæ¥æ”¶æ–¹ä¸å¯å…³é—­ï¼Œå³æŸä¸ªå†™é€šé“åªç”±ä½¿ç”¨è¯¥selectçš„åç¨‹å…³é—­ï¼Œselectä¸­å°±ä¸å­˜åœ¨ç»§ç»­åœ¨å…³é—­çš„é€šé“ä¸Šå†™æ•°æ®çš„é—®é¢˜ã€‚ é—®é¢˜1å¯ä»¥ä½¿ç”¨,okæ¥æ£€æµ‹é€šé“çš„å…³é—­ï¼Œä½¿ç”¨æƒ…å†µæœ‰2ç§ã€‚ ç¬¬ä¸€ç§ï¼šå¦‚æœæŸä¸ªé€šé“å…³é—­åï¼Œéœ€è¦é€€å‡ºåç¨‹ï¼Œç›´æ¥returnå³å¯ã€‚ç¤ºä¾‹ä»£ç ä¸­ï¼Œè¯¥åç¨‹éœ€è¦ä»iné€šé“è¯»æ•°æ®ï¼Œè¿˜éœ€è¦å®šæ—¶æ‰“å°å·²ç»å¤„ç†çš„æ•°é‡ï¼Œæœ‰2ä»¶äº‹è¦åšï¼Œæ‰€æœ‰ä¸èƒ½ä½¿ç”¨for-rangeï¼Œéœ€è¦ä½¿ç”¨for-selectï¼Œå½“inå…³é—­æ—¶ï¼Œok=falseï¼Œæˆ‘ä»¬ç›´æ¥è¿”å›ã€‚ go func() { // in for-select using ok to exit goroutine for { select { case x, ok := &lt;-in: if !ok { return } fmt.Printf(&quot;Process %d\\n&quot;, x) processedCnt++ case &lt;-t.C: fmt.Printf(&quot;Working, processedCnt = %d\\n&quot;, processedCnt) } } }() ç¬¬äºŒç§ï¼šå¦‚æœæŸä¸ªé€šé“å…³é—­äº†ï¼Œä¸å†å¤„ç†è¯¥é€šé“ï¼Œè€Œæ˜¯ç»§ç»­å¤„ç†å…¶ä»–caseï¼Œé€€å‡ºæ˜¯ç­‰å¾…æ‰€æœ‰çš„å¯è¯»é€šé“å…³é—­ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨selectçš„ä¸€ä¸ªç‰¹å¾ï¼šselectä¸ä¼šåœ¨nilçš„é€šé“ä¸Šè¿›è¡Œç­‰å¾…ã€‚è¿™ç§æƒ…å†µï¼ŒæŠŠåªè¯»é€šé“è®¾ç½®ä¸ºnilå³å¯è§£å†³ã€‚ go func() { // in for-select using ok to exit goroutine for { select { case x, ok := &lt;-in1: if !ok { in1 = nil } // Process case y, ok := &lt;-in2: if !ok { in2 = nil } // Process case &lt;-t.C: fmt.Printf(&quot;Working, processedCnt = %d\\n&quot;, processedCnt) } // If both in channel are closed, goroutine exit if in1 == nil &amp;&amp; in2 == nil { return } } }() 3ï¼šä½¿ç”¨é€€å‡ºé€šé“é€€å‡º ä½¿ç”¨,okæ¥é€€å‡ºä½¿ç”¨for-selectåç¨‹ï¼Œè§£å†³æ˜¯å½“è¯»å…¥æ•°æ®çš„é€šé“å…³é—­æ—¶ï¼Œæ²¡æ•°æ®è¯»æ—¶ç¨‹åºçš„æ­£å¸¸ç»“æŸã€‚æƒ³æƒ³ä¸‹é¢è¿™2ç§åœºæ™¯ï¼Œ,okè¿˜èƒ½é€‚ç”¨å—ï¼Ÿ æ¥æ”¶çš„åç¨‹è¦é€€å‡ºäº†ï¼Œå¦‚æœå®ƒç›´æ¥é€€å‡ºï¼Œä¸å‘ŠçŸ¥å‘é€åç¨‹ï¼Œå‘é€åç¨‹å°†é˜»å¡ã€‚ å¯åŠ¨äº†ä¸€ä¸ªå·¥ä½œåç¨‹å¤„ç†æ•°æ®ï¼Œå¦‚ä½•é€šçŸ¥å®ƒé€€å‡ºï¼Ÿ ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„é€šé“ï¼Œå‘é€é€€å‡ºçš„ä¿¡å·ï¼Œå¯ä»¥è§£å†³è¿™ç±»é—®é¢˜ã€‚ä»¥ç¬¬2ä¸ªåœºæ™¯ä¸ºä¾‹ï¼Œåç¨‹å…¥å‚åŒ…å«ä¸€ä¸ªåœæ­¢é€šé“stopChï¼Œå½“stopChè¢«å…³é—­ï¼Œcase &lt;-stopChä¼šæ‰§è¡Œï¼Œç›´æ¥è¿”å›å³å¯ã€‚ å½“æˆ‘å¯åŠ¨äº†100ä¸ªworkeræ—¶ï¼Œåªè¦main()æ‰§è¡Œå…³é—­stopChï¼Œæ¯ä¸€ä¸ªworkeréƒ½ä¼šéƒ½åˆ°ä¿¡å·ï¼Œè¿›è€Œå…³é—­ã€‚å¦‚æœmain()å‘stopChå‘é€100ä¸ªæ•°æ®ï¼Œè¿™ç§å°±ä½æ•ˆäº†ã€‚ func worker(stopCh &lt;-chan struct{}) { go func() { defer fmt.Println(&quot;worker exit&quot;) // Using stop channel explicit exit for { select { case &lt;-stopCh: fmt.Println(&quot;Recv stop signal&quot;) return case &lt;-t.C: fmt.Println(&quot;Working .&quot;) } } }() return } æœ€ä½³å®è·µå›é¡¾ å‘é€åç¨‹ä¸»åŠ¨å…³é—­é€šé“ï¼Œæ¥æ”¶åç¨‹ä¸å…³é—­é€šé“ã€‚æŠ€å·§ï¼šæŠŠæ¥æ”¶æ–¹çš„é€šé“å…¥å‚å£°æ˜ä¸ºåªè¯»ï¼Œå¦‚æœæ¥æ”¶åç¨‹å…³é—­åªè¯»åç¨‹ï¼Œç¼–è¯‘æ—¶å°±ä¼šæŠ¥é”™ã€‚ åç¨‹å¤„ç†1ä¸ªé€šé“ï¼Œå¹¶ä¸”æ˜¯è¯»æ—¶ï¼Œåç¨‹ä¼˜å…ˆä½¿ç”¨for-rangeï¼Œå› ä¸ºrangeå¯ä»¥å…³é—­é€šé“çš„å…³é—­è‡ªåŠ¨é€€å‡ºåç¨‹ã€‚ ,okå¯ä»¥å¤„ç†å¤šä¸ªè¯»é€šé“å…³é—­ï¼Œéœ€è¦å…³é—­å½“å‰ä½¿ç”¨for-selectçš„åç¨‹ã€‚ æ˜¾å¼å…³é—­é€šé“stopChå¯ä»¥å¤„ç†ä¸»åŠ¨é€šçŸ¥åç¨‹é€€å‡ºçš„åœºæ™¯ã€‚ å®Œæ•´ç¤ºä¾‹ä»£ç  æœ¬æ–‡æ‰€æœ‰ä»£ç éƒ½åœ¨ä»“åº“ï¼Œå¯æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ä»£ç ï¼šhttps://github.com/Shitaibin/golang_goroutine_exit å¹¶å‘ç³»åˆ—æ–‡ç« æ¨è Golangå¹¶å‘æ¨¡å‹ï¼šè½»æ¾å…¥é—¨æµæ°´çº¿æ¨¡å‹ Golangå¹¶å‘æ¨¡å‹ï¼šè½»æ¾å…¥é—¨æµæ°´çº¿FANæ¨¡å¼ Golangå¹¶å‘æ¨¡å‹ï¼šå¹¶å‘åç¨‹çš„ä¼˜é›…é€€å‡º å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨å…³æ³¨ä¸‹æˆ‘çš„Githubï¼Œæœ‰æ–‡ç« ä¼šæ”¶åˆ°é€šçŸ¥ã€‚ æœ¬æ–‡ä½œè€…ï¼šå¤§å½¬ å¦‚æœå–œæ¬¢æœ¬æ–‡ï¼Œéšæ„è½¬è½½ï¼Œä½†è¯·ä¿ç•™æ­¤åŸæ–‡é“¾æ¥ï¼šhttp://lessisbetter.site/2018/12/02/golang-exit-goroutine-in-3-ways/ ","link":"https://ChicRingo.github.io/post/golang-bing-fa-mo-xing-bing-fa-xie-cheng-de-you-ya-tui-chu/"},{"title":"ç”¨Golangå†™çˆ¬è™«(ä¸€)","content":"ä½¿ç”¨ Golang å¯¹è±†ç“£çˆ¬è™« åŸæ–‡åœ°å€: https://strconv.com/posts/web-crawler-exercise-1/ ä¹‹å‰ä¸€ç›´éƒ½æ˜¯å†ç”¨Pythonå†™çˆ¬è™«ï¼Œæœ€è¿‘æƒ³ä½“éªŒä¸‹Golangå†™çˆ¬è™«çš„æ„Ÿè§‰ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªç³»åˆ—ã€‚æˆ‘æƒ³è¦æŠ“å–çš„é¡µé¢æ˜¯è±†ç“£Top250é¡µé¢ï¼Œé€‰æ‹©å®ƒçš„ç†ç”±æœ‰3ä¸ª: è±†ç“£é¡µé¢ä»£ç ç›¸å¯¹è§„èŒƒ è±†ç“£å¯¹çˆ¬è™«çˆ±å¥½è€…ç›¸å¯¹æ›´å®½å®¹ Top250é¡µé¢ç®€æ´ï¼Œå¾ˆé€‚åˆæ‹¿æ¥ç»ƒæ‰‹ æˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸€ç‰ˆçš„ä»£ç ã€‚ æŒ‰é€»è¾‘æˆ‘æŠŠæŠ“å–ä»£ç åˆ†æˆ2ä¸ªéƒ¨åˆ†ï¼š HTTPè¯·æ±‚ è§£æé¡µé¢ä¸­çš„å†…å®¹ æˆ‘ä»¬å…ˆçœ‹HTTPè¯·æ±‚ï¼ŒGolangè¯­è¨€çš„HTTPè¯·æ±‚åº“ä¸éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åº“ï¼Œæ ‡å‡†åº“å°±å†…ç½®äº†è¶³å¤Ÿå¥½çš„æ”¯æŒï¼š import ( &quot;fmt&quot; &quot;net/http&quot; &quot;io/ioutil&quot; ) func fetch (url string) string { fmt.Println(&quot;Fetch Url&quot;, url) client := &amp;http.Client{} req, _ := http.NewRequest(&quot;GET&quot;, url, nil) req.Header.Set(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)&quot;) resp, err := client.Do(req) if err != nil { fmt.Println(&quot;Http get err:&quot;, err) return &quot;&quot; } if resp.StatusCode != 200 { fmt.Println(&quot;Http status code:&quot;, resp.StatusCode) return &quot;&quot; } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Println(&quot;Read error&quot;, err) return &quot;&quot; } return string(body) } æˆ‘æŠŠURLè¯·æ±‚çš„é€»è¾‘éƒ½æ”¾åœ¨äº†fetchå‡½æ•°ä¸­ï¼Œé‡Œé¢åšäº†ä¸€äº›å¼‚å¸¸å¤„ç†ã€‚å€¼å¾—è¯´çš„æœ‰2ç‚¹ï¼š åœ¨Headerä¸­è®¾ç½®äº†User-Agentï¼Œè®©è®¿é—®çœ‹èµ·æ¥æ›´åƒæœç´¢å¼•æ“Botã€‚å¦‚æœä¸€ä¸ªç½‘ç«™å¸Œæœ›è‡ªå·±çš„å†…å®¹è¢«Googleæ”¶å½•é‚£ä¹ˆä»–å°±ä¸ä¼šæ‹’ç»è¿™æ ·çš„UAçš„è®¿é—®ã€‚ éœ€è¦é€šè¿‡ioutil.ReadAll è¯»å–respçš„bodyå†…å®¹ï¼Œæœ€åç”¨string(body)æŠŠå®ƒè½¬åŒ–æˆå­—ç¬¦ä¸² æ¥ç€å°±æ˜¯è§£æé¡µé¢çš„éƒ¨åˆ†ï¼š import ( &quot;regexp&quot; &quot;strings&quot; ) func parseUrls(url string) { body := fetch(url) body = strings.Replace(body, &quot;\\n&quot;, &quot;&quot;, -1) rp := regexp.MustCompile(`&lt;div class=&quot;hd&quot;&gt;(.*?)&lt;/div&gt;`) titleRe := regexp.MustCompile(`&lt;span class=&quot;title&quot;&gt;(.*?)&lt;/span&gt;`) idRe := regexp.MustCompile(`&lt;a href=&quot;https://movie.douban.com/subject/(\\d+)/&quot;`) items := rp.FindAllStringSubmatch(body, -1) for _, item := range items { fmt.Println(idRe.FindStringSubmatch(item[1])[1], titleRe.FindStringSubmatch(item[1])[1]) } } è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦ä½“éªŒç”¨æ ‡å‡†åº“å®Œæˆé¡µé¢çš„è§£æï¼Œä¹Ÿå°±æ˜¯ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ…regexpæ¥å®Œæˆã€‚ä¸è¿‡è¦æ³¨æ„éœ€è¦ç”¨strings.Replace(body, &quot;\\n&quot;, &quot;&quot;, -1)è¿™æ­¥æŠŠbodyå†…å®¹ä¸­çš„å›è½¦ç¬¦å»æ‰ï¼Œè¦ä¸ç„¶ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼.*å°±ä¸ç¬¦åˆäº†ã€‚FindAllStringSubmatchæ–¹æ³•ä¼šæŠŠç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„ç»“æœéƒ½è§£æå‡ºæ¥ï¼ˆä¸€ä¸ªåˆ—è¡¨ï¼‰ï¼Œè€ŒFindStringSubmatchæ˜¯æ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆçš„ç»“æœã€‚ Top250é¡µé¢æ˜¯è¦ç¿»é¡µçš„ï¼Œæœ€ååœ¨mainå‡½æ•°é‡Œé¢å®ç°æŠ“å–å…¨éƒ¨Top250é¡µé¢ã€‚å¦å¤–ä¸ºäº†å’Œä¹‹åçš„æ”¹è¿›åšå¯¹æ¯”ï¼Œæˆ‘ä»¬åŠ ä¸Šä»£ç è¿è¡Œè€—æ—¶çš„é€»è¾‘ï¼š import ( &quot;time&quot; &quot;strconv&quot; ) func main() { start := time.Now() for i := 0; i &lt; 10; i++ { parseUrls(&quot;https://movie.douban.com/top250?start=&quot; + strconv.Itoa(25 * i)) } elapsed := time.Since(start) fmt.Printf(&quot;Took %s&quot;, elapsed) } åœ¨Golangä¸­æŠŠæ•°å­—è½¬æˆå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨strconv.Itoaï¼ˆå˜¿å˜¿ï¼Œæœ¬åšå®¢åŸŸåå°±æ˜¯è¿™ä¸ªæ¨¡å—ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®startçš„å‚æ•°çš„ä¸é€šæ‹¼å‡ºæ­£ç¡®çš„é¡µé¢è·¯å¾„ã€‚ç”¨ä¸€ä¸ªforå¾ªç¯å®Œæˆç¿»é¡µã€‚ è¿è¡Œèµ·æ¥éå¸¸å¿«ï¼š â¯ go run crawler/doubanCrawler1.go ... # çœç•¥è¾“å‡º Took 1.454627547s é€šè¿‡ç»ˆç«¯è¾“å‡ºå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‹¿åˆ°äº†å¯¹åº”ç”µå½±æ¡ç›®çš„IDå’Œç”µå½±æ ‡é¢˜ï¼ ä»£ç åœ°å€ å®Œæ•´ä»£ç å¯ä»¥åœ¨è¿™ä¸ªåœ°å€æ‰¾åˆ°ã€‚ ","link":"https://ChicRingo.github.io/post/yong-golang-xie-pa-chong-yi/"},{"title":"åœ¨ Go ä¸­æ°åˆ°å¥½å¤„çš„å†…å­˜å¯¹é½","content":"åœ¨Golangä¸­å¯¹ç»“æ„ä½“æˆå‘˜è¿›è¡Œå†…å­˜å¯¹é½ï¼Œä»¥æ­¤ä¿è¯å†…å­˜çš„è®¿é—®è¾¹ç•Œï¼Œå¹¶å¯ä»¥ä¼˜åŒ–å†…å­˜å ç”¨ åŸæ–‡åœ°å€ï¼šåœ¨ Go ä¸­æ°åˆ°å¥½å¤„çš„å†…å­˜å¯¹é½ é—®é¢˜ type Part1 struct { a bool b int32 c int8 d int64 e byte } åœ¨å¼€å§‹ä¹‹å‰ï¼Œå¸Œæœ›ä½ è®¡ç®—ä¸€ä¸‹ Part1 å…±å ç”¨çš„å¤§å°æ˜¯å¤šå°‘å‘¢ï¼Ÿ func main() { fmt.Printf(&quot;bool size: %d\\n&quot;, unsafe.Sizeof(bool(true))) fmt.Printf(&quot;int32 size: %d\\n&quot;, unsafe.Sizeof(int32(0))) fmt.Printf(&quot;int8 size: %d\\n&quot;, unsafe.Sizeof(int8(0))) fmt.Printf(&quot;int64 size: %d\\n&quot;, unsafe.Sizeof(int64(0))) fmt.Printf(&quot;byte size: %d\\n&quot;, unsafe.Sizeof(byte(0))) fmt.Printf(&quot;string size: %d\\n&quot;, unsafe.Sizeof(&quot;EDDYCJY&quot;)) } è¾“å‡ºç»“æœï¼š bool size: 1 int32 size: 4 int8 size: 1 int64 size: 8 byte size: 1 string size: 16 è¿™ä¹ˆä¸€ç®—ï¼ŒPart1 è¿™ä¸€ä¸ªç»“æ„ä½“çš„å ç”¨å†…å­˜å¤§å°ä¸º 1+4+1+8+1 = 15 ä¸ªå­—èŠ‚ã€‚ç›¸ä¿¡æœ‰çš„å°ä¼™ä¼´æ˜¯è¿™ä¹ˆç®—çš„ï¼Œçœ‹ä¸Šå»ä¹Ÿæ²¡ä»€ä¹ˆæ¯›ç—… çœŸå®æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬å®é™…è°ƒç”¨çœ‹çœ‹ï¼Œå¦‚ä¸‹ï¼š type Part1 struct { a bool b int32 c int8 d int64 e byte } func main() { part1 := Part1{} fmt.Printf(&quot;part1 size: %d, align: %d\\n&quot;, unsafe.Sizeof(part1), unsafe.Alignof(part1)) } è¾“å‡ºç»“æœï¼š part1 size: 32, align: 8 æœ€ç»ˆè¾“å‡ºä¸ºå ç”¨ 32 ä¸ªå­—èŠ‚ã€‚è¿™ä¸å‰é¢æ‰€é¢„æœŸçš„ç»“æœå®Œå…¨ä¸ä¸€æ ·ã€‚è¿™å……åˆ†åœ°è¯´æ˜äº†å…ˆå‰çš„è®¡ç®—æ–¹å¼æ˜¯é”™è¯¯çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åœ¨è¿™é‡Œè¦æåˆ° â€œå†…å­˜å¯¹é½â€ è¿™ä¸€æ¦‚å¿µï¼Œæ‰èƒ½å¤Ÿç”¨æ­£ç¡®çš„å§¿åŠ¿å»è®¡ç®—ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†çš„è®²è®²å®ƒæ˜¯ä»€ä¹ˆ å†…å­˜å¯¹é½ æœ‰çš„å°ä¼™ä¼´å¯èƒ½ä¼šè®¤ä¸ºå†…å­˜è¯»å–ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—èŠ‚æ•°ç»„æ‘†æ”¾ ä¸Šå›¾è¡¨ç¤ºä¸€ä¸ªå‘ä¸€ä¸ªèåœçš„å†…å­˜è¯»å–æ–¹å¼ã€‚ä½†å®é™…ä¸Š CPU å¹¶ä¸ä¼šä»¥ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚å»è¯»å–å’Œå†™å…¥å†…å­˜ã€‚ç›¸å CPU è¯»å–å†…å­˜æ˜¯ä¸€å—ä¸€å—è¯»å–çš„ï¼Œå—çš„å¤§å°å¯ä»¥ä¸º 2ã€4ã€6ã€8ã€16 å­—èŠ‚ç­‰å¤§å°ã€‚å—å¤§å°æˆ‘ä»¬ç§°å…¶ä¸ºå†…å­˜è®¿é—®ç²’åº¦ã€‚å¦‚ä¸‹å›¾ï¼š åœ¨æ ·ä¾‹ä¸­ï¼Œå‡è®¾è®¿é—®ç²’åº¦ä¸º 4ã€‚ CPU æ˜¯ä»¥æ¯ 4 ä¸ªå­—èŠ‚å¤§å°çš„è®¿é—®ç²’åº¦å»è¯»å–å’Œå†™å…¥å†…å­˜çš„ã€‚è¿™æ‰æ˜¯æ­£ç¡®çš„å§¿åŠ¿ ä¸ºä»€ä¹ˆè¦å…³å¿ƒå¯¹é½ ä½ æ­£åœ¨ç¼–å†™çš„ä»£ç åœ¨æ€§èƒ½ï¼ˆCPUã€Memoryï¼‰æ–¹é¢æœ‰ä¸€å®šçš„è¦æ±‚ ä½ æ­£åœ¨å¤„ç†å‘é‡æ–¹é¢çš„æŒ‡ä»¤ æŸäº›ç¡¬ä»¶å¹³å°ï¼ˆARMï¼‰ä½“ç³»ä¸æ”¯æŒæœªå¯¹é½çš„å†…å­˜è®¿é—® å¦å¤–ä½œä¸ºä¸€ä¸ªå·¥ç¨‹å¸ˆï¼Œä½ ä¹Ÿå¾ˆæœ‰å¿…è¦å­¦ä¹ è¿™å—çŸ¥è¯†ç‚¹å“¦ ğŸ˜ƒ ä¸ºä»€ä¹ˆè¦åšå¯¹é½ å¹³å°ï¼ˆç§»æ¤æ€§ï¼‰åŸå› ï¼šä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°éƒ½èƒ½å¤Ÿè®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç‰¹å®šçš„ç¡¬ä»¶å¹³å°åªå…è®¸åœ¨ç‰¹å®šåœ°å€è·å–ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¼‚å¸¸æƒ…å†µ æ€§èƒ½åŸå› ï¼šè‹¥è®¿é—®æœªå¯¹é½çš„å†…å­˜ï¼Œå°†ä¼šå¯¼è‡´ CPU è¿›è¡Œä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œå¹¶ä¸”è¦èŠ±è´¹é¢å¤–çš„æ—¶é’Ÿå‘¨æœŸæ¥å¤„ç†å¯¹é½åŠè¿ç®—ã€‚è€Œæœ¬èº«å°±å¯¹é½çš„å†…å­˜ä»…éœ€è¦ä¸€æ¬¡è®¿é—®å°±å¯ä»¥å®Œæˆè¯»å–åŠ¨ä½œ åœ¨ä¸Šå›¾ä¸­ï¼Œå‡è®¾ä» Index 1 å¼€å§‹è¯»å–ï¼Œå°†ä¼šå‡ºç°å¾ˆå´©æºƒçš„é—®é¢˜ã€‚å› ä¸ºå®ƒçš„å†…å­˜è®¿é—®è¾¹ç•Œæ˜¯ä¸å¯¹é½çš„ã€‚å› æ­¤ CPU ä¼šåšä¸€äº›é¢å¤–çš„å¤„ç†å·¥ä½œã€‚å¦‚ä¸‹ï¼š CPU é¦–æ¬¡è¯»å–æœªå¯¹é½åœ°å€çš„ç¬¬ä¸€ä¸ªå†…å­˜å—ï¼Œè¯»å– 0-3 å­—èŠ‚ã€‚å¹¶ç§»é™¤ä¸éœ€è¦çš„å­—èŠ‚ 0 CPU å†æ¬¡è¯»å–æœªå¯¹é½åœ°å€çš„ç¬¬äºŒä¸ªå†…å­˜å—ï¼Œè¯»å– 4-7 å­—èŠ‚ã€‚å¹¶ç§»é™¤ä¸éœ€è¦çš„å­—èŠ‚ 5ã€6ã€7 å­—èŠ‚ åˆå¹¶ 1-4 å­—èŠ‚çš„æ•°æ® åˆå¹¶åæ”¾å…¥å¯„å­˜å™¨ ä»ä¸Šè¿°æµç¨‹å¯å¾—å‡ºï¼Œä¸åš â€œå†…å­˜å¯¹é½â€ æ˜¯ä¸€ä»¶æœ‰ç‚¹ â€œéº»çƒ¦â€ çš„äº‹ã€‚å› ä¸ºå®ƒä¼šå¢åŠ è®¸å¤šè€—è´¹æ—¶é—´çš„åŠ¨ä½œ è€Œå‡è®¾åšäº†å†…å­˜å¯¹é½ï¼Œä» Index 0 å¼€å§‹è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œåªéœ€è¦è¯»å–ä¸€æ¬¡ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„è¿ç®—ã€‚è¿™æ˜¾ç„¶é«˜æ•ˆå¾ˆå¤šï¼Œæ˜¯æ ‡å‡†çš„ç©ºé—´æ¢æ—¶é—´åšæ³• é»˜è®¤ç³»æ•° åœ¨ä¸åŒå¹³å°ä¸Šçš„ç¼–è¯‘å™¨éƒ½æœ‰è‡ªå·±é»˜è®¤çš„ â€œå¯¹é½ç³»æ•°â€ï¼Œå¯é€šè¿‡é¢„ç¼–è¯‘å‘½ä»¤ #pragma pack(n) è¿›è¡Œå˜æ›´ï¼Œn å°±æ˜¯ä»£æŒ‡ â€œå¯¹é½ç³»æ•°â€ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„å¹³å°çš„ç³»æ•°å¦‚ä¸‹ï¼š 32 ä½ï¼š4 64 ä½ï¼š8 å¦å¤–è¦æ³¨æ„ï¼Œä¸åŒç¡¬ä»¶å¹³å°å ç”¨çš„å¤§å°å’Œå¯¹é½å€¼éƒ½å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤æœ¬æ–‡çš„å€¼ä¸æ˜¯å”¯ä¸€çš„ï¼Œè°ƒè¯•çš„æ—¶å€™éœ€æŒ‰æœ¬æœºçš„å®é™…æƒ…å†µè€ƒè™‘ æˆå‘˜å¯¹é½ func main() { fmt.Printf(&quot;bool align: %d\\n&quot;, unsafe.Alignof(bool(true))) fmt.Printf(&quot;int32 align: %d\\n&quot;, unsafe.Alignof(int32(0))) fmt.Printf(&quot;int8 align: %d\\n&quot;, unsafe.Alignof(int8(0))) fmt.Printf(&quot;int64 align: %d\\n&quot;, unsafe.Alignof(int64(0))) fmt.Printf(&quot;byte align: %d\\n&quot;, unsafe.Alignof(byte(0))) fmt.Printf(&quot;string align: %d\\n&quot;, unsafe.Alignof(&quot;EDDYCJY&quot;)) fmt.Printf(&quot;map align: %d\\n&quot;, unsafe.Alignof(map[string]string{})) } è¾“å‡ºç»“æœï¼š bool align: 1 int32 align: 4 int8 align: 1 int64 align: 8 byte align: 1 string align: 8 map align: 8 åœ¨ Go ä¸­å¯ä»¥è°ƒç”¨ unsafe.Alignof æ¥è¿”å›ç›¸åº”ç±»å‹çš„å¯¹é½ç³»æ•°ã€‚é€šè¿‡è§‚å¯Ÿè¾“å‡ºç»“æœï¼Œå¯å¾—çŸ¥åŸºæœ¬éƒ½æ˜¯ 2^nï¼Œæœ€å¤§ä¹Ÿä¸ä¼šè¶…è¿‡ 8ã€‚è¿™æ˜¯å› ä¸ºæˆ‘æ‰‹æï¼ˆ64 ä½ï¼‰ç¼–è¯‘å™¨é»˜è®¤å¯¹é½ç³»æ•°æ˜¯ 8ï¼Œå› æ­¤æœ€å¤§å€¼ä¸ä¼šè¶…è¿‡è¿™ä¸ªæ•° æ•´ä½“å¯¹é½ åœ¨ä¸Šå°èŠ‚ä¸­ï¼Œæåˆ°äº†ç»“æ„ä½“ä¸­çš„æˆå‘˜å˜é‡è¦åšå­—èŠ‚å¯¹é½ã€‚é‚£ä¹ˆæƒ³å½“ç„¶èº«ä¸ºæœ€ç»ˆç»“æœçš„ç»“æ„ä½“ï¼Œä¹Ÿæ˜¯éœ€è¦åšå­—èŠ‚å¯¹é½çš„ å¯¹é½è§„åˆ™ ç»“æ„ä½“çš„æˆå‘˜å˜é‡ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡çš„åç§»é‡ä¸º 0ã€‚å¾€åçš„æ¯ä¸ªæˆå‘˜å˜é‡çš„å¯¹é½å€¼å¿…é¡»ä¸ºç¼–è¯‘å™¨é»˜è®¤å¯¹é½é•¿åº¦ï¼ˆ#pragma pack(n)ï¼‰æˆ–å½“å‰æˆå‘˜å˜é‡ç±»å‹çš„é•¿åº¦ï¼ˆunsafe.Sizeofï¼‰ï¼Œå–æœ€å°å€¼ä½œä¸ºå½“å‰ç±»å‹çš„å¯¹é½å€¼ã€‚å…¶åç§»é‡å¿…é¡»ä¸ºå¯¹é½å€¼çš„æ•´æ•°å€ ç»“æ„ä½“æœ¬èº«ï¼Œå¯¹é½å€¼å¿…é¡»ä¸ºç¼–è¯‘å™¨é»˜è®¤å¯¹é½é•¿åº¦ï¼ˆ#pragma pack(n)ï¼‰æˆ–ç»“æ„ä½“çš„æ‰€æœ‰æˆå‘˜å˜é‡ç±»å‹ä¸­çš„æœ€å¤§é•¿åº¦ï¼Œå–æœ€å¤§æ•°çš„æœ€å°æ•´æ•°å€ä½œä¸ºå¯¹é½å€¼ ç»“åˆä»¥ä¸Šä¸¤ç‚¹ï¼Œå¯å¾—çŸ¥è‹¥ç¼–è¯‘å™¨é»˜è®¤å¯¹é½é•¿åº¦ï¼ˆ#pragma pack(n)ï¼‰è¶…è¿‡ç»“æ„ä½“å†…æˆå‘˜å˜é‡çš„ç±»å‹æœ€å¤§é•¿åº¦æ—¶ï¼Œé»˜è®¤å¯¹é½é•¿åº¦æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ åˆ†ææµç¨‹ æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹ï¼Œâ€œå®ƒâ€ åˆ°åº•ç»å†äº†äº›ä»€ä¹ˆï¼Œå½±å“äº† â€œé¢„æœŸâ€ ç»“æœ æˆå‘˜å˜é‡ ç±»å‹ åç§»é‡ è‡ªèº«å ç”¨ a bool 0 1 å­—èŠ‚å¯¹é½ æ—  1 3 b int32 4 4 c int8 8 1 å­—èŠ‚å¯¹é½ æ—  9 7 d int64 16 8 e byte 24 1 å­—èŠ‚å¯¹é½ æ—  25 7 æ€»å ç”¨å¤§å° - - 32 æˆå‘˜å¯¹é½ ç¬¬ä¸€ä¸ªæˆå‘˜ a ç±»å‹ä¸º bool å¤§å°/å¯¹é½å€¼ä¸º 1 å­—èŠ‚ åˆå§‹åœ°å€ï¼Œåç§»é‡ä¸º 0ã€‚å ç”¨äº†ç¬¬ 1 ä½ ç¬¬äºŒä¸ªæˆå‘˜ b ç±»å‹ä¸º int32 å¤§å°/å¯¹é½å€¼ä¸º 4 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 4 çš„æ•´æ•°å€ã€‚ç¡®å®šåç§»é‡ä¸º 4ï¼Œå› æ­¤ 2-4 ä½ä¸º Paddingã€‚è€Œå½“å‰æ•°å€¼ä»ç¬¬ 5 ä½å¼€å§‹å¡«å……ï¼Œåˆ°ç¬¬ 8 ä½ã€‚å¦‚ä¸‹ï¼šaxxx|bbbb ç¬¬ä¸‰ä¸ªæˆå‘˜ c ç±»å‹ä¸º int8 å¤§å°/å¯¹é½å€¼ä¸º 1 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 1 çš„æ•´æ•°å€ã€‚å½“å‰åç§»é‡ä¸º 8ã€‚ä¸éœ€è¦é¢å¤–å¯¹é½ï¼Œå¡«å…… 1 ä¸ªå­—èŠ‚åˆ°ç¬¬ 9 ä½ã€‚å¦‚ä¸‹ï¼šaxxx|bbbb|câ€¦ ç¬¬å››ä¸ªæˆå‘˜ d ç±»å‹ä¸º int64 å¤§å°/å¯¹é½å€¼ä¸º 8 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 8 çš„æ•´æ•°å€ã€‚ç¡®å®šåç§»é‡ä¸º 16ï¼Œå› æ­¤ 9-16 ä½ä¸º Paddingã€‚è€Œå½“å‰æ•°å€¼ä»ç¬¬ 17 ä½å¼€å§‹å†™å…¥ï¼Œåˆ°ç¬¬ 24 ä½ã€‚å¦‚ä¸‹ï¼šaxxx|bbbb|cxxx|xxxx|dddd|dddd ç¬¬äº”ä¸ªæˆå‘˜ e ç±»å‹ä¸º byte å¤§å°/å¯¹é½å€¼ä¸º 1 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 1 çš„æ•´æ•°å€ã€‚å½“å‰åç§»é‡ä¸º 24ã€‚ä¸éœ€è¦é¢å¤–å¯¹é½ï¼Œå¡«å…… 1 ä¸ªå­—èŠ‚åˆ°ç¬¬ 25 ä½ã€‚å¦‚ä¸‹ï¼šaxxx|bbbb|cxxx|xxxx|dddd|dddd|eâ€¦ æ•´ä½“å¯¹é½ åœ¨æ¯ä¸ªæˆå‘˜å˜é‡è¿›è¡Œå¯¹é½åï¼Œæ ¹æ®è§„åˆ™ 2ï¼Œæ•´ä¸ªç»“æ„ä½“æœ¬èº«ä¹Ÿè¦è¿›è¡Œå­—èŠ‚å¯¹é½ï¼Œå› ä¸ºå¯å‘ç°å®ƒå¯èƒ½å¹¶ä¸æ˜¯ 2^nï¼Œä¸æ˜¯å¶æ•°å€ã€‚æ˜¾ç„¶ä¸ç¬¦åˆå¯¹é½çš„è§„åˆ™ æ ¹æ®è§„åˆ™ 2ï¼Œå¯å¾—å‡ºå¯¹é½å€¼ä¸º 8ã€‚ç°åœ¨çš„åç§»é‡ä¸º 25ï¼Œä¸æ˜¯ 8 çš„æ•´å€æ•°ã€‚å› æ­¤ç¡®å®šåç§»é‡ä¸º 32ã€‚å¯¹ç»“æ„ä½“è¿›è¡Œå¯¹é½ ç»“æœ Part1 å†…å­˜å¸ƒå±€ï¼šaxxx|bbbb|cxxx|xxxx|dddd|dddd|exxx|xxxx å°ç»“ é€šè¿‡æœ¬èŠ‚çš„åˆ†æï¼Œå¯å¾—çŸ¥å…ˆå‰çš„ â€œæ¨ç®—â€ ä¸ºä»€ä¹ˆé”™è¯¯ï¼Ÿ æ˜¯å› ä¸ºå®é™…å†…å­˜ç®¡ç†å¹¶é â€œä¸€ä¸ªèåœä¸€ä¸ªå‘â€ çš„æ€æƒ³ã€‚è€Œæ˜¯ä¸€å—ä¸€å—ã€‚é€šè¿‡ç©ºé—´æ¢æ—¶é—´ï¼ˆæ•ˆç‡ï¼‰çš„æ€æƒ³æ¥å®Œæˆè¿™å—è¯»å–ã€å†™å…¥ã€‚å¦å¤–ä¹Ÿéœ€è¦å…¼é¡¾ä¸åŒå¹³å°çš„å†…å­˜æ“ä½œæƒ…å†µ å·§å¦™çš„ç»“æ„ä½“ åœ¨ä¸Šä¸€å°èŠ‚ï¼Œå¯å¾—çŸ¥æ ¹æ®æˆå‘˜å˜é‡çš„ç±»å‹ä¸åŒï¼Œå…¶ç»“æ„ä½“çš„å†…å­˜ä¼šäº§ç”Ÿå¯¹é½ç­‰åŠ¨ä½œã€‚é‚£å‡è®¾å­—æ®µé¡ºåºä¸åŒï¼Œä¼šä¸ä¼šæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥è¯•è¯•å§ ğŸ˜ƒ type Part1 struct { a bool b int32 c int8 d int64 e byte } type Part2 struct { e byte c int8 a bool b int32 d int64 } func main() { part1 := Part1{} part2 := Part2{} fmt.Printf(&quot;part1 size: %d, align: %d\\n&quot;, unsafe.Sizeof(part1), unsafe.Alignof(part1)) fmt.Printf(&quot;part2 size: %d, align: %d\\n&quot;, unsafe.Sizeof(part2), unsafe.Alignof(part2)) } è¾“å‡ºç»“æœï¼š part1 size: 32, align: 8 part2 size: 16, align: 8 é€šè¿‡ç»“æœå¯ä»¥æƒŠå–œçš„å‘ç°ï¼Œåªæ˜¯ â€œç®€å•â€ å¯¹æˆå‘˜å˜é‡çš„å­—æ®µé¡ºåºè¿›è¡Œæ”¹å˜ï¼Œå°±æ”¹å˜äº†ç»“æ„ä½“å ç”¨å¤§å° æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å‰–æä¸€ä¸‹ Part2ï¼Œçœ‹çœ‹å®ƒçš„å†…éƒ¨åˆ°åº•å’Œä¸Šä¸€ä½ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ‰å¯¼è‡´äº†è¿™æ ·çš„ç»“æœï¼Ÿ åˆ†ææµç¨‹ æˆå‘˜å˜é‡ ç±»å‹ åç§»é‡ è‡ªèº«å ç”¨ e byte 0 1 c int8 1 1 a bool 2 1 å­—èŠ‚å¯¹é½ æ—  3 1 b int32 4 4 d int64 8 8 æ€»å ç”¨å¤§å° - - 16 æˆå‘˜å¯¹é½ ç¬¬ä¸€ä¸ªæˆå‘˜ e ç±»å‹ä¸º byte å¤§å°/å¯¹é½å€¼ä¸º 1 å­—èŠ‚ åˆå§‹åœ°å€ï¼Œåç§»é‡ä¸º 0ã€‚å ç”¨äº†ç¬¬ 1 ä½ ç¬¬äºŒä¸ªæˆå‘˜ c ç±»å‹ä¸º int8 å¤§å°/å¯¹é½å€¼ä¸º 1 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 1 çš„æ•´æ•°å€ã€‚å½“å‰åç§»é‡ä¸º 2ã€‚ä¸éœ€è¦é¢å¤–å¯¹é½ ç¬¬ä¸‰ä¸ªæˆå‘˜ a ç±»å‹ä¸º bool å¤§å°/å¯¹é½å€¼ä¸º 1 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 1 çš„æ•´æ•°å€ã€‚å½“å‰åç§»é‡ä¸º 3ã€‚ä¸éœ€è¦é¢å¤–å¯¹é½ ç¬¬å››ä¸ªæˆå‘˜ b ç±»å‹ä¸º int32 å¤§å°/å¯¹é½å€¼ä¸º 4 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 4 çš„æ•´æ•°å€ã€‚ç¡®å®šåç§»é‡ä¸º 4ï¼Œå› æ­¤ç¬¬ 3 ä½ä¸º Paddingã€‚è€Œå½“å‰æ•°å€¼ä»ç¬¬ 4 ä½å¼€å§‹å¡«å……ï¼Œåˆ°ç¬¬ 8 ä½ã€‚å¦‚ä¸‹ï¼šecax|bbbb ç¬¬äº”ä¸ªæˆå‘˜ d ç±»å‹ä¸º int64 å¤§å°/å¯¹é½å€¼ä¸º 8 å­—èŠ‚ æ ¹æ®è§„åˆ™ 1ï¼Œå…¶åç§»é‡å¿…é¡»ä¸º 8 çš„æ•´æ•°å€ã€‚å½“å‰åç§»é‡ä¸º 8ã€‚ä¸éœ€è¦é¢å¤–å¯¹é½ï¼Œä» 9-16 ä½å¡«å…… 8 ä¸ªå­—èŠ‚ã€‚å¦‚ä¸‹ï¼šecax|bbbb|dddd|dddd æ•´ä½“å¯¹é½ ç¬¦åˆè§„åˆ™ 2ï¼Œä¸éœ€è¦é¢å¤–å¯¹é½ ç»“æœ Part2 å†…å­˜å¸ƒå±€ï¼šecax|bbbb|dddd|dddd æ€»ç»“ é€šè¿‡å¯¹æ¯” Part1 å’Œ Part2 çš„å†…å­˜å¸ƒå±€ï¼Œä½ ä¼šå‘ç°ä¸¤è€…æœ‰å¾ˆå¤§çš„ä¸åŒã€‚å¦‚ä¸‹ï¼š Part1ï¼šaxxx|bbbb|cxxx|xxxx|dddd|dddd|exxx|xxxx Part2ï¼šecax|bbbb|dddd|dddd ä»”ç»†ä¸€çœ‹ï¼ŒPart1 å­˜åœ¨è®¸å¤š Paddingã€‚æ˜¾ç„¶å®ƒå æ®äº†ä¸å°‘ç©ºé—´ï¼Œé‚£ä¹ˆ Padding æ˜¯æ€ä¹ˆå‡ºç°çš„å‘¢ï¼Ÿ é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œå¯å¾—çŸ¥æ˜¯ç”±äºä¸åŒç±»å‹å¯¼è‡´éœ€è¦è¿›è¡Œå­—èŠ‚å¯¹é½ï¼Œä»¥æ­¤ä¿è¯å†…å­˜çš„è®¿é—®è¾¹ç•Œ é‚£ä¹ˆä¹Ÿä¸éš¾ç†è§£ï¼Œä¸ºä»€ä¹ˆè°ƒæ•´ç»“æ„ä½“å†…æˆå‘˜å˜é‡çš„å­—æ®µé¡ºåºå°±èƒ½è¾¾åˆ°ç¼©å°ç»“æ„ä½“å ç”¨å¤§å°çš„ç–‘é—®äº†ï¼Œæ˜¯å› ä¸ºå·§å¦™åœ°å‡å°‘äº† Padding çš„å­˜åœ¨ã€‚è®©å®ƒä»¬æ›´ â€œç´§å‡‘â€ äº†ã€‚è¿™ä¸€ç‚¹å¯¹äºåŠ æ·± Go çš„å†…å­˜å¸ƒå±€å°è±¡å’Œå¤§å¯¹è±¡çš„ä¼˜åŒ–éå¸¸æœ‰å¸® å½“ç„¶äº†ï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šé—®é¢˜ï¼Œä½ å¯ä»¥ä¸å…³æ³¨è¿™ä¸€å—ã€‚ä½†ä½ è¦çŸ¥é“è¿™å—çŸ¥è¯†ç‚¹ ğŸ˜„ å‚è€ƒ Data structure alignment Data alignment ","link":"https://ChicRingo.github.io/post/zai-go-zhong-qia-dao-hao-chu-de-nei-cun-dui-qi/"},{"title":"Golang ä¸­é›¶å€¼çš„å‘","content":"å¯¹äºint, string, boolæ¥è¯´ï¼Œå£°æ˜è¿™ä¸‰ç§åŸºæœ¬ç±»å‹çš„å˜é‡ï¼ŒGoä¼šé»˜è®¤åˆ†é…ä¸€ä¸ªé›¶å€¼ï¼Œé›¶å€¼åˆ†åˆ«ä¸º 0 , '' ,falseï¼Œæ‰€ä»¥åœ¨GORMä¸­é€šè¿‡tagå®šä¹‰å­—æ®µçš„é»˜è®¤å€¼åï¼Œè¿™äº›æœ‰é»˜è®¤å€¼çš„å­—æ®µåœ¨ä½¿ç”¨è¿™äº›é›¶å€¼ä½œä¸ºå‚æ•°æ—¶ï¼ŒGORMä¸ä¼šæŠŠè¿™äº›å­—æ®µçš„å€¼æ’å…¥æ•°æ®åº“ä¸­ï¼Œè¿™ä¸ªå‘ä¸€å®šè¦åˆ‡è®°ã€‚ é»˜è®¤å€¼ å¯ä»¥é€šè¿‡ tag å®šä¹‰å­—æ®µçš„é»˜è®¤å€¼ï¼Œæ¯”å¦‚ï¼š type User struct { ID int64 Name string `gorm:&quot;default:'å°ç‹å­'&quot;` Age int64 } æ³¨æ„ï¼š é€šè¿‡tagå®šä¹‰å­—æ®µçš„é»˜è®¤å€¼ï¼Œåœ¨åˆ›å»ºè®°å½•æ—¶å€™ç”Ÿæˆçš„ SQL è¯­å¥ä¼šæ’é™¤æ²¡æœ‰å€¼æˆ–å€¼ä¸º é›¶å€¼ çš„å­—æ®µã€‚ åœ¨å°†è®°å½•æ’å…¥åˆ°æ•°æ®åº“åï¼ŒGormä¼šä»æ•°æ®åº“åŠ è½½é‚£äº›å­—æ®µçš„é»˜è®¤å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š var user = User{Name: &quot;&quot;, Age: 99} db.Create(&amp;user) ä¸Šé¢ä»£ç å®é™…æ‰§è¡Œçš„SQLè¯­å¥æ˜¯INSERT INTO users(&quot;age&quot;) values('99');ï¼Œæ’é™¤äº†é›¶å€¼å­—æ®µNameï¼Œè€Œåœ¨æ•°æ®åº“ä¸­è¿™ä¸€æ¡æ•°æ®ä¼šä½¿ç”¨è®¾ç½®çš„é»˜è®¤å€¼å°ç‹å­ä½œä¸ºNameå­—æ®µçš„å€¼ã€‚ **æ³¨æ„ï¼š**æ‰€æœ‰å­—æ®µçš„é›¶å€¼, æ¯”å¦‚0, &quot;&quot;,falseæˆ–è€…å…¶å®ƒé›¶å€¼ï¼Œéƒ½ä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“å†…ï¼Œä½†ä¼šä½¿ç”¨ä»–ä»¬çš„é»˜è®¤å€¼ã€‚ å¦‚æœä½ æƒ³é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆæˆ–å®ç° Scanner/Valueræ¥å£ï¼Œæ¯”å¦‚ï¼š ä½¿ç”¨æŒ‡é’ˆæ–¹å¼å®ç°é›¶å€¼å­˜å…¥æ•°æ®åº“ // ä½¿ç”¨æŒ‡é’ˆ type User struct { ID int64 Name *string `gorm:&quot;default:'å°ç‹å­'&quot;` Age int64 } user := User{Name: new(string), Age: 18))} db.Create(&amp;user) // æ­¤æ—¶æ•°æ®åº“ä¸­è¯¥æ¡è®°å½•nameå­—æ®µçš„å€¼å°±æ˜¯'' ä½¿ç”¨Scanner/Valueræ¥å£æ–¹å¼å®ç°é›¶å€¼å­˜å…¥æ•°æ®åº“ // ä½¿ç”¨ Scanner/Valuer type User struct { ID int64 Name sql.NullString `gorm:&quot;default:'å°ç‹å­'&quot;` // sql.NullString å®ç°äº†Scanner/Valueræ¥å£ Age int64 } user := User{Name: sql.NullString{&quot;&quot;, true}, Age:18} db.Create(&amp;user) // æ­¤æ—¶æ•°æ®åº“ä¸­è¯¥æ¡è®°å½•nameå­—æ®µçš„å€¼å°±æ˜¯'' ","link":"https://ChicRingo.github.io/post/golang-zhong-ling-zhi-de-keng/"},{"title":"Golang ä¸­ range çš„å‘","content":"é¿å…è¸©å‘æŒ‡åŒ—ï¼ŒGolang ä¸­å®¹æ˜“åœ¨ for range ä¸­è¸©åˆ°çš„å‘ ä½¿ç”¨ range è¿­ä»£éå†æ•°ç»„ range ä¼šå¤åˆ¶å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸æ˜¯ç›´æ¥åœ¨åŸå¯¹è±¡ä¸Šæ“ä½œã€‚ ç¤ºä¾‹ä¸€ï¼š func main() { a := [3]int{1, 2, 3} for _, v := range a { // å¤åˆ¶ä¸€ä»½aéå†[1, 2, 3] v += 100 // væ˜¯å¤åˆ¶å¯¹è±¡ä¸­çš„å€¼ï¼Œä¸ä¼šæ”¹å˜aæ•°ç»„å…ƒç´ çš„å€¼ } fmt.Println(a) // 1 2 3 } ç¤ºä¾‹äºŒï¼š func main() { a := [3]int{1, 2, 3} for i, v := range a { // i,vä»aå¤åˆ¶çš„å¯¹è±¡é‡Œæå–å‡º if i == 0 { a[1], a[2] = 200, 300 fmt.Println(a) // è¾“å‡º[1 200 300] } a[i] = v + 100 // væ˜¯å¤åˆ¶å¯¹è±¡é‡Œçš„å…ƒç´ [1, 2, 3] } fmt.Println(a) // è¾“å‡º[101, 102, 103] } ç»“æœï¼š [1 200 300] [101 102 103] ä½¿ç”¨ range è¿­ä»£éå†åˆ‡ç‰‡ rangeè¿­ä»£éå†å¼•ç”¨ç±»å‹æ—¶ï¼Œåº•å±‚çš„æ•°æ®ä¸ä¼šè¢«å¤åˆ¶ï¼š func main() { a := []int{1, 2, 3} // æ”¹æˆslice for i, v := range a { if i == 0 { a[1], a[2] = 200, 300 fmt.Println(a) // [1 200 300] } a[i] = v + 100 } fmt.Println(a) // è¾“å‡º[101 300 400] } ç»“æœï¼š [1 200 300] [101 300 400] å› ä¸ºåˆ‡ç‰‡çš„å†…éƒ¨ç»“æ„ä¸ºstruct slice{*point, len, cap}ã€‚ æ•°æ®éƒ¨åˆ†æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘åœ°å€ï¼Œå¤åˆ¶å¯¹è±¡çš„æ—¶å€™åªæ˜¯æŠŠæŒ‡é’ˆçš„å€¼å¤åˆ¶äº†ï¼Œè€Œä¸æ˜¯é‡æ–°æ‹·è´ä¸€å—æ–°çš„å†…å­˜å†æŠŠå€¼æ”¾è¿›å»ï¼Œæ‰€ä»¥ä¿®æ”¹çš„æ—¶å€™è¿˜æ˜¯ä¿®æ”¹çš„åŸæ¥çš„å€¼ã€‚ ","link":"https://ChicRingo.github.io/post/golang-zhong-range-de-keng/"},{"title":"Go ä¸ºä»€ä¹ˆè¿™ä¹ˆâ€œå¿«â€","content":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Go ç¨‹åºä¸ºäº†å®ç°æé«˜çš„å¹¶å‘æ€§èƒ½ï¼Œå…¶å†…éƒ¨è°ƒåº¦å™¨çš„å®ç°æ¶æ„ï¼ˆG-P-M æ¨¡å‹ï¼‰ï¼Œä»¥åŠä¸ºäº†æœ€å¤§é™åº¦åˆ©ç”¨è®¡ç®—èµ„æºï¼ŒGo è°ƒåº¦å™¨æ˜¯å¦‚ä½•å¤„ç†çº¿ç¨‹é˜»å¡çš„åœºæ™¯ è½¬è‡ªçŸ¥ä¹ï¼šGoä¸ºä»€ä¹ˆè¿™ä¹ˆâ€œå¿«â€ æ€ä¹ˆè®©æˆ‘ä»¬çš„ç³»ç»Ÿæ›´å¿« éšç€ä¿¡æ¯æŠ€æœ¯çš„è¿…é€Ÿå‘å±•ï¼Œå•å°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›è¶Šæ¥è¶Šå¼ºï¼Œè¿«ä½¿ç¼–ç¨‹æ¨¡å¼ç”±ä»å‰çš„ä¸²è¡Œæ¨¡å¼å‡çº§åˆ°å¹¶å‘æ¨¡å‹ã€‚ å¹¶å‘æ¨¡å‹åŒ…å« IO å¤šè·¯å¤ç”¨ã€å¤šè¿›ç¨‹ä»¥åŠå¤šçº¿ç¨‹ï¼Œè¿™å‡ ç§æ¨¡å‹éƒ½å„æœ‰ä¼˜åŠ£ï¼Œç°ä»£å¤æ‚çš„é«˜å¹¶å‘æ¶æ„å¤§å¤šæ˜¯å‡ ç§æ¨¡å‹ååŒä½¿ç”¨ï¼Œä¸åŒåœºæ™¯åº”ç”¨ä¸åŒæ¨¡å‹ï¼Œæ‰¬é•¿é¿çŸ­ï¼Œå‘æŒ¥æœåŠ¡å™¨çš„æœ€å¤§æ€§èƒ½ã€‚ è€Œå¤šçº¿ç¨‹ï¼Œå› ä¸ºå…¶è½»é‡å’Œæ˜“ç”¨ï¼Œæˆä¸ºå¹¶å‘ç¼–ç¨‹ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å¹¶å‘æ¨¡å‹ï¼ŒåŒ…æ‹¬åè¡ç”Ÿçš„åç¨‹ç­‰å…¶ä»–å­äº§å“ï¼Œä¹Ÿéƒ½åŸºäºå®ƒã€‚ å¹¶å‘ â‰  å¹¶è¡Œ å¹¶å‘ (concurrency) å’Œ å¹¶è¡Œ ( parallelism) æ˜¯ä¸åŒçš„ã€‚ åœ¨å•ä¸ª CPU æ ¸ä¸Šï¼Œçº¿ç¨‹é€šè¿‡æ—¶é—´ç‰‡æˆ–è€…è®©å‡ºæ§åˆ¶æƒæ¥å®ç°ä»»åŠ¡åˆ‡æ¢ï¼Œè¾¾åˆ° &quot;åŒæ—¶&quot; è¿è¡Œå¤šä¸ªä»»åŠ¡çš„ç›®çš„ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å¹¶å‘ã€‚ä½†å®é™…ä¸Šä»»ä½•æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œå…¶ä»–ä»»åŠ¡é€šè¿‡æŸç§ç®—æ³•æ¥æ’é˜Ÿã€‚ å¤šæ ¸ CPU å¯ä»¥è®©åŒä¸€è¿›ç¨‹å†…çš„ &quot;å¤šä¸ªçº¿ç¨‹&quot; åšåˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„åŒæ—¶è¿è¡Œï¼Œè¿™æ‰æ˜¯å¹¶è¡Œã€‚ è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹ è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œæœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚ çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯ CPU è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹ä¾é™„äºè¿›ç¨‹å­˜åœ¨ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šå…±äº«çˆ¶è¿›ç¨‹çš„èµ„æºã€‚ åç¨‹ï¼š**åç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ï¼Œ**åç¨‹çš„è°ƒåº¦å®Œå…¨ç”±ç”¨æˆ·æ§åˆ¶ï¼Œåç¨‹é—´åˆ‡æ¢åªéœ€è¦ä¿å­˜ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ï¼Œæ²¡æœ‰å†…æ ¸çš„å¼€é”€ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ ç”±äºä¸­æ–­å¤„ç†ï¼Œå¤šä»»åŠ¡å¤„ç†ï¼Œç”¨æˆ·æ€åˆ‡æ¢ç­‰åŸå› ä¼šå¯¼è‡´ CPU ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ‡æ¢è¿‡ç¨‹éœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹çš„çŠ¶æ€å¹¶æ¢å¤å¦ä¸€ä¸ªè¿›ç¨‹çš„çŠ¶æ€ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä»£ä»·æ˜¯é«˜æ˜‚çš„ï¼Œå› ä¸ºåœ¨æ ¸å¿ƒä¸Šäº¤æ¢çº¿ç¨‹ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å»¶è¿Ÿå–å†³äºä¸åŒçš„å› ç´ ï¼Œå¤§æ¦‚åœ¨åœ¨ 50 åˆ° 100 çº³ç§’ä¹‹é—´ã€‚è€ƒè™‘åˆ°ç¡¬ä»¶å¹³å‡åœ¨æ¯ä¸ªæ ¸å¿ƒä¸Šæ¯çº³ç§’æ‰§è¡Œ 12 æ¡æŒ‡ä»¤ï¼Œé‚£ä¹ˆä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å¯èƒ½ä¼šèŠ±è´¹ 600 åˆ° 1200 æ¡æŒ‡ä»¤çš„å»¶è¿Ÿæ—¶é—´ã€‚å®é™…ä¸Šï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å ç”¨äº†å¤§é‡ç¨‹åºæ‰§è¡ŒæŒ‡ä»¤çš„æ—¶é—´ã€‚ å¦‚æœå­˜åœ¨è·¨æ ¸ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆCross-Core Context Switchï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´ CPU ç¼“å­˜å¤±æ•ˆï¼ˆCPU ä»ç¼“å­˜è®¿é—®æ•°æ®çš„æˆæœ¬å¤§çº¦ 3 åˆ° 40 ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œä»ä¸»å­˜è®¿é—®æ•°æ®çš„æˆæœ¬å¤§çº¦ 100 åˆ° 300 ä¸ªæ—¶é’Ÿå‘¨æœŸï¼‰ï¼Œè¿™ç§åœºæ™¯çš„åˆ‡æ¢æˆæœ¬ä¼šæ›´åŠ æ˜‚è´µã€‚ Golang ä¸ºå¹¶å‘è€Œç”Ÿ Golang ä» 2009 å¹´æ­£å¼å‘å¸ƒä»¥æ¥ï¼Œä¾é å…¶æé«˜è¿è¡Œé€Ÿåº¦å’Œé«˜æ•ˆçš„å¼€å‘æ•ˆç‡ï¼Œè¿…é€Ÿå æ®å¸‚åœºä»½é¢ã€‚Golang ä»è¯­è¨€çº§åˆ«æ”¯æŒå¹¶å‘ï¼Œé€šè¿‡è½»é‡çº§åç¨‹ Goroutine æ¥å®ç°ç¨‹åºå¹¶å‘è¿è¡Œã€‚ Goroutine éå¸¸è½»é‡ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·å°ï¼š Goroutine ä¸Šä¸‹æ–‡åˆ‡æ¢åªæ¶‰åŠåˆ°ä¸‰ä¸ªå¯„å­˜å™¨ï¼ˆPC / SP / DXï¼‰çš„å€¼ä¿®æ”¹ï¼›è€Œå¯¹æ¯”çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ™éœ€è¦æ¶‰åŠæ¨¡å¼åˆ‡æ¢ï¼ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼‰ã€ä»¥åŠ 16 ä¸ªå¯„å­˜å™¨ã€PCã€SPâ€¦ç­‰å¯„å­˜å™¨çš„åˆ·æ–°ï¼› å†…å­˜å ç”¨å°‘ï¼š çº¿ç¨‹æ ˆç©ºé—´é€šå¸¸æ˜¯ 2Mï¼ŒGoroutine æ ˆç©ºé—´æœ€å° 2Kï¼› Golang ç¨‹åºä¸­å¯ä»¥è½»æ¾æ”¯æŒ10w çº§åˆ«çš„ Goroutine è¿è¡Œï¼Œè€Œçº¿ç¨‹æ•°é‡è¾¾åˆ° 1k æ—¶ï¼Œå†…å­˜å ç”¨å°±å·²ç»è¾¾åˆ° 2Gã€‚ Go è°ƒåº¦å™¨å®ç°æœºåˆ¶ï¼š Go ç¨‹åºé€šè¿‡è°ƒåº¦å™¨æ¥è°ƒåº¦**Goroutine åœ¨å†…æ ¸çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œ**ä½†æ˜¯ G Goroutineå¹¶ä¸ç›´æ¥ç»‘å®š OS çº¿ç¨‹ M - Machineè¿è¡Œï¼Œè€Œæ˜¯ç”± Goroutine Scheduler ä¸­çš„ P - Processor ï¼ˆé€»è¾‘å¤„ç†å™¨ï¼‰æ¥ä½œè·å–å†…æ ¸çº¿ç¨‹èµ„æºçš„ã€ä¸­ä»‹ã€ã€‚ Go è°ƒåº¦å™¨æ¨¡å‹æˆ‘ä»¬é€šå¸¸å«åšG-P-M æ¨¡å‹ï¼Œä»–åŒ…æ‹¬ 4 ä¸ªé‡è¦ç»“æ„ï¼Œåˆ†åˆ«æ˜¯Gã€Pã€Mã€Schedï¼š **G:Goroutineï¼Œ**æ¯ä¸ª Goroutine å¯¹åº”ä¸€ä¸ª G ç»“æ„ä½“ï¼ŒG å­˜å‚¨ Goroutine çš„è¿è¡Œå †æ ˆã€çŠ¶æ€ä»¥åŠä»»åŠ¡å‡½æ•°ï¼Œå¯é‡ç”¨ã€‚ G å¹¶éæ‰§è¡Œä½“ï¼Œæ¯ä¸ª G éœ€è¦ç»‘å®šåˆ° P æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œã€‚ **P: Processorï¼Œ**è¡¨ç¤ºé€»è¾‘å¤„ç†å™¨ï¼Œå¯¹ G æ¥è¯´ï¼ŒP ç›¸å½“äº CPU æ ¸ï¼ŒG åªæœ‰ç»‘å®šåˆ° P æ‰èƒ½è¢«è°ƒåº¦ã€‚å¯¹ M æ¥è¯´ï¼ŒP æä¾›äº†ç›¸å…³çš„æ‰§è¡Œç¯å¢ƒ(Context)ï¼Œå¦‚å†…å­˜åˆ†é…çŠ¶æ€(mcache)ï¼Œä»»åŠ¡é˜Ÿåˆ—(G)ç­‰ã€‚ P çš„æ•°é‡å†³å®šäº†ç³»ç»Ÿå†…æœ€å¤§å¯å¹¶è¡Œçš„ G çš„æ•°é‡ï¼ˆå‰æï¼šç‰©ç† CPU æ ¸æ•° &gt;= P çš„æ•°é‡ï¼‰ã€‚ P çš„æ•°é‡ç”±ç”¨æˆ·è®¾ç½®çš„ GoMAXPROCS å†³å®šï¼Œä½†æ˜¯ä¸è®º GoMAXPROCS è®¾ç½®ä¸ºå¤šå¤§ï¼ŒP çš„æ•°é‡æœ€å¤§ä¸º 256ã€‚ **M: Machineï¼Œ**OS å†…æ ¸çº¿ç¨‹æŠ½è±¡ï¼Œä»£è¡¨ç€çœŸæ­£æ‰§è¡Œè®¡ç®—çš„èµ„æºï¼Œåœ¨ç»‘å®šæœ‰æ•ˆçš„ P åï¼Œè¿›å…¥ schedule å¾ªç¯ï¼›è€Œ schedule å¾ªç¯çš„æœºåˆ¶å¤§è‡´æ˜¯ä» Global é˜Ÿåˆ—ã€P çš„ Local é˜Ÿåˆ—ä»¥åŠ wait é˜Ÿåˆ—ä¸­è·å–ã€‚ **M çš„æ•°é‡æ˜¯ä¸å®šçš„ï¼Œç”± Go Runtime è°ƒæ•´ï¼Œ**ä¸ºäº†é˜²æ­¢åˆ›å»ºè¿‡å¤š OS çº¿ç¨‹å¯¼è‡´ç³»ç»Ÿè°ƒåº¦ä¸è¿‡æ¥ï¼Œç›®å‰é»˜è®¤æœ€å¤§é™åˆ¶ä¸º 10000 ä¸ªã€‚ M å¹¶ä¸ä¿ç•™ G çŠ¶æ€ï¼Œè¿™æ˜¯ G å¯ä»¥è·¨ M è°ƒåº¦çš„åŸºç¡€ã€‚ **Schedï¼šGo è°ƒåº¦å™¨ï¼Œ**å®ƒç»´æŠ¤æœ‰å­˜å‚¨ M å’Œ G çš„é˜Ÿåˆ—ä»¥åŠè°ƒåº¦å™¨çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ç­‰ã€‚ è°ƒåº¦å™¨å¾ªç¯çš„æœºåˆ¶å¤§è‡´æ˜¯ä»å„ç§é˜Ÿåˆ—ã€P çš„æœ¬åœ°é˜Ÿåˆ—ä¸­è·å– Gï¼Œåˆ‡æ¢åˆ° G çš„æ‰§è¡Œæ ˆä¸Šå¹¶æ‰§è¡Œ G çš„å‡½æ•°ï¼Œè°ƒç”¨ Goexit åšæ¸…ç†å·¥ä½œå¹¶å›åˆ° Mï¼Œå¦‚æ­¤åå¤ã€‚ ç†è§£ Mã€Pã€G ä¸‰è€…çš„å…³ç³»ï¼Œå¯ä»¥é€šè¿‡ç»å…¸çš„åœ°é¼ æ¨è½¦æ¬ç –çš„æ¨¡å‹æ¥è¯´æ˜å…¶ä¸‰è€…å…³ç³»ï¼š åœ°é¼ (Gopher)çš„å·¥ä½œä»»åŠ¡æ˜¯ï¼šå·¥åœ°ä¸Šæœ‰è‹¥å¹²ç –å¤´ï¼Œåœ°é¼ å€ŸåŠ©å°è½¦æŠŠç –å¤´è¿é€åˆ°ç«ç§ä¸Šå»çƒ§åˆ¶ã€‚M å°±å¯ä»¥çœ‹ä½œå›¾ä¸­çš„åœ°é¼ ï¼ŒP å°±æ˜¯å°è½¦ï¼ŒG å°±æ˜¯å°è½¦é‡Œè£…çš„ç –ã€‚ å¼„æ¸…æ¥šäº†å®ƒä»¬ä¸‰è€…çš„å…³ç³»ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹é‡ç‚¹èŠåœ°é¼ æ˜¯å¦‚ä½•åœ¨æ¬è¿ç –å—çš„ã€‚ Processorï¼ˆPï¼‰ï¼š æ ¹æ®ç”¨æˆ·è®¾ç½®çš„ **GoMAXPROCS **å€¼æ¥åˆ›å»ºä¸€æ‰¹å°è½¦(P)ã€‚ Goroutine(G)ï¼š é€šè¿‡ Go å…³é”®å­—å°±æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ª Goroutineï¼Œä¹Ÿå°±ç›¸å½“äºåˆ¶é€ ä¸€å—ç –(G)ï¼Œç„¶åå°†è¿™å—ç –(G)æ”¾å…¥å½“å‰è¿™è¾†å°è½¦(P)ä¸­ã€‚ Machine (M)ï¼š åœ°é¼ (M)ä¸èƒ½é€šè¿‡å¤–éƒ¨åˆ›å»ºå‡ºæ¥ï¼Œåªèƒ½ç –(G)å¤ªå¤šäº†ï¼Œåœ°é¼ (M)åˆå¤ªå°‘äº†ï¼Œå®åœ¨å¿™ä¸è¿‡æ¥ï¼Œåˆšå¥½è¿˜æœ‰ç©ºé—²çš„å°è½¦(P)æ²¡æœ‰ä½¿ç”¨ï¼Œé‚£å°±ä»åˆ«å¤„å†å€Ÿäº›åœ°é¼ (M)è¿‡æ¥ç›´åˆ°æŠŠå°è½¦(P)ç”¨å®Œä¸ºæ­¢ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªåœ°é¼ (M)ä¸å¤Ÿç”¨ï¼Œä»åˆ«å¤„å€Ÿåœ°é¼ (M)çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ›å»ºä¸€ä¸ªå†…æ ¸çº¿ç¨‹(M)ã€‚ **éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**åœ°é¼ (M) å¦‚æœæ²¡æœ‰å°è½¦(P)æ˜¯æ²¡åŠæ³•è¿ç –çš„ï¼Œå°è½¦(P)çš„æ•°é‡å†³å®šäº†èƒ½å¤Ÿå¹²æ´»çš„åœ°é¼ (M)æ•°é‡ï¼Œåœ¨ Go ç¨‹åºé‡Œé¢å¯¹åº”çš„æ˜¯æ´»åŠ¨çº¿ç¨‹æ•°ï¼› åœ¨ Go ç¨‹åºé‡Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å›¾ç¤ºæ¥å±•ç¤º G-P-M æ¨¡å‹ï¼š P ä»£è¡¨å¯ä»¥â€œå¹¶è¡Œâ€è¿è¡Œçš„é€»è¾‘å¤„ç†å™¨ï¼Œæ¯ä¸ª P éƒ½è¢«åˆ†é…åˆ°ä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹ Mï¼ŒG ä»£è¡¨ Go åç¨‹ã€‚ Go è°ƒåº¦å™¨ä¸­æœ‰ä¸¤ä¸ªä¸åŒçš„è¿è¡Œé˜Ÿåˆ—ï¼šå…¨å±€è¿è¡Œé˜Ÿåˆ—(GRQ)å’Œæœ¬åœ°è¿è¡Œé˜Ÿåˆ—(LRQ)ã€‚ æ¯ä¸ª P éƒ½æœ‰ä¸€ä¸ª LRQï¼Œç”¨äºç®¡ç†åˆ†é…ç»™åœ¨ P çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ Goroutinesï¼Œè¿™äº› Goroutine è½®æµè¢«å’Œ P ç»‘å®šçš„ M è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚GRQ é€‚ç”¨äºå°šæœªåˆ†é…ç»™ P çš„ Goroutinesã€‚ **ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒG çš„æ•°é‡å¯ä»¥è¿œè¿œå¤§äº M çš„æ•°é‡ï¼Œæ¢å¥è¯è¯´ï¼ŒGo ç¨‹åºå¯ä»¥åˆ©ç”¨å°‘é‡çš„å†…æ ¸çº§çº¿ç¨‹æ¥æ”¯æ’‘å¤§é‡ Goroutine çš„å¹¶å‘ã€‚**å¤šä¸ª Goroutine é€šè¿‡ç”¨æˆ·çº§åˆ«çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¥å…±äº«å†…æ ¸çº¿ç¨‹ M çš„è®¡ç®—èµ„æºï¼Œä½†å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´å¹¶æ²¡æœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢äº§ç”Ÿçš„æ€§èƒ½æŸè€—ã€‚ ä¸ºäº†æ›´åŠ å……åˆ†åˆ©ç”¨çº¿ç¨‹çš„è®¡ç®—èµ„æºï¼ŒGo è°ƒåº¦å™¨é‡‡å–äº†ä»¥ä¸‹å‡ ç§è°ƒåº¦ç­–ç•¥ï¼š ä»»åŠ¡çªƒå–ï¼ˆwork-stealingï¼‰ æˆ‘ä»¬çŸ¥é“ï¼Œç°å®æƒ…å†µæœ‰çš„ Goroutine è¿è¡Œçš„å¿«ï¼Œæœ‰çš„æ…¢ï¼Œé‚£ä¹ˆåŠ¿å¿…è‚¯å®šä¼šå¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œå¿™çš„å¿™æ­»ï¼Œé—²çš„é—²æ­»ï¼ŒGo è‚¯å®šä¸å…è®¸æ‘¸é±¼çš„ P å­˜åœ¨ï¼ŒåŠ¿å¿…è¦å……åˆ†åˆ©ç”¨å¥½è®¡ç®—èµ„æºã€‚ ä¸ºäº†æé«˜ Go å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œè°ƒé«˜æ•´ä½“å¤„ç†æ•ˆç‡ï¼Œå½“æ¯ä¸ª P ä¹‹é—´çš„ G ä»»åŠ¡ä¸å‡è¡¡æ—¶ï¼Œè°ƒåº¦å™¨å…è®¸ä» GRQï¼Œæˆ–è€…å…¶ä»– P çš„ LRQ ä¸­è·å– G æ‰§è¡Œã€‚ å‡å°‘é˜»å¡ å¦‚æœæ­£åœ¨æ‰§è¡Œçš„ Goroutine é˜»å¡äº†çº¿ç¨‹ M æ€ä¹ˆåŠï¼ŸP ä¸Š LRQ ä¸­çš„ Goroutine ä¼šè·å–ä¸åˆ°è°ƒåº¦ä¹ˆï¼Ÿ åœ¨ Go é‡Œé¢é˜»å¡ä¸»è¦åˆ†ä¸ºä¸€ä¸‹ 4 ç§åœºæ™¯ï¼š åœºæ™¯ 1ï¼šç”±äºåŸå­ã€äº’æ–¥é‡æˆ–é€šé“æ“ä½œè°ƒç”¨å¯¼è‡´ Goroutine é˜»å¡ï¼Œè°ƒåº¦å™¨å°†æŠŠå½“å‰é˜»å¡çš„ Goroutine åˆ‡æ¢å‡ºå»ï¼Œé‡æ–°è°ƒåº¦ LRQ ä¸Šçš„å…¶ä»– Goroutineï¼› åœºæ™¯ 2ï¼šç”±äºç½‘ç»œè¯·æ±‚å’Œ IO æ“ä½œå¯¼è‡´ Goroutine é˜»å¡ï¼Œè¿™ç§é˜»å¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ G å’Œ M åˆä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ Go ç¨‹åºæä¾›äº†**ç½‘ç»œè½®è¯¢å™¨ï¼ˆNetPollerï¼‰**æ¥å¤„ç†ç½‘ç»œè¯·æ±‚å’Œ IO æ“ä½œçš„é—®é¢˜ï¼Œå…¶åå°é€šè¿‡ kqueueï¼ˆMacOSï¼‰ï¼Œepollï¼ˆLinuxï¼‰æˆ– iocpï¼ˆWindowsï¼‰æ¥å®ç° IO å¤šè·¯å¤ç”¨ã€‚ é€šè¿‡ä½¿ç”¨ NetPoller è¿›è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒåº¦å™¨å¯ä»¥é˜²æ­¢ Goroutine åœ¨è¿›è¡Œè¿™äº›ç³»ç»Ÿè°ƒç”¨æ—¶é˜»å¡ Mã€‚è¿™å¯ä»¥è®© M æ‰§è¡Œ P çš„ LRQ ä¸­å…¶ä»–çš„ Goroutinesï¼Œè€Œä¸éœ€è¦åˆ›å»ºæ–°çš„ Mã€‚æœ‰åŠ©äºå‡å°‘æ“ä½œç³»ç»Ÿä¸Šçš„è°ƒåº¦è´Ÿè½½ã€‚ **ä¸‹å›¾å±•ç¤ºå®ƒçš„å·¥ä½œåŸç†ï¼š**G1 æ­£åœ¨ M ä¸Šæ‰§è¡Œï¼Œè¿˜æœ‰ 3 ä¸ª Goroutine åœ¨ LRQ ä¸Šç­‰å¾…æ‰§è¡Œã€‚ç½‘ç»œè½®è¯¢å™¨ç©ºé—²ç€ï¼Œä»€ä¹ˆéƒ½æ²¡å¹²ã€‚ æ¥ä¸‹æ¥ï¼ŒG1 æƒ³è¦è¿›è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤å®ƒè¢«ç§»åŠ¨åˆ°ç½‘ç»œè½®è¯¢å™¨å¹¶ä¸”å¤„ç†å¼‚æ­¥ç½‘ç»œç³»ç»Ÿè°ƒç”¨ã€‚ç„¶åï¼ŒM å¯ä»¥ä» LRQ æ‰§è¡Œå¦å¤–çš„ Goroutineã€‚æ­¤æ—¶ï¼ŒG2 å°±è¢«ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ° M ä¸Šäº†ã€‚ æœ€åï¼Œå¼‚æ­¥ç½‘ç»œç³»ç»Ÿè°ƒç”¨ç”±ç½‘ç»œè½®è¯¢å™¨å®Œæˆï¼ŒG1 è¢«ç§»å›åˆ° P çš„ LRQ ä¸­ã€‚ä¸€æ—¦ G1 å¯ä»¥åœ¨ M ä¸Šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå®ƒè´Ÿè´£çš„ Go ç›¸å…³ä»£ç å°±å¯ä»¥å†æ¬¡æ‰§è¡Œã€‚è¿™é‡Œçš„æœ€å¤§ä¼˜åŠ¿æ˜¯ï¼Œæ‰§è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ä¸éœ€è¦é¢å¤–çš„ Mã€‚ç½‘ç»œè½®è¯¢å™¨ä½¿ç”¨ç³»ç»Ÿçº¿ç¨‹ï¼Œå®ƒæ—¶åˆ»å¤„ç†ä¸€ä¸ªæœ‰æ•ˆçš„äº‹ä»¶å¾ªç¯ã€‚ è¿™ç§è°ƒç”¨æ–¹å¼çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒGo è¯­è¨€å°†è¯¥â€œå¤æ‚æ€§â€éšè—åœ¨ Runtime ä¸­ï¼šGo å¼€å‘è€…æ— éœ€å…³æ³¨ socket æ˜¯å¦æ˜¯ non-block çš„ï¼Œä¹Ÿæ— éœ€äº²è‡ªæ³¨å†Œæ–‡ä»¶æè¿°ç¬¦çš„å›è°ƒï¼Œåªéœ€åœ¨æ¯ä¸ªè¿æ¥å¯¹åº”çš„ Goroutine ä¸­ä»¥â€œblock I/Oâ€çš„æ–¹å¼å¯¹å¾… socket å¤„ç†å³å¯ï¼Œå®ç°äº† goroutine-per-connection ç®€å•çš„ç½‘ç»œç¼–ç¨‹æ¨¡å¼ï¼ˆä½†æ˜¯å¤§é‡çš„ Goroutine ä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„é—®é¢˜ï¼Œæ¯”å¦‚æ ˆå†…å­˜å¢åŠ å’Œè°ƒåº¦å™¨è´Ÿæ‹…åŠ é‡ï¼‰ã€‚ ç”¨æˆ·å±‚çœ¼ä¸­çœ‹åˆ°çš„ Goroutine ä¸­çš„â€œblock socketâ€ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ Go runtime ä¸­çš„ netpoller é€šè¿‡ Non-block socket + I/O å¤šè·¯å¤ç”¨æœºåˆ¶â€œæ¨¡æ‹Ÿâ€å‡ºæ¥çš„ã€‚Go ä¸­çš„ net åº“æ­£æ˜¯æŒ‰ç…§è¿™æ–¹å¼å®ç°çš„ã€‚ **åœºæ™¯ 3ï¼š**å½“è°ƒç”¨ä¸€äº›ç³»ç»Ÿæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿæ–¹æ³•è°ƒç”¨çš„æ—¶å€™å‘ç”Ÿé˜»å¡ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç½‘ç»œè½®è¯¢å™¨ï¼ˆNetPollerï¼‰æ— æ³•ä½¿ç”¨ï¼Œè€Œè¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ Goroutine å°†é˜»å¡å½“å‰ Mã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹åŒæ­¥ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚æ–‡ä»¶ I/Oï¼‰ä¼šå¯¼è‡´ M é˜»å¡çš„æƒ…å†µï¼šG1 å°†è¿›è¡ŒåŒæ­¥ç³»ç»Ÿè°ƒç”¨ä»¥é˜»å¡ M1ã€‚ è°ƒåº¦å™¨ä»‹å…¥åï¼šè¯†åˆ«å‡º G1 å·²å¯¼è‡´ M1 é˜»å¡ï¼Œæ­¤æ—¶ï¼Œè°ƒåº¦å™¨å°† M1 ä¸ P åˆ†ç¦»ï¼ŒåŒæ—¶ä¹Ÿå°† G1 å¸¦èµ°ã€‚ç„¶åè°ƒåº¦å™¨å¼•å…¥æ–°çš„ M2 æ¥æœåŠ¡ Pã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä» LRQ ä¸­é€‰æ‹© G2 å¹¶åœ¨ M2 ä¸Šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨å®Œæˆåï¼šG1 å¯ä»¥ç§»å› LRQ å¹¶å†æ¬¡ç”± P æ‰§è¡Œã€‚å¦‚æœè¿™ç§æƒ…å†µå†æ¬¡å‘ç”Ÿï¼ŒM1 å°†è¢«æ”¾åœ¨æ—è¾¹ä»¥å¤‡å°†æ¥é‡å¤ä½¿ç”¨**ã€‚** **åœºæ™¯ 4ï¼š**å¦‚æœåœ¨ Goroutine å»æ‰§è¡Œä¸€ä¸ª sleep æ“ä½œï¼Œå¯¼è‡´ M è¢«é˜»å¡äº†ã€‚ Go ç¨‹åºåå°æœ‰ä¸€ä¸ªç›‘æ§çº¿ç¨‹ sysmonï¼Œå®ƒç›‘æ§é‚£äº›é•¿æ—¶é—´è¿è¡Œçš„ G ä»»åŠ¡ç„¶åè®¾ç½®å¯ä»¥å¼ºå çš„æ ‡è¯†ç¬¦ï¼Œåˆ«çš„ Goroutine å°±å¯ä»¥æŠ¢å…ˆè¿›æ¥æ‰§è¡Œã€‚ åªè¦ä¸‹æ¬¡è¿™ä¸ª Goroutine è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆå°±ä¼šè¢«å¼ºå ï¼ŒåŒæ—¶ä¹Ÿä¼šä¿æŠ¤ç°åœºï¼Œç„¶åé‡æ–°æ”¾å…¥ P çš„æœ¬åœ°é˜Ÿåˆ—é‡Œé¢ç­‰å¾…ä¸‹æ¬¡æ‰§è¡Œã€‚ å°ç»“ æœ¬æ–‡ä¸»è¦ä» Go è°ƒåº¦å™¨æ¶æ„å±‚é¢ä¸Šä»‹ç»äº† G-P-M æ¨¡å‹ï¼Œé€šè¿‡è¯¥æ¨¡å‹æ€æ ·å®ç°å°‘é‡å†…æ ¸çº¿ç¨‹æ”¯æ’‘å¤§é‡ Goroutine çš„å¹¶å‘è¿è¡Œã€‚ä»¥åŠé€šè¿‡ NetPollerã€sysmon ç­‰å¸®åŠ© Go ç¨‹åºå‡å°‘çº¿ç¨‹é˜»å¡ï¼Œå……åˆ†åˆ©ç”¨å·²æœ‰çš„è®¡ç®—èµ„æºï¼Œä»è€Œæœ€å¤§é™åº¦æé«˜ Go ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ å‚è€ƒæ–‡æ¡£ï¼š https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part1.html https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html https://segmentfault.com/a/1190000016038785 https://segmentfault.com/a/1190000016611742 https://segmentfault.com/a/1190000017333717 https://segmentfault.com/a/1190000015352983 https://segmentfault.com/a/1190000015464889 https://www.cnblogs.com/lxmhhy/p/6041001.html https://www.cnblogs.com/mokafamily/p/9975980.html https://studyGolang.com/articles/9211 https://www.zhihu.com/question/20862617 https://codeburst.io/why-Goroutines-are-not-lightweight-threads-7c460c1f155f https://blog.csdn.net/tiandyoin/article/details/76556702 https://www.jianshu.com/p/cc3c0fefee43 https://www.jianshu.com/p/a315224886d2 ä½œè€…ï¼š joellwangï¼Œè…¾è®¯ CSIG åå°å¼€å‘å·¥ç¨‹å¸ˆ æ›´å¤šç²¾å½©ï¼Œå°½åœ¨ è…¾è®¯æŠ€æœ¯ ","link":"https://ChicRingo.github.io/post/go-wei-shi-me-zhe-me-kuai/"},{"title":"Golang é¢è¯•é¢˜æ€»ç»“","content":"æ€»ç»“çš„ä¸€äº› Golang é¢è¯•ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ›´æ–°ä¸­ goçš„goroutineä¸ºä»€ä¹ˆå¿« Goroutine éå¸¸è½»é‡ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·å°ï¼š Goroutine ä¸Šä¸‹æ–‡åˆ‡æ¢åªæ¶‰åŠåˆ°ä¸‰ä¸ªå¯„å­˜å™¨ï¼ˆPC / SP / DXï¼‰çš„å€¼ä¿®æ”¹ï¼›è€Œå¯¹æ¯”çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ™éœ€è¦æ¶‰åŠæ¨¡å¼åˆ‡æ¢ï¼ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼‰ã€ä»¥åŠ 16 ä¸ªå¯„å­˜å™¨ã€PCã€SPâ€¦ç­‰å¯„å­˜å™¨çš„åˆ·æ–°ï¼› **å†…å­˜å ç”¨å°‘ï¼š**çº¿ç¨‹æ ˆç©ºé—´é€šå¸¸æ˜¯ 2Mï¼ŒGoroutine æ ˆç©ºé—´æœ€å° 2Kï¼› Golang ç¨‹åºä¸­å¯ä»¥è½»æ¾æ”¯æŒ10w çº§åˆ«çš„ Goroutine è¿è¡Œï¼Œè€Œçº¿ç¨‹æ•°é‡è¾¾åˆ° 1k æ—¶ï¼Œå†…å­˜å ç”¨å°±å·²ç»è¾¾åˆ° 2Gã€‚ åœ¨ Go ç¨‹åºé‡Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å›¾ç¤ºæ¥å±•ç¤º G-P-M æ¨¡å‹ï¼š P ä»£è¡¨å¯ä»¥â€œå¹¶è¡Œâ€è¿è¡Œçš„é€»è¾‘å¤„ç†å™¨ï¼Œæ¯ä¸ª P éƒ½è¢«åˆ†é…åˆ°ä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹ Mï¼ŒG ä»£è¡¨ Go åç¨‹ã€‚ Go è°ƒåº¦å™¨ä¸­æœ‰ä¸¤ä¸ªä¸åŒçš„è¿è¡Œé˜Ÿåˆ—ï¼šå…¨å±€è¿è¡Œé˜Ÿåˆ—(GRQ)å’Œæœ¬åœ°è¿è¡Œé˜Ÿåˆ—(LRQ)ã€‚ æ¯ä¸ª P éƒ½æœ‰ä¸€ä¸ª LRQï¼Œç”¨äºç®¡ç†åˆ†é…ç»™åœ¨ P çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ Goroutinesï¼Œè¿™äº› Goroutine è½®æµè¢«å’Œ P ç»‘å®šçš„ M è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚GRQ é€‚ç”¨äºå°šæœªåˆ†é…ç»™ P çš„ Goroutinesã€‚ **ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒG çš„æ•°é‡å¯ä»¥è¿œè¿œå¤§äº M çš„æ•°é‡ï¼Œæ¢å¥è¯è¯´ï¼ŒGo ç¨‹åºå¯ä»¥åˆ©ç”¨å°‘é‡çš„å†…æ ¸çº§çº¿ç¨‹æ¥æ”¯æ’‘å¤§é‡ Goroutine çš„å¹¶å‘ã€‚**å¤šä¸ª Goroutine é€šè¿‡ç”¨æˆ·çº§åˆ«çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¥å…±äº«å†…æ ¸çº¿ç¨‹ M çš„è®¡ç®—èµ„æºï¼Œä½†å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´å¹¶æ²¡æœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢äº§ç”Ÿçš„æ€§èƒ½æŸè€—ã€‚ Go ä¸ºä»€ä¹ˆè¿™ä¹ˆâ€œå¿«â€ çº¢é»‘æ ‘çš„ç‰¹ç‚¹ æ¯ä¸ªèŠ‚ç‚¹éçº¢å³é»‘ï¼› æ ¹èŠ‚ç‚¹æ€»æ˜¯é»‘è‰²çš„ï¼› æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼‰ï¼› å¦‚æœèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼ˆåä¹‹ä¸ä¸€å®šï¼‰ï¼› ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æˆ–ç©ºå­èŠ‚ç‚¹çš„æ¯æ¡è·¯å¾„ï¼Œå¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆå³ç›¸åŒçš„é»‘è‰²é«˜åº¦ï¼‰ã€‚ çº¢é»‘æ ‘çš„åº”ç”¨ï¼š TreeMapã€TreeSetä»¥åŠJAVA8çš„HashMapåº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚ çº¢é»‘æ ‘è‡ªå¹³è¡¡è°ƒæ•´æ–¹æ³•ï¼š å˜è‰² å˜è‰²ä»…ä»…æŒ‡çš„æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹çš„å˜è‰²ã€‚å› ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹å¿…é¡»æ˜¯ã€çº¢ã€‘æˆ–è€…ã€é»‘ã€‘è¿™ä¸¤ä¸­é¢œè‰²ï¼Œæ‰€ä»¥å˜è‰²åªæ˜¯å°†å½“å‰çš„èŠ‚ç‚¹é¢œè‰²è¿›è¡Œå˜åŒ–ï¼Œä»¥æ»¡è¶³ç‰¹æ€§ï¼ˆ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼‰ã€‚ æ—‹è½¬ å·¦æ—‹æ“ä½œåŠ¨ç”»ï¼ˆæ›´åŠ å®¹æ˜“ç†è§£å’Œè®°å¿†ï¼‰ï¼š /*************å¯¹çº¢é»‘æ ‘èŠ‚ç‚¹xè¿›è¡Œå·¦æ—‹æ“ä½œ ******************/ /* å·¦æ—‹ç¤ºæ„å›¾ï¼šå¯¹èŠ‚ç‚¹xè¿›è¡Œå·¦æ—‹ * p p * / / * x y * / \\ / \\ * lx y -----&gt; x ry * / \\ / \\ * ly ry lx ly * å·¦æ—‹åšäº†ä¸‰ä»¶äº‹ï¼š * 1. å°†yçš„å·¦å­èŠ‚ç‚¹èµ‹ç»™xçš„å³å­èŠ‚ç‚¹,å¹¶å°†xèµ‹ç»™yå·¦å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(yå·¦å­èŠ‚ç‚¹éç©ºæ—¶) * 2. å°†xçš„çˆ¶èŠ‚ç‚¹p(éç©ºæ—¶)èµ‹ç»™yçš„çˆ¶èŠ‚ç‚¹ï¼ŒåŒæ—¶æ›´æ–°pçš„å­èŠ‚ç‚¹ä¸ºy(å·¦æˆ–å³) * 3. å°†yçš„å·¦å­èŠ‚ç‚¹è®¾ä¸ºxï¼Œå°†xçš„çˆ¶èŠ‚ç‚¹è®¾ä¸ºy */ å·¦æ—‹æ“ä½œåŠ¨ç”» /*************å¯¹çº¢é»‘æ ‘èŠ‚ç‚¹yè¿›è¡Œå³æ—‹æ“ä½œ ******************/ /* å³æ—‹ç¤ºæ„å›¾ï¼šå¯¹èŠ‚ç‚¹yè¿›è¡Œå³æ—‹ * p p * / / * y x * / \\ / \\ * x ry -----&gt; lx y * / \\ / \\ * lx rx rx ry * å³æ—‹åšäº†ä¸‰ä»¶äº‹ï¼š * 1. å°†xçš„å³å­èŠ‚ç‚¹èµ‹ç»™yçš„å·¦å­èŠ‚ç‚¹,å¹¶å°†yèµ‹ç»™xå³å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(xå³å­èŠ‚ç‚¹éç©ºæ—¶) * 2. å°†yçš„çˆ¶èŠ‚ç‚¹p(éç©ºæ—¶)èµ‹ç»™xçš„çˆ¶èŠ‚ç‚¹ï¼ŒåŒæ—¶æ›´æ–°pçš„å­èŠ‚ç‚¹ä¸ºx(å·¦æˆ–å³) * 3. å°†xçš„å³å­èŠ‚ç‚¹è®¾ä¸ºyï¼Œå°†yçš„çˆ¶èŠ‚ç‚¹è®¾ä¸ºx */ å»¶ä¼¸ï¼šä¸ºä»€ä¹ˆç€è‰²æˆçº¢è‰²ï¼Œè€Œä¸æ˜¯é»‘è‰²å‘¢ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ çº¢é»‘æ ‘èŠ‚ç‚¹çš„æ·»åŠ  çº¢é»‘æ ‘çš„ç¬¬ 5 æ¡ç‰¹å¾è§„å®šï¼Œä»»ä¸€èŠ‚ç‚¹åˆ°å®ƒå­æ ‘çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸­éƒ½åŒ…å«åŒæ ·æ•°é‡çš„é»‘èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬å¾€çº¢é»‘æ ‘ä¸­æ’å…¥ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹æ—¶ï¼Œä¼šè¿èƒŒè¿™æ¡ç‰¹å¾ã€‚ åŒæ—¶ç¬¬ 4 æ¡ç‰¹å¾è§„å®šçº¢è‰²èŠ‚ç‚¹çš„å·¦å³å­©å­ä¸€å®šéƒ½æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œæœ‰å¯èƒ½å½“æˆ‘ä»¬ç»™ä¸€ä¸ªçº¢è‰²èŠ‚ç‚¹ä¸‹æ’å…¥ä¸€ä¸ªçº¢è‰²èŠ‚ç‚¹æ—¶ï¼Œä¼šè¿èƒŒè¿™æ¡ç‰¹å¾ã€‚ å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æ’å…¥é»‘è‰²èŠ‚ç‚¹åè¿›è¡Œç»“æ„è°ƒæ•´ï¼Œä¿è¯çº¢é»‘æ ‘å§‹ç»ˆæ»¡è¶³è¿™ 5 æ¡ç‰¹å¾ã€‚ çº¢é»‘æ ‘æ’å…¥åèŠ‚ç‚¹çš„è°ƒæ•´æ€æƒ³ æˆ‘ä»¬æ’å…¥é»‘è‰²èŠ‚ç‚¹çš„æ—¶å€™æ‹…å¿ƒè¿èƒŒç¬¬5æ¡ï¼Œæ’å…¥çº¢è‰²èŠ‚ç‚¹æ—¶æ‹…å¿ƒè¿èƒŒç¬¬4æ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å°†æ’å…¥çš„èŠ‚ç‚¹æ”¹ä¸ºçº¢è‰²ï¼Œç„¶ååˆ¤æ–­æ’å…¥çš„èŠ‚ç‚¹çš„çˆ¶äº²æ˜¯ä¸æ˜¯çº¢è‰²ï¼Œæ˜¯çš„è¯è¿›è¡Œä¿®æ”¹è°ƒæ•´ï¼ˆå˜è‰²ã€å·¦æ—‹ã€å³æ—‹ï¼‰ã€‚åŒæ—¶åœ¨è°ƒæ•´çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦éµå®ˆ5æ¡ç‰¹æ€§ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨çº¢é»‘æ ‘ï¼Ÿ ç®€å•æ¥è¯´çº¢é»‘æ ‘å°±æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¼ºé™·ï¼Œå› ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€åŒ–æˆä¸€ä¸ªçº¿æ€§ç»“æ„ã€‚è¯¦ç»†äº†è§£å¯ä»¥æŸ¥çœ‹ æ¼«ç”»ï¼šä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿï¼ˆä¹Ÿä»‹ç»åˆ°äº†äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œéå¸¸æ¨èï¼‰ æ¨èæ–‡ç« ï¼š æ¼«ç”»ï¼šä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿï¼ˆä¹Ÿä»‹ç»åˆ°äº†äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œéå¸¸æ¨èï¼‰ å¯»æ‰¾çº¢é»‘æ ‘çš„æ“ä½œæ‰‹å†Œï¼ˆæ–‡ç« æ’ç‰ˆä»¥åŠæ€è·¯çœŸçš„ä¸é”™ï¼‰ çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°ï¼ˆç¾å›¢ç‚¹è¯„æŠ€æœ¯å›¢é˜Ÿï¼‰ äºŒå‰æ ‘çš„ç‰¹ç‚¹ åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªéæ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ å‰æ ‘èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸¤ä¸ª äºŒå‰æ ‘æœ‰å·¦å³ä¹‹åˆ† äºŒå‰æ ‘ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ (1)å®Œå…¨äºŒå‰æ ‘â€”â€”è‹¥è®¾äºŒå‰æ ‘çš„é«˜åº¦ä¸ºhï¼Œé™¤ç¬¬ h å±‚å¤–ï¼Œå…¶å®ƒå„å±‚ (1ï½h-1) çš„ç»“ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§ä¸ªæ•°ï¼Œç¬¬hå±‚æœ‰å¶å­ç»“ç‚¹ï¼Œå¹¶ä¸”å¶å­ç»“ç‚¹éƒ½æ˜¯ä»å·¦åˆ°å³ä¾æ¬¡æ’å¸ƒï¼Œè¿™å°±æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œä¸éœ€è¦å¡«æ»¡äºŒå‰æ ‘ï¼Œæ¯”å¦‚ (2)æ»¡äºŒå‰æ ‘â€”â€”é™¤äº†å¶ç»“ç‚¹å¤–ï¼Œæ¯ä¸€ä¸ªç»“ç‚¹éƒ½æœ‰å·¦å³å­å¶ï¼Œä¸”å¶å­ç»“ç‚¹éƒ½å¤„åœ¨æœ€åº•å±‚çš„äºŒå‰æ ‘ã€‚ (3)å¹³è¡¡äºŒå‰æ ‘â€”â€”å¹³è¡¡äºŒå‰æ ‘åˆè¢«ç§°ä¸ºAVLæ ‘ï¼ˆåŒºåˆ«äºAVLç®—æ³•ï¼‰ï¼Œå®ƒæ˜¯ä¸€æ£µäºŒå‰æ’åºæ ‘ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå®ƒæ˜¯ä¸€æ£µç©ºæ ‘ï¼Œæˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰å…·å¤‡ä»€ä¹ˆç‰¹æ€§å‘¢ï¼Ÿ å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚ å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚ å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ã€‚ ç¼ºé™·ï¼šæœ‰å¯èƒ½ä¼šå˜æˆçº¿æ€§ ä¸‹å›¾ä¸­è¿™æ£µæ ‘ï¼Œå°±æ˜¯ä¸€é¢—å…¸å‹çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š å † æ•°æ®ç»“æ„ä¹‹å †çš„å®šä¹‰ å †æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„å®Œå…¨äºŒå‰æ ‘ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå¤§é¡¶å †ï¼›æˆ–è€…æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå°é¡¶å †ã€‚ å¦‚ä½•å¿«é€Ÿå»ºç«‹ä¸€ä¸ªå¹³è¡¡äºŒå‰æ ‘ å¹³è¡¡äºŒå‰æ ‘ï¼ˆç™¾åº¦ç™¾ç§‘ï¼Œå¹³è¡¡äºŒå‰æ ‘çš„å¸¸ç”¨å®ç°æ–¹æ³•æœ‰çº¢é»‘æ ‘ã€AVLã€æ›¿ç½ªç¾Šæ ‘ã€Treapã€ä¼¸å±•æ ‘ç­‰ ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦å·®éƒ½å°äºç­‰äº1ã€‚ æ‰¾æœ€ä½å¤±è¡¡èŠ‚ç‚¹ï¼Œé‚£å°±æ˜¯æ‰¾ä»æœ€åº•å±‚ï¼ˆå¶å­èŠ‚ç‚¹å±‚ï¼‰å¾€æœ€é«˜å±‚ï¼ˆrootå±‚ï¼‰ä¸­æœ€å…ˆå‡ºç°å·¦å³å­æ ‘é«˜åº¦å·®å¤§äº1çš„èŠ‚ç‚¹ã€‚ æ‰¾æ›¿ä»£èŠ‚ç‚¹å°±æ˜¯æ‰¾æå€¼ç‚¹ï¼Œå¦‚æœæ˜¯å·¦å­æ ‘å¤±è¡¡ï¼Œé‚£å°±æ‰¾å·¦å­æ ‘ä¸­çš„æœ€å¤§å€¼ï¼Œå› ä¸ºå½“å·¦å­æ ‘å¤±è¡¡æ—¶å°±è¡¨ç¤ºæˆ‘ä»¬ä¸éœ€è¦å¤„ç†å³å­æ ‘ï¼Œæ‰€ä»¥æ‰¾åˆ°å·¦å­æ ‘çš„æœ€å¤§å€¼ï¼Œä¹‹åæŠŠå³å­æ ‘èµ‹ç»™è¯¥èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹å³å¯ã€‚ åŒç†ï¼Œå¦‚æœæ˜¯å³å­æ ‘å¤±è¡¡é‚£å°±æ‰¾å³å­æ ‘ä¸­çš„æœ€å°å€¼ã€‚ å¹³è¡¡äºŒå‰æ ‘çš„ç‰¹ç‚¹ ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦å·®éƒ½å°äºç­‰äº1ã€‚ æ ‘çš„å±‚åºéå† åˆ¤æ–­æ ‘æ˜¯å¦å·¦å³å¯¹ç§°æˆ–æ•°ç»„æ˜¯å¦å·¦å³å¯¹ç§° Linuxå¸¸ç”¨å‘½ä»¤ ç›®å½•åˆ‡æ¢å‘½ä»¤ cd usrï¼š åˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸‹usrç›®å½• cd ..ï¼ˆæˆ–cd../ï¼‰ï¼š åˆ‡æ¢åˆ°ä¸Šä¸€å±‚ç›®å½• cd /ï¼š åˆ‡æ¢åˆ°ç³»ç»Ÿæ ¹ç›®å½• cd ~ï¼š åˆ‡æ¢åˆ°ç”¨æˆ·ä¸»ç›®å½• cd -ï¼š åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ“ä½œæ‰€åœ¨ç›®å½• ç›®å½•çš„æ“ä½œå‘½ä»¤(å¢åˆ æ”¹æŸ¥) mkdir ç›®å½•åç§°ï¼š å¢åŠ ç›®å½• lsæˆ–è€…llï¼ˆllæ˜¯ls -lçš„åˆ«åï¼Œllå‘½ä»¤å¯ä»¥çœ‹åˆ°è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼‰ï¼šæŸ¥çœ‹ç›®å½•ä¿¡æ¯ find ç›®å½• å‚æ•°ï¼š å¯»æ‰¾ç›®å½•ï¼ˆæŸ¥ï¼‰ ç¤ºä¾‹ï¼š åˆ—å‡ºå½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹: find . åœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾ä»¥.txtç»“å°¾çš„æ–‡ä»¶å:find /home -name &quot;*.txt&quot; åŒä¸Šï¼Œä½†å¿½ç•¥å¤§å°å†™: find /home -iname &quot;*.txt&quot; å½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰ä»¥.txtå’Œ.pdfç»“å°¾çš„æ–‡ä»¶:find . \\( -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot; \\)æˆ–find . -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot; mv ç›®å½•åç§° æ–°ç›®å½•åç§°ï¼š ä¿®æ”¹ç›®å½•çš„åç§°ï¼ˆæ”¹ï¼‰ æ³¨æ„ï¼šmvçš„è¯­æ³•ä¸ä»…å¯ä»¥å¯¹ç›®å½•è¿›è¡Œé‡å‘½åè€Œä¸”ä¹Ÿå¯ä»¥å¯¹å„ç§æ–‡ä»¶ï¼Œå‹ç¼©åŒ…ç­‰è¿›è¡Œ é‡å‘½åçš„æ“ä½œã€‚mvå‘½ä»¤ç”¨æ¥å¯¹æ–‡ä»¶æˆ–ç›®å½•é‡æ–°å‘½åï¼Œæˆ–è€…å°†æ–‡ä»¶ä»ä¸€ä¸ªç›®å½•ç§»åˆ°å¦ä¸€ä¸ªç›®å½•ä¸­ã€‚åé¢ä¼šä»‹ç»åˆ°mvå‘½ä»¤çš„å¦ä¸€ä¸ªç”¨æ³•ã€‚ mv ç›®å½•åç§° ç›®å½•çš„æ–°ä½ç½®ï¼š ç§»åŠ¨ç›®å½•çš„ä½ç½®---å‰ªåˆ‡ï¼ˆæ”¹ï¼‰ æ³¨æ„ï¼šmvè¯­æ³•ä¸ä»…å¯ä»¥å¯¹ç›®å½•è¿›è¡Œå‰ªåˆ‡æ“ä½œï¼Œå¯¹æ–‡ä»¶å’Œå‹ç¼©åŒ…ç­‰éƒ½å¯æ‰§è¡Œå‰ªåˆ‡æ“ä½œã€‚å¦å¤–mvä¸cpçš„ç»“æœä¸åŒï¼Œmvå¥½åƒæ–‡ä»¶â€œæ¬å®¶â€ï¼Œæ–‡ä»¶ä¸ªæ•°å¹¶æœªå¢åŠ ã€‚è€Œcpå¯¹æ–‡ä»¶è¿›è¡Œå¤åˆ¶ï¼Œæ–‡ä»¶ä¸ªæ•°å¢åŠ äº†ã€‚ cp -r ç›®å½•åç§° ç›®å½•æ‹·è´çš„ç›®æ ‡ä½ç½®ï¼š æ‹·è´ç›®å½•ï¼ˆæ”¹ï¼‰ï¼Œ-rä»£è¡¨é€’å½’æ‹·è´ æ³¨æ„ï¼šcpå‘½ä»¤ä¸ä»…å¯ä»¥æ‹·è´ç›®å½•è¿˜å¯ä»¥æ‹·è´æ–‡ä»¶ï¼Œå‹ç¼©åŒ…ç­‰ï¼Œæ‹·è´æ–‡ä»¶å’Œå‹ç¼©åŒ…æ—¶ä¸ ç”¨å†™-ré€’å½’ rm [-rf] ç›®å½•: åˆ é™¤ç›®å½•ï¼ˆåˆ ï¼‰ æ³¨æ„ï¼šrmä¸ä»…å¯ä»¥åˆ é™¤ç›®å½•ï¼Œä¹Ÿå¯ä»¥åˆ é™¤å…¶ä»–æ–‡ä»¶æˆ–å‹ç¼©åŒ…ï¼Œä¸ºäº†å¢å¼ºå¤§å®¶çš„è®°å¿†ï¼Œ æ— è®ºåˆ é™¤ä»»ä½•ç›®å½•æˆ–æ–‡ä»¶ï¼Œéƒ½ç›´æ¥ä½¿ç”¨rm -rf ç›®å½•/æ–‡ä»¶/å‹ç¼©åŒ… httpçŠ¶æ€ç  è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„ WWWï¼ˆä¸‡ç»´ç½‘ï¼‰ æ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡ HTTP æœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ å¸¸è§çš„çŠ¶æ€ç æœ‰200,301,302,304,404,500,403ã€‚ 200ï¼šæœ€å¸¸è§ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å“åº”æˆåŠŸï¼ŒæœåŠ¡å™¨æ‰¾åˆ°äº†å®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹ï¼Œå¹¶å°†å†…å®¹å‘é€ç»™äº†å®¢æˆ·ç«¯ã€‚ 500ï¼šæ¯”è¾ƒå¸¸è§ï¼Œè¡¨ç¤ºç¨‹åºé”™è¯¯ï¼Œå°±æ˜¯è¯´è¯·æ±‚çš„ç½‘é¡µç¨‹åºæœ¬èº«å°±æŠ¥é”™äº†ã€‚ç°åœ¨çš„æµè§ˆå™¨ä¼šå¯¹çŠ¶æ€ç 500åšå‡ºä¸€å®šçš„å¤„ç†ï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¼šè¿”å›ä¸€ä¸ªå®šåˆ¶çš„é”™è¯¯é¡µé¢ã€‚ 502ï¼šä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆå“åº”ï¼Œ 504ï¼šä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œæœªèƒ½åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆURIæ ‡è¯†å‡ºçš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚HTTPã€FTPã€LDAPï¼‰æˆ–è€…è¾…åŠ©æœåŠ¡å™¨ï¼ˆä¾‹å¦‚DNSï¼‰æ”¶åˆ°å“åº” 400ï¼šä¸ºåŒ…å«è¯­æ³•é”™è¯¯ï¼Œæ— æ³•è¢«æœåŠ¡å™¨è§£æ 403ï¼šä¸ºæœåŠ¡å™¨å·²ç»æ¥æ”¶è¯·æ±‚ï¼Œä½†æ˜¯è¢«æ‹’ç»æ‰§è¡Œ 404ï¼šæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¯¥èµ„æºï¼Œæˆ–è€…è¯´æ˜¯æœåŠ¡å™¨ä¸Šæ²¡æœ‰æ‰¾åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºï¼Œæ˜¯æœ€å¸¸è§çš„è¯·æ±‚é”™è¯¯ç ã€‚ 301ï¼šä¸´æ—¶è·³è½¬ã€‚urlåœ°å€aå¯ä»¥å‘urlåœ°å€bä¸Šè·³è½¬ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæœ‰å¯èƒ½è¿‡çŸ­æ—¶é—´å°±ä»urlåœ°å€aè·³è½¬åˆ°åœ°å€cã€‚ 302ï¼šæ°¸ä¹…æ€§çš„é‡å®šå‘ã€‚ 304ï¼šè¢«è¯·æ±‚çš„èµ„æºå†…å®¹æ²¡æœ‰å‘ç”Ÿæ›´æ”¹ã€‚ tcp udpåŒºåˆ« è¿è¾“å±‚ä¸»è¦ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§åè®®: 1. **ä¼ è¾“æ§åˆ¶åè®® TCP**ï¼ˆTransmission Control Protocolï¼‰--æä¾›**é¢å‘è¿æ¥**çš„ï¼Œ**å¯é çš„**æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ 2. **ç”¨æˆ·æ•°æ®åè®® UDP**ï¼ˆUser Datagram Protocolï¼‰--æä¾›**æ— è¿æ¥**çš„ï¼Œå°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼ˆ**ä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§**ï¼‰ã€‚ UDP åœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°ä¸»æœºåœ¨æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚è™½ç„¶ UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP ç¡®æ˜¯ä¸€ç§æœ€æœ‰æ•ˆçš„å·¥ä½œæ–¹å¼ï¼ˆä¸€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼‰ï¼Œæ¯”å¦‚ï¼š QQ è¯­éŸ³ã€ QQ è§†é¢‘ ã€ç›´æ’­ç­‰ç­‰ TCP æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚ TCP ä¸æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ã€‚ç”±äº TCP è¦æä¾›å¯é çš„ï¼Œé¢å‘è¿æ¥çš„ä¼ è¾“æœåŠ¡ï¼ˆTCPçš„å¯é ä½“ç°åœ¨TCPåœ¨ä¼ é€’æ•°æ®ä¹‹å‰ï¼Œä¼šæœ‰ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ï¼Œè€Œä¸”åœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œæœ‰ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼Œåœ¨æ•°æ®ä¼ å®Œåï¼Œè¿˜ä¼šæ–­å¼€è¿æ¥ç”¨æ¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼‰ï¼Œè¿™ä¸€éš¾ä»¥é¿å…å¢åŠ äº†è®¸å¤šå¼€é”€ï¼Œå¦‚ç¡®è®¤ï¼Œæµé‡æ§åˆ¶ï¼Œè®¡æ—¶å™¨ä»¥åŠè¿æ¥ç®¡ç†ç­‰ã€‚è¿™ä¸ä»…ä½¿åè®®æ•°æ®å•å…ƒçš„é¦–éƒ¨å¢å¤§å¾ˆå¤šï¼Œè¿˜è¦å ç”¨è®¸å¤šå¤„ç†æœºèµ„æºã€‚TCP ä¸€èˆ¬ç”¨äºæ–‡ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰åœºæ™¯ã€‚ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼š å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸€æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯ æœåŠ¡ç«¯â€“å‘é€å¸¦æœ‰ SYN/ACK æ ‡å¿—çš„æ•°æ®åŒ…â€“äºŒæ¬¡æ¡æ‰‹â€“å®¢æˆ·ç«¯ å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰å¸¦æœ‰ ACK æ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸‰æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯ å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹äº† TCP è¿æ¥ä»¥åï¼Œå½“æ•°æ®ä¼ é€å®Œæ¯•ï¼Œæ–­å¼€è¿æ¥å°±éœ€è¦è¿›è¡ŒTCPçš„å››æ¬¡æŒ¥æ‰‹ã€‚ å››æ¬¡æŒ¥æ‰‹å¦‚ä¸‹æ‰€ç¤ºï¼š æ–­å¼€ä¸€ä¸ª TCP è¿æ¥åˆ™éœ€è¦â€œå››æ¬¡æŒ¥æ‰‹â€ï¼š å®¢æˆ·ç«¯-å‘é€ä¸€ä¸ª FINï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®ä¼ é€ æœåŠ¡å™¨-æ”¶åˆ°è¿™ä¸ª FINï¼Œå®ƒå‘å›ä¸€ ä¸ª ACKï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1 ã€‚å’Œ SYN ä¸€æ ·ï¼Œä¸€ä¸ª FIN å°†å ç”¨ä¸€ä¸ªåºå· æœåŠ¡å™¨-å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯-å‘å› ACK æŠ¥æ–‡ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1 ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚ è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚ ä¸Šé¢è®²çš„æ¯”è¾ƒæ¦‚æ‹¬ï¼Œæ¨èä¸€ç¯‡è®²çš„æ¯”è¾ƒç»†è‡´çš„æ–‡ç« ï¼šhttps://blog.csdn.net/qzcsu/article/details/72861891 å¿«æ’æ€è·¯ å¿«æ’çš„æ€æƒ³ï¼š 1.å…ˆä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªæ•°ä½œä¸ºåŸºå‡†æ•°ï¼›ï¼ˆç¬¬ä¸€ä¸ªæˆ–è€…æœ€åä¸€ä¸ªï¼‰ 2.åˆ†åŒºè¿‡ç¨‹ï¼Œå°†æ¯”è¿™ä¸ªæ•°å¤§çš„æ•°å…¨éƒ¨æ”¾åˆ°å®ƒçš„å³è¾¹ï¼Œå°äºæˆ–ç­‰äºå®ƒçš„æ•°å…¨éƒ¨æ”¾åˆ°å®ƒçš„å·¦è¾¹ï¼› 3.å†å¯¹å·¦å³åŒºé—´è¿›è¡Œç¬¬äºŒæ­¥ï¼Œç›´åˆ°å„åŒºé—´åªæœ‰ä¸€ä¸ªæ•°ã€‚ å¿«æ’æ€è·¯ï¼š å¯ä»¥ç”¨è¡¥æ´æ€è·¯æ¥å®ç°ä¸Šè¾¹çš„å¿«æ’æ€æƒ³ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŒ–æ´ä¹‹åï¼Œè¡¥æ´ã€‚ æŒ–ä¸€ä¸ªæ´æ¥è¡¥æ´ï¼Œç›®çš„æ˜¯è¦æŠŠæ•°åˆ†åˆ°ä¸¤è¾¹ã€‚ å›¾ä¸€ å›¾äºŒ æ‰§è¡Œå®Œæ¯•åï¼Œæ¯”åŸºå‡†æ•°å°çš„åœ¨å·¦è¾¹ï¼Œæ¯”åŸºå‡†æ•°å¤§çš„åœ¨å³è¾¹ã€‚å› æ­¤å¯¹è¿™ä¸¤éƒ¨åˆ†é‡å¤è¿™ä¸ªæ­Œæ­¥éª¤å°±å¯ä»¥äº†ã€‚ æ³¨æ„ï¼š 1.æ´åœ¨å·¦è¾¹ä»£è¡¨å·¦è¾¹éƒ¨åˆ†å·²ç»æ’å¥½éƒ½æ˜¯æ¯”åŸºå‡†æ•°å°çš„ï¼Œæ´åœ¨å³è¾¹ä»£è¡¨å³è¾¹éƒ¨åˆ†å·²ç»æ’å¥½éƒ½æ˜¯æ¯”åŸºå‡†æ•°å¤§çš„ã€‚ 2.è¦è¡¥å·¦è¾¹çš„æ´ä»åå¾€å‰æ¯”åŸºå‡†æ•°å°çš„ï¼Œjé€’å¢ï¼›è¦è¡¥å³è¾¹çš„æ´ä»å‰å¾€åæ¯”åŸºå‡†æ•°å¤§çš„ï¼Œié€’å¢ã€‚ ä½œè€…ï¼šfrankisbaby é“¾æ¥ï¼šhttps://www.jianshu.com/p/f01c64fd2f93 æ¥æºï¼šç®€ä¹¦ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ 1. ç»å…¸å¿«é€Ÿæ’åºå›¾ç¤ºè¿‡ç¨‹ (1) ç»å…¸å¿«é€Ÿæ’åºçš„æ€»ä½“æµç¨‹ (2) æ ¹æ®åŸºå‡†å€¼åˆ†åŒºçš„è¿‡ç¨‹ åœ¨[ç®—æ³•é¢˜] è·å…°å›½æ——é—®é¢˜ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ 2. éšæœºå¿«é€Ÿæ’åº ç»å…¸å¿«é€Ÿæ’åºæ€»æ˜¯æŒ‡å®šæ•°ç»„æˆ–è€…æŸéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å€¼ï¼Œéšæœºå¿«é€Ÿæ’åºæŒ‡å®šæ•°ç»„æˆ–è€…æŸä¸€éƒ¨åˆ†ä¸­çš„éšæœºå€¼ä½œä¸ºåŸºå‡†å€¼ã€‚ 3. åŠ¨å›¾å±•ç¤º ä½œè€…ï¼šCoderJed é“¾æ¥ï¼šhttps://www.jianshu.com/p/a68f72278f8f æ¥æºï¼šç®€ä¹¦ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ åŠ¨ç”»æ¼”ç¤ºï¼šhttps://github.com/lzever/animationSort å¿«æ…¢æŒ‡é’ˆé—®é¢˜ http1.0å’Œ http1.1çš„åŒºåˆ«åŠçŠ¶æ€ç  HTTPçš„ç‰¹ç‚¹ï¼š æ”¯æŒå®¢æˆ·ç«¯ã€æœåŠ¡å™¨ç«¯æ¨¡å¼ï¼Œç®€å•å¿«é€Ÿï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ï¼Œçµæ´»ï¼ŒHTTPå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ï¼Œæ— è¿æ¥ï¼Œé™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œæ— çŠ¶æ€ï¼ŒHTTPåè®®æ˜¯æ— çŠ¶æ€åè®®ï¼ŒæŒ‡æ˜åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ HTTPéƒ½æ˜¯ç”±å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„ï¼Œå¹¶ä¸”ç”±æœåŠ¡å™¨ç«¯å›åº”å“åº”æ¶ˆæ¯çš„ã€‚ çµæ´»ï¼Œæˆ‘ä»¬çŸ¥é“å…è®¸å¯ä»¥ä»»ä½•ç±»å‹çš„æ•°æ®å¯¹è±¡ï¼ŒåŒ…æ‹¬éŸ³é¢‘ï¼Œè§†é¢‘ï¼Œå›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰ç­‰ã€‚ æ— çŠ¶æ€ï¼ŒHTTPå°±æ˜¯è¯´ï¼Œæ¯æ¬¡HTTPè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä»»ä½•ä¸¤ä¸ªè¯·æ±‚ä¹‹é—´æ²¡æœ‰å¿…ç„¶çš„è”ç³»ã€‚ æ— è¿æ¥çš„ï¼Œæ¯æ¬¡æœåŠ¡å™¨åœ¨å¤„ç†å®Œå®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå°±æ–­å¼€äº†é€šä¿¡ï¼Œå½“å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚æ—¶å°±æ˜¯ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ã€‚ **è¿™æ˜¯HTTP/1.0ç‰ˆçš„ä¸»è¦ç¼ºç‚¹ï¼Œ**æ¯ä¸ªTCPè¿æ¥åªèƒ½å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå‘é€æ•°æ®å®Œæ¯•åï¼Œè¿æ¥å°±å…³é—­äº†ï¼Œå¦‚æœè¿˜è¦è¯·æ±‚å°±å¿…é¡»è¦æ–°å»ºä¸€ä¸ªè¯·æ±‚è¿æ¥ã€‚ HTTPæ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œæ— çŠ¶æ€åè®®ï¼Œåè®®å¯¹äºå‘é€è¿‡æ¥çš„è¯·æ±‚æˆ–æ˜¯å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†ã€‚ HTTP1.1è™½ç„¶æ˜¯æ— çŠ¶æ€åè®®ï¼Œä½†æ˜¯ä¸ºäº†å®ç°æœŸæœ›çš„ä¿æŒçŠ¶æ€åŠŸèƒ½ï¼Œäºæ˜¯å¼•å…¥äº†CookieæŠ€æœ¯ï¼Œæœ‰äº†Cookieï¼Œå’ŒHTTPåè®®é€šä¿¡ï¼Œå°±å¯ä»¥ç®¡ç†çŠ¶æ€äº†ã€‚ TCPè¿æ¥çš„æ–°å»ºæˆæœ¬å¾ˆé«˜ï¼Œå› ä¸ºéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¸‰æ¬¡æ¡æ‰‹ã€‚ **äº¤æµçš„ç®€å•æµç¨‹ï¼š**å®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯å“åº”è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯å…³é—­è¿æ¥ã€‚ HTTPã€1.1ç‰ˆæœ¬æ˜¯æœ€æµè¡Œçš„ç‰ˆæœ¬ï¼Œå¯ä»¥æŒä¹…è¿æ¥ï¼ŒTCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ï¼Œåªæœ‰åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œæ²¡æœ‰è¯·æ±‚ï¼Œå°±å¯ä»¥è‡ªåŠ¨å…³é—­ã€‚ HTTP1.0å’ŒHTTP1.1åŒºåˆ«ï¼š è¿™éƒ¨åˆ†å›ç­”å¼•ç”¨è¿™ç¯‡æ–‡ç«  https://www.jianshu.com/p/be29d679cbff çš„ä¸€äº›å†…å®¹ã€‚ é•¿è¿æ¥ : åœ¨HTTP/1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°å»ºç«‹ä¸€æ¬¡è¿æ¥ã€‚HTTP æ˜¯åŸºäºTCP/IPåè®®çš„,æ¯ä¸€æ¬¡å»ºç«‹æˆ–è€…æ–­å¼€è¿æ¥éƒ½éœ€è¦ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹çš„å¼€é”€ï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦è¿™æ ·çš„è¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚å› æ­¤æœ€å¥½èƒ½ç»´æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå¯ä»¥ç”¨ä¸ªé•¿è¿æ¥æ¥å‘å¤šä¸ªè¯·æ±‚ã€‚HTTP 1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ ,é»˜è®¤å¼€å¯Connectionï¼š keep-aliveã€‚ HTTP/1.1çš„æŒç»­è¿æ¥æœ‰éæµæ°´çº¿æ–¹å¼å’Œæµæ°´çº¿æ–¹å¼ ã€‚æµæ°´çº¿æ–¹å¼æ˜¯å®¢æˆ·åœ¨æ”¶åˆ°HTTPçš„å“åº”æŠ¥æ–‡ä¹‹å‰å°±èƒ½æ¥ç€å‘é€æ–°çš„è¯·æ±‚æŠ¥æ–‡ã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„éæµæ°´çº¿æ–¹å¼æ˜¯å®¢æˆ·åœ¨æ”¶åˆ°å‰ä¸€ä¸ªå“åº”åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚ é”™è¯¯çŠ¶æ€å“åº”ç  :åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚ ç¼“å­˜å¤„ç† :åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚ å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨ :HTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚ Hostå¤´å¤„ç†ï¼Œåœ¨HTTP1.0ä¸­è®¤ä¸ºæ¯å°æœåŠ¡å™¨éƒ½ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå› æ­¤ï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­çš„URLå¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚ä½†éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•ï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆMulti-homed Web Serversï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ªIPåœ°å€ã€‚HTTP1.1çš„è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½åº”æ”¯æŒHostå¤´åŸŸï¼Œä¸”è¯·æ±‚æ¶ˆæ¯ä¸­å¦‚æœæ²¡æœ‰Hostå¤´åŸŸä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼ˆ400 Bad Requestï¼‰ã€‚ å»¶ä¼¸HTTP 2.0 HTTP2.0å’ŒHTTP1.Xç›¸æ¯”çš„æ–°ç‰¹æ€§ï¼š æ–°çš„äºŒè¿›åˆ¶æ ¼å¼ï¼ˆBinary Formatï¼‰ï¼ŒHTTP1.xçš„è§£ææ˜¯åŸºäºæ–‡æœ¬ã€‚åŸºäºæ–‡æœ¬åè®®çš„æ ¼å¼è§£æå­˜åœ¨å¤©ç„¶ç¼ºé™·ï¼Œæ–‡æœ¬çš„è¡¨ç°å½¢å¼æœ‰å¤šæ ·æ€§ï¼Œè¦åšåˆ°å¥å£®æ€§è€ƒè™‘çš„åœºæ™¯å¿…ç„¶å¾ˆå¤šï¼ŒäºŒè¿›åˆ¶åˆ™ä¸åŒï¼Œåªè®¤0å’Œ1çš„ç»„åˆã€‚åŸºäºè¿™ç§è€ƒè™‘HTTP2.0çš„åè®®è§£æå†³å®šé‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œå®ç°æ–¹ä¾¿ä¸”å¥å£®ã€‚ å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰ï¼Œå³è¿æ¥å…±äº«ï¼Œå³æ¯ä¸€ä¸ªrequestéƒ½æ˜¯æ˜¯ç”¨ä½œè¿æ¥å…±äº«æœºåˆ¶çš„ã€‚ä¸€ä¸ªrequestå¯¹åº”ä¸€ä¸ªidï¼Œè¿™æ ·ä¸€ä¸ªè¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªrequestï¼Œæ¯ä¸ªè¿æ¥çš„requestå¯ä»¥éšæœºçš„æ··æ‚åœ¨ä¸€èµ·ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ®requestçš„ idå°†requestå†å½’å±åˆ°å„è‡ªä¸åŒçš„æœåŠ¡ç«¯è¯·æ±‚é‡Œé¢ã€‚ headerå‹ç¼©ï¼Œå¦‚ä¸Šæ–‡ä¸­æ‰€è¨€ï¼Œå¯¹å‰é¢æåˆ°è¿‡HTTP1.xçš„headerå¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ï¼ŒHTTP2.0ä½¿ç”¨encoderæ¥å‡å°‘éœ€è¦ä¼ è¾“çš„headerå¤§å°ï¼Œé€šè®¯åŒæ–¹å„è‡ªcacheä¸€ä»½header fieldsè¡¨ï¼Œæ—¢é¿å…äº†é‡å¤headerçš„ä¼ è¾“ï¼Œåˆå‡å°äº†éœ€è¦ä¼ è¾“çš„å¤§å°ã€‚ æœåŠ¡ç«¯æ¨é€ï¼ˆserver pushï¼‰ï¼ŒåŒSPDYä¸€æ ·ï¼ŒHTTP2.0ä¹Ÿå…·æœ‰server pushåŠŸèƒ½ã€‚ HTTP2.0çš„å‡çº§æ”¹é€  å‰æ–‡è¯´äº†HTTP2.0å…¶å®å¯ä»¥æ”¯æŒéHTTPSçš„ï¼Œä½†æ˜¯ç°åœ¨ä¸»æµçš„æµè§ˆå™¨åƒchromeï¼Œfirefoxè¡¨ç¤ºè¿˜æ˜¯åªæ”¯æŒåŸºäº TLS éƒ¨ç½²çš„HTTP2.0åè®®ï¼Œæ‰€ä»¥è¦æƒ³å‡çº§æˆHTTP2.0è¿˜æ˜¯å…ˆå‡çº§HTTPSä¸ºå¥½ã€‚ å½“ä½ çš„ç½‘ç«™å·²ç»å‡çº§HTTPSä¹‹åï¼Œé‚£ä¹ˆå‡çº§HTTP2.0å°±ç®€å•å¾ˆå¤šï¼Œå¦‚æœä½ ä½¿ç”¨NGINXï¼Œåªè¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¯åŠ¨ç›¸åº”çš„åè®®å°±å¯ä»¥äº†ï¼Œå¯ä»¥å‚è€ƒNGINXç™½çš®ä¹¦ï¼ŒNGINXé…ç½®HTTP2.0å®˜æ–¹æŒ‡å— https://www.nginx.com/blog/nginx-1-9-5/ã€‚ ä½¿ç”¨äº†HTTP2.0é‚£ä¹ˆï¼ŒåŸæœ¬çš„HTTP1.xæ€ä¹ˆåŠï¼Œè¿™ä¸ªé—®é¢˜å…¶å®ä¸ç”¨æ‹…å¿ƒï¼ŒHTTP2.0å®Œå…¨å…¼å®¹HTTP1.xçš„è¯­ä¹‰ï¼Œå¯¹äºä¸æ”¯æŒHTTP2.0çš„æµè§ˆå™¨ï¼ŒNGINXä¼šè‡ªåŠ¨å‘ä¸‹å…¼å®¹çš„ã€‚ HTTP2.0çš„å¤šè·¯å¤ç”¨å’ŒHTTP1.Xä¸­çš„é•¿è¿æ¥å¤ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ HTTP/1.* ä¸€æ¬¡è¯·æ±‚-å“åº”ï¼Œå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œç”¨å®Œå…³é—­ï¼›æ¯ä¸€ä¸ªè¯·æ±‚éƒ½è¦å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼› HTTP/1.1 Pipelingè§£å†³æ–¹å¼ä¸ºï¼Œè‹¥å¹²ä¸ªè¯·æ±‚æ’é˜Ÿä¸²è¡ŒåŒ–å•çº¿ç¨‹å¤„ç†ï¼Œåé¢çš„è¯·æ±‚ç­‰å¾…å‰é¢è¯·æ±‚çš„è¿”å›æ‰èƒ½è·å¾—æ‰§è¡Œæœºä¼šï¼Œä¸€æ—¦æœ‰æŸè¯·æ±‚è¶…æ—¶ç­‰ï¼Œåç»­è¯·æ±‚åªèƒ½è¢«é˜»å¡ï¼Œæ¯«æ— åŠæ³•ï¼Œä¹Ÿå°±æ˜¯äººä»¬å¸¸è¯´çš„çº¿å¤´é˜»å¡ï¼› HTTP/2å¤šä¸ªè¯·æ±‚å¯åŒæ—¶åœ¨ä¸€ä¸ªè¿æ¥ä¸Šå¹¶è¡Œæ‰§è¡Œã€‚æŸä¸ªè¯·æ±‚ä»»åŠ¡è€—æ—¶ä¸¥é‡ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒè¿æ¥çš„æ­£å¸¸æ‰§è¡Œï¼› å…·ä½“å¦‚å›¾ï¼š ä¸ºä»€ä¹ˆéœ€è¦å¤´éƒ¨å‹ç¼©ï¼Ÿ å‡å®šä¸€ä¸ªé¡µé¢æœ‰100ä¸ªèµ„æºéœ€è¦åŠ è½½ï¼ˆè¿™ä¸ªæ•°é‡å¯¹äºä»Šå¤©çš„Webè€Œè¨€è¿˜æ˜¯æŒºä¿å®ˆçš„ï¼‰, è€Œæ¯ä¸€æ¬¡è¯·æ±‚éƒ½æœ‰1kbçš„æ¶ˆæ¯å¤´ï¼ˆè¿™åŒæ ·ä¹Ÿå¹¶ä¸å°‘è§ï¼Œå› ä¸ºCookieå’Œå¼•ç”¨ç­‰ä¸œè¥¿çš„å­˜åœ¨ï¼‰, åˆ™è‡³å°‘éœ€è¦å¤šæ¶ˆè€—100kbæ¥è·å–è¿™äº›æ¶ˆæ¯å¤´ã€‚HTTP2.0å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­—å…¸ï¼Œå·®é‡æ›´æ–°HTTPå¤´éƒ¨ï¼Œå¤§å¤§é™ä½å› å¤´éƒ¨ä¼ è¾“äº§ç”Ÿçš„æµé‡ã€‚å…·ä½“å‚è€ƒï¼šHTTP/2 å¤´éƒ¨å‹ç¼©æŠ€æœ¯ä»‹ç» HTTP2.0å¤šè·¯å¤ç”¨æœ‰å¤šå¥½ï¼Ÿ HTTP æ€§èƒ½ä¼˜åŒ–çš„å…³é”®å¹¶ä¸åœ¨äºé«˜å¸¦å®½ï¼Œè€Œæ˜¯ä½å»¶è¿Ÿã€‚TCP è¿æ¥ä¼šéšç€æ—¶é—´è¿›è¡Œè‡ªæˆ‘ã€Œè°ƒè°ã€ï¼Œèµ·åˆä¼šé™åˆ¶è¿æ¥çš„æœ€å¤§é€Ÿåº¦ï¼Œå¦‚æœæ•°æ®æˆåŠŸä¼ è¾“ï¼Œä¼šéšç€æ—¶é—´çš„æ¨ç§»æé«˜ä¼ è¾“çš„é€Ÿåº¦ã€‚è¿™ç§è°ƒè°åˆ™è¢«ç§°ä¸º TCP æ…¢å¯åŠ¨ã€‚ç”±äºè¿™ç§åŸå› ï¼Œè®©åŸæœ¬å°±å…·æœ‰çªå‘æ€§å’ŒçŸ­æ—¶æ€§çš„ HTTP è¿æ¥å˜çš„ååˆ†ä½æ•ˆã€‚ HTTP/2 é€šè¿‡è®©æ‰€æœ‰æ•°æ®æµå…±ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œå¯ä»¥æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ TCP è¿æ¥ï¼Œè®©é«˜å¸¦å®½ä¹Ÿèƒ½çœŸæ­£çš„æœåŠ¡äº HTTP çš„æ€§èƒ½æå‡ã€‚ httpå’Œhttpsçš„åŒºåˆ« HTTPSåè®®éœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦å¾ˆå°‘ï¼Œéœ€è¦äº¤è´¹ã€‚ HTTPSå¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢è¿è¥å•†åŠ«æŒï¼Œè§£å†³äº†é˜²åŠ«æŒçš„ä¸€ä¸ªå¤§é—®é¢˜ã€‚ ç«¯å£ ï¼š HTTPçš„URLç”±â€œhttp://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£80ï¼Œè€ŒHTTPSçš„URLç”±â€œhttps://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£443ã€‚ å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—ï¼š HTTPåè®®è¿è¡Œåœ¨TCPä¹‹ä¸Šï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ— æ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ã€‚HTTPSæ˜¯è¿è¡Œåœ¨SSL/TLSä¹‹ä¸Šçš„HTTPåè®®ï¼ŒSSL/TLS è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPSé«˜ï¼Œä½†æ˜¯ HTTPS æ¯”HTTPè€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚ å¯¹ç§°åŠ å¯†ï¼šå¯†é’¥åªæœ‰ä¸€ä¸ªï¼ŒåŠ å¯†è§£å¯†ä¸ºåŒä¸€ä¸ªå¯†ç ï¼Œä¸”åŠ è§£å¯†é€Ÿåº¦å¿«ï¼Œå…¸å‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰DESã€AESç­‰ï¼› éå¯¹ç§°åŠ å¯†ï¼šå¯†é’¥æˆå¯¹å‡ºç°ï¼ˆä¸”æ ¹æ®å…¬é’¥æ— æ³•æ¨çŸ¥ç§é’¥ï¼Œæ ¹æ®ç§é’¥ä¹Ÿæ— æ³•æ¨çŸ¥å…¬é’¥ï¼‰ï¼ŒåŠ å¯†è§£å¯†ä½¿ç”¨ä¸åŒå¯†é’¥ï¼ˆå…¬é’¥åŠ å¯†éœ€è¦ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†éœ€è¦å…¬é’¥è§£å¯†ï¼‰ï¼Œç›¸å¯¹å¯¹ç§°åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ï¼Œå…¸å‹çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰RSAã€DSAç­‰ã€‚ redisç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ 1. ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ ç¼“å­˜ç©¿é€è¯´ç®€å•ç‚¹å°±æ˜¯å¤§é‡è¯·æ±‚çš„ key æ ¹æœ¬ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°äº†æ•°æ®åº“ä¸Šï¼Œæ ¹æœ¬æ²¡æœ‰ç»è¿‡ç¼“å­˜è¿™ä¸€å±‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæŸä¸ªé»‘å®¢æ•…æ„åˆ¶é€ æˆ‘ä»¬ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„ key å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°æ•°æ®åº“ã€‚ 2. ç¼“å­˜ç©¿é€æƒ…å†µçš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”¨æˆ·çš„è¯·æ±‚æœ€ç»ˆéƒ½è¦è·‘åˆ°æ•°æ®åº“ä¸­æŸ¥è¯¢ä¸€éã€‚ 3. æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ æœ€åŸºæœ¬çš„å°±æ˜¯é¦–å…ˆåšå¥½å‚æ•°æ ¡éªŒï¼Œä¸€äº›ä¸åˆæ³•çš„å‚æ•°è¯·æ±‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ¯”å¦‚æŸ¥è¯¢çš„æ•°æ®åº“ id ä¸èƒ½å°äº 0ã€ä¼ å…¥çš„é‚®ç®±æ ¼å¼ä¸å¯¹çš„æ—¶å€™ç›´æ¥è¿”å›é”™è¯¯æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ç­‰ç­‰ã€‚ 1ï¼‰ç¼“å­˜æ— æ•ˆ key å¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™ä¸€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š SET key value EX 10086 ã€‚è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœéè¦ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†æ— æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹æ¯”å¦‚ 1 åˆ†é’Ÿã€‚ å¦å¤–ï¼Œè¿™é‡Œå¤šè¯´ä¸€å˜´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯è¿™æ ·è®¾è®¡ key çš„ï¼š è¡¨å:åˆ—å:ä¸»é”®å:ä¸»é”®å€¼ ã€‚ 2ï¼‰å¸ƒéš†è¿‡æ»¤å™¨ å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªéå¸¸ç¥å¥‡çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ¤æ–­ä¸€ä¸ªç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨äºæµ·é‡æ•°æ®ä¸­ã€‚æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯åˆ¤æ–­ key æ˜¯å¦åˆæ³•ï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰¾çš„é‚£ä¸ªâ€œäººâ€ã€‚ å…·ä½“æ˜¯è¿™æ ·åšçš„ï¼šæŠŠæ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¯·æ±‚çš„å€¼éƒ½å­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿‡æ¥ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·å‘æ¥çš„è¯·æ±‚çš„å€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥è¿”å›è¯·æ±‚å‚æ•°é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå­˜åœ¨çš„è¯æ‰ä¼šèµ°ä¸‹é¢çš„æµç¨‹ã€‚ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¹‹åçš„ç¼“å­˜å¤„ç†æµç¨‹å›¾å¦‚ä¸‹ã€‚ ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¯¯åˆ¤çš„æƒ…å†µå‘¢? æˆ‘ä»¬è¿˜è¦ä»å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ¥è¯´ï¼ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚ æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼› å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ ç„¶åï¼Œä¸€å®šä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼šä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒã€‚ ï¼ˆå¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°æ¥é™ä½æ¦‚ç‡ï¼‰ æ›´å¤šå…³äºå¸ƒéš†è¿‡æ»¤å™¨çš„å†…å®¹å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡åŸåˆ›ï¼šã€Šä¸äº†è§£å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿä¸€æ–‡ç»™ä½ æ•´çš„æ˜æ˜ç™½ç™½ï¼ã€‹ ï¼Œå¼ºçƒˆæ¨èï¼Œä¸ªäººæ„Ÿè§‰ç½‘ä¸Šåº”è¯¥æ‰¾ä¸åˆ°æ€»ç»“çš„è¿™ä¹ˆæ˜æ˜ç™½ç™½çš„æ–‡ç« äº†ã€‚ 1. ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ æˆ‘å‘ç°ç¼“å­˜é›ªå´©è¿™åå­—èµ·çš„æœ‰ç‚¹æ„æ€ï¼Œå“ˆå“ˆã€‚ å®é™…ä¸Šï¼Œç¼“å­˜é›ªå´©æè¿°çš„å°±æ˜¯è¿™æ ·ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œåé¢çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚ã€‚ è¿™å°±å¥½æ¯”é›ªå´©ä¸€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ®åº“çš„å‹åŠ›å¯æƒ³è€ŒçŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šç³»ç»Ÿçš„ç¼“å­˜æ¨¡å—å‡ºäº†é—®é¢˜æ¯”å¦‚å®•æœºå¯¼è‡´ä¸å¯ç”¨ã€‚é€ æˆç³»ç»Ÿçš„æ‰€æœ‰è®¿é—®ï¼Œéƒ½è¦èµ°æ•°æ®åº“ã€‚ è¿˜æœ‰ä¸€ç§ç¼“å­˜é›ªå´©çš„åœºæ™¯æ˜¯ï¼šæœ‰ä¸€äº›è¢«å¤§é‡è®¿é—®æ•°æ®ï¼ˆçƒ­ç‚¹ç¼“å­˜ï¼‰åœ¨æŸä¸€æ—¶åˆ»å¤§é¢ç§¯å¤±æ•ˆï¼Œå¯¼è‡´å¯¹åº”çš„è¯·æ±‚ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šã€‚ è¿™æ ·çš„æƒ…å†µï¼Œæœ‰ä¸‹é¢å‡ ç§è§£å†³åŠæ³•ï¼š ä¸¾ä¸ªä¾‹å­ ï¼šç§’æ€å¼€å§‹ 12 ä¸ªå°æ—¶ä¹‹å‰ï¼Œæˆ‘ä»¬ç»Ÿä¸€å­˜æ”¾äº†ä¸€æ‰¹å•†å“åˆ° Redis ä¸­ï¼Œè®¾ç½®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯ 12 ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆç§’æ€å¼€å§‹çš„æ—¶å€™ï¼Œè¿™äº›ç§’æ€çš„å•†å“çš„è®¿é—®ç›´æ¥å°±å¤±æ•ˆäº†ã€‚å¯¼è‡´çš„æƒ…å†µå°±æ˜¯ï¼Œç›¸åº”çš„è¯·æ±‚ç›´æ¥å°±è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå°±åƒé›ªå´©ä¸€æ ·å¯æ€•ã€‚ 2. æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼š é‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿ç”¨ã€‚ é™æµï¼Œé¿å…åŒæ—¶å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚ é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´æ¯”å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ã€‚ ç¼“å­˜æ°¸ä¸å¤±æ•ˆã€‚ åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ ä¸ºä½•éœ€è¦åˆ†å¸ƒå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ†å¸ƒå¼é”ä¸»è¦æœ‰ä¸¤ä¸ªåœºæ™¯ï¼š é¿å…ä¸åŒèŠ‚ç‚¹é‡å¤ç›¸åŒçš„å·¥ä½œï¼šæ¯”å¦‚ç”¨æˆ·æ‰§è¡Œäº†æŸä¸ªæ“ä½œæœ‰å¯èƒ½ä¸åŒèŠ‚ç‚¹ä¼šå‘é€å¤šå°é‚®ä»¶ï¼› é¿å…ç ´åæ•°æ®çš„æ­£ç¡®æ€§ï¼šå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åœ¨åŒä¸€æ¡æ•°æ®ä¸ŠåŒæ—¶è¿›è¡Œæ“ä½œï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®é”™è¯¯æˆ–ä¸ä¸€è‡´çš„æƒ…å†µå‡ºç°ï¼› Redis åˆ†å¸ƒå¼é”çš„é—®é¢˜ 1ï¼‰é”è¶…æ—¶ å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤å°å¹³è¡Œçš„æœåŠ¡ A Bï¼Œå…¶ä¸­ A æœåŠ¡åœ¨ è·å–é”ä¹‹å ç”±äºæœªçŸ¥ç¥ç§˜åŠ›é‡çªç„¶ æŒ‚äº†ï¼Œé‚£ä¹ˆ B æœåŠ¡å°±æ°¸è¿œæ— æ³•è·å–åˆ°é”äº†ï¼š æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢å¤–è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œæ¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚ ä½†æ˜¯å¦ä¸€ä¸ªé—®é¢˜éšå³è€Œæ¥ï¼šå¦‚æœåœ¨åŠ é”å’Œé‡Šæ”¾é”ä¹‹é—´çš„é€»è¾‘æ‰§è¡Œå¾—å¤ªé•¿ï¼Œä»¥è‡³äºè¶…å‡ºäº†é”çš„è¶…æ—¶é™åˆ¶ï¼Œä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚å› ä¸ºè¿™æ—¶å€™ç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”è¿‡æœŸäº†ï¼Œè€Œä¸´ç•ŒåŒºçš„é€»è¾‘è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¸æ­¤åŒæ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°±æå‰æ‹¥æœ‰äº†è¿™æŠŠé”ï¼Œå¯¼è‡´ä¸´ç•ŒåŒºçš„ä»£ç ä¸èƒ½å¾—åˆ°ä¸¥æ ¼çš„ä¸²è¡Œæ‰§è¡Œã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒRedis åˆ†å¸ƒå¼é”ä¸è¦ç”¨äºè¾ƒé•¿æ—¶é—´çš„ä»»åŠ¡ã€‚å¦‚æœçœŸçš„å¶å°”å‡ºç°äº†é—®é¢˜ï¼Œé€ æˆçš„æ•°æ®å°é”™ä¹±å¯èƒ½å°±éœ€è¦äººå·¥çš„å¹²é¢„ã€‚ æœ‰ä¸€ä¸ªç¨å¾®å®‰å…¨ä¸€ç‚¹çš„æ–¹æ¡ˆæ˜¯ å°†é”çš„ value å€¼è®¾ç½®ä¸ºä¸€ä¸ªéšæœºæ•°ï¼Œé‡Šæ”¾é”æ—¶å…ˆåŒ¹é…éšæœºæ•°æ˜¯å¦ä¸€è‡´ï¼Œç„¶åå†åˆ é™¤ keyï¼Œè¿™æ˜¯ä¸ºäº† ç¡®ä¿å½“å‰çº¿ç¨‹å æœ‰çš„é”ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ï¼Œé™¤éè¿™ä¸ªé”æ˜¯å› ä¸ºè¿‡æœŸäº†è€Œè¢«æœåŠ¡å™¨è‡ªåŠ¨é‡Šæ”¾çš„ã€‚ ä½†æ˜¯åŒ¹é… value å’Œåˆ é™¤ key åœ¨ Redis ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼ä¿è¯åŸå­æ€§çš„æŒ‡ä»¤ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä½¿ç”¨åƒ Lua è¿™æ ·çš„è„šæœ¬æ¥å¤„ç†äº†ï¼Œå› ä¸º Lua è„šæœ¬å¯ä»¥ ä¿è¯å¤šä¸ªæŒ‡ä»¤çš„åŸå­æ€§æ‰§è¡Œã€‚ å»¶ä¼¸çš„è®¨è®ºï¼šGC å¯èƒ½å¼•å‘çš„å®‰å…¨é—®é¢˜ Martin Kleppmann æ›¾ä¸ Redis ä¹‹çˆ¶ Antirez å°± Redis å®ç°åˆ†å¸ƒå¼é”çš„å®‰å…¨æ€§é—®é¢˜è¿›è¡Œè¿‡æ·±å…¥çš„è®¨è®ºï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé—®é¢˜å°±æ¶‰åŠåˆ° GCã€‚ ç†Ÿæ‚‰ Java çš„åŒå­¦è‚¯å®šå¯¹ GC ä¸é™Œç”Ÿï¼Œåœ¨ GC çš„æ—¶å€™ä¼šå‘ç”Ÿ STW(Stop-The-World)ï¼Œè¿™æœ¬èº«æ˜¯ä¸ºäº†ä¿éšœåƒåœ¾å›æ”¶å™¨çš„æ­£å¸¸æ‰§è¡Œï¼Œä½†å¯èƒ½ä¼šå¼•å‘å¦‚ä¸‹çš„é—®é¢˜ï¼š æœåŠ¡ A è·å–äº†é”å¹¶è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯æœåŠ¡ A å‡ºç°äº† STW ä¸”æ—¶é—´è¾ƒé•¿ï¼Œå¯¼è‡´äº†åˆ†å¸ƒå¼é”è¿›è¡Œäº†è¶…æ—¶é‡Šæ”¾ï¼Œåœ¨è¿™ä¸ªæœŸé—´æœåŠ¡ B è·å–åˆ°äº†é”ï¼Œå¾…æœåŠ¡ A STW ç»“æŸä¹‹ååˆæ¢å¤äº†é”ï¼Œè¿™å°±å¯¼è‡´äº† æœåŠ¡ A å’ŒæœåŠ¡ B åŒæ—¶è·å–åˆ°äº†é”ï¼Œè¿™ä¸ªæ—¶å€™åˆ†å¸ƒå¼é”å°±ä¸å®‰å…¨äº†ã€‚ ä¸ä»…ä»…å±€é™äº Redisï¼ŒZookeeper å’Œ MySQL æœ‰åŒæ ·çš„é—®é¢˜ã€‚ æƒ³åƒæ›´å¤šç“œçš„ç«¥é‹ï¼Œå¯ä»¥è®¿é—®ä¸‹åˆ—ç½‘ç«™çœ‹çœ‹ Redis ä¹‹çˆ¶ Antirez æ€ä¹ˆè¯´ï¼šhttp://antirez.com/news/101 redisæœ‰å“ªäº›æ•°æ®ç±»å‹åŠå…¶åº”ç”¨åœºæ™¯ 1. string ä»‹ç» ï¼šstring æ•°æ®ç»“æ„æ˜¯ç®€å•çš„ key-value ç±»å‹ã€‚è™½ç„¶ Redis æ˜¯ç”¨ C è¯­è¨€å†™çš„ï¼Œä½†æ˜¯ Redis å¹¶æ²¡æœ‰ä½¿ç”¨ C çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆsimple dynamic stringï¼ŒSDSï¼‰ã€‚ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼ŒRedis çš„ SDS ä¸å…‰å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®è¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦ä¸º O(1)ï¼ˆC å­—ç¬¦ä¸²ä¸º O(N)ï¼‰,é™¤æ­¤ä¹‹å¤–,Redis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚ å¸¸ç”¨å‘½ä»¤: set,get,strlen,exists,dect,incr,setex ç­‰ç­‰ã€‚ åº”ç”¨åœºæ™¯ ï¼šä¸€èˆ¬å¸¸ç”¨åœ¨éœ€è¦è®¡æ•°çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ã€çƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ç­‰ç­‰ã€‚ æ™®é€šå­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼š 127.0.0.1:6379&gt; set key value #è®¾ç½® key-value ç±»å‹çš„å€¼ OK 127.0.0.1:6379&gt; get key # æ ¹æ® key è·å¾—å¯¹åº”çš„ value &quot;value&quot; 127.0.0.1:6379&gt; exists key # åˆ¤æ–­æŸä¸ª key æ˜¯å¦å­˜åœ¨ (integer) 1 127.0.0.1:6379&gt; strlen key # è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚ (integer) 5 127.0.0.1:6379&gt; del key # åˆ é™¤æŸä¸ª key å¯¹åº”çš„å€¼ (integer) 1 127.0.0.1:6379&gt; get key (nil)Copy to clipboardErrorCopied æ‰¹é‡è®¾ç½® : 127.0.0.1:6379&gt; mset key1 value1 key2 value2 # æ‰¹é‡è®¾ç½® key-value ç±»å‹çš„å€¼ OK 127.0.0.1:6379&gt; mget key1 key2 # æ‰¹é‡è·å–å¤šä¸ª key å¯¹åº”çš„ value 1) &quot;value1&quot; 2) &quot;value2&quot;Copy to clipboardErrorCopied è®¡æ•°å™¨ï¼ˆå­—ç¬¦ä¸²çš„å†…å®¹ä¸ºæ•´æ•°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼‰ï¼š 127.0.0.1:6379&gt; set number 1 OK 127.0.0.1:6379&gt; incr number # å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ (integer) 2 127.0.0.1:6379&gt; get number &quot;2&quot; 127.0.0.1:6379&gt; decr number # å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ (integer) 1 127.0.0.1:6379&gt; get number &quot;1&quot;Copy to clipboardErrorCopied è¿‡æœŸï¼š 127.0.0.1:6379&gt; expire key 60 # æ•°æ®åœ¨ 60s åè¿‡æœŸ (integer) 1 127.0.0.1:6379&gt; setex key 60 value # æ•°æ®åœ¨ 60s åè¿‡æœŸ (setex:[set] + [ex]pire) OK 127.0.0.1:6379&gt; ttl key # æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ (integer) 56Copy to clipboardErrorCopied 2. list ä»‹ç» ï¼šlist å³æ˜¯ é“¾è¡¨ã€‚é“¾è¡¨æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œç‰¹ç‚¹æ˜¯æ˜“äºæ•°æ®å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤å¹¶ä¸”ä¸”å¯ä»¥çµæ´»è°ƒæ•´é“¾è¡¨é•¿åº¦ï¼Œä½†æ˜¯é“¾è¡¨çš„éšæœºè®¿é—®å›°éš¾ã€‚è®¸å¤šé«˜çº§ç¼–ç¨‹è¯­è¨€éƒ½å†…ç½®äº†é“¾è¡¨çš„å®ç°æ¯”å¦‚ Java ä¸­çš„ LinkedListï¼Œä½†æ˜¯ C è¯­è¨€å¹¶æ²¡æœ‰å®ç°é“¾è¡¨ï¼Œæ‰€ä»¥ Redis å®ç°äº†è‡ªå·±çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚Redis çš„ list çš„å®ç°ä¸ºä¸€ä¸ª åŒå‘é“¾è¡¨ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚ å¸¸ç”¨å‘½ä»¤: rpush,lpop,lpush,rpop,lrangeã€llen ç­‰ã€‚ åº”ç”¨åœºæ™¯: å‘å¸ƒä¸è®¢é˜…æˆ–è€…è¯´æ¶ˆæ¯é˜Ÿåˆ—ã€æ…¢æŸ¥è¯¢ã€‚ ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ é€šè¿‡ rpush/lpop å®ç°é˜Ÿåˆ—ï¼š 127.0.0.1:6379&gt; rpush myList value1 # å‘ list çš„å¤´éƒ¨ï¼ˆå³è¾¹ï¼‰æ·»åŠ å…ƒç´  (integer) 1 127.0.0.1:6379&gt; rpush myList value2 value3 # å‘listçš„å¤´éƒ¨ï¼ˆæœ€å³è¾¹ï¼‰æ·»åŠ å¤šä¸ªå…ƒç´  (integer) 3 127.0.0.1:6379&gt; lpop myList # å°† listçš„å°¾éƒ¨(æœ€å·¦è¾¹)å…ƒç´ å–å‡º &quot;value1&quot; 127.0.0.1:6379&gt; lrange myList 0 1 # æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡çš„liståˆ—è¡¨ï¼Œ 0 ä¸º start,1ä¸º end 1) &quot;value2&quot; 2) &quot;value3&quot; 127.0.0.1:6379&gt; lrange myList 0 -1 # æŸ¥çœ‹åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ-1è¡¨ç¤ºå€’æ•°ç¬¬ä¸€ 1) &quot;value2&quot; 2) &quot;value3&quot;Copy to clipboardErrorCopied é€šè¿‡ rpush/rpop å®ç°æ ˆï¼š 127.0.0.1:6379&gt; rpush myList2 value1 value2 value3 (integer) 3 127.0.0.1:6379&gt; rpop myList2 # å°† listçš„å¤´éƒ¨(æœ€å³è¾¹)å…ƒç´ å–å‡º &quot;value3&quot;Copy to clipboardErrorCopied æˆ‘ä¸“é—¨èŠ±äº†ä¸€ä¸ªå›¾æ–¹ä¾¿å°ä¼™ä¼´ä»¬æ¥ç†è§£ï¼š é€šè¿‡ lrange æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡èŒƒå›´çš„åˆ—è¡¨å…ƒç´ ï¼š 127.0.0.1:6379&gt; rpush myList value1 value2 value3 (integer) 3 127.0.0.1:6379&gt; lrange myList 0 1 # æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡çš„liståˆ—è¡¨ï¼Œ 0 ä¸º start,1ä¸º end 1) &quot;value1&quot; 2) &quot;value2&quot; 127.0.0.1:6379&gt; lrange myList 0 -1 # æŸ¥çœ‹åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ-1è¡¨ç¤ºå€’æ•°ç¬¬ä¸€ 1) &quot;value1&quot; 2) &quot;value2&quot; 3) &quot;value3&quot;Copy to clipboardErrorCopied é€šè¿‡ lrange å‘½ä»¤ï¼Œä½ å¯ä»¥åŸºäº list å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œæ€§èƒ½éå¸¸é«˜ï¼ é€šè¿‡ llen æŸ¥çœ‹é“¾è¡¨é•¿åº¦ï¼š 127.0.0.1:6379&gt; llen myList (integer) 3Copy to clipboardErrorCopied 3. hash ä»‹ç» ï¼šhash ç±»ä¼¼äº JDK1.8 å‰çš„ HashMapï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤š(æ•°ç»„ + é“¾è¡¨)ã€‚ä¸è¿‡ï¼ŒRedis çš„ hash åšäº†æ›´å¤šä¼˜åŒ–ã€‚å¦å¤–ï¼Œhash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä»…ä»…ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ hash æ•°æ®ç»“æ„æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰ç­‰ã€‚ å¸¸ç”¨å‘½ä»¤ï¼š hset,hmset,hexists,hget,hgetall,hkeys,hvals ç­‰ã€‚ åº”ç”¨åœºæ™¯: ç³»ç»Ÿä¸­å¯¹è±¡æ•°æ®çš„å­˜å‚¨ã€‚ ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ 127.0.0.1:6379&gt; hset userInfoKey name &quot;guide&quot; description &quot;dev&quot; age &quot;24&quot; OK 127.0.0.1:6379&gt; hexists userInfoKey name # æŸ¥çœ‹ key å¯¹åº”çš„ valueä¸­æŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚ (integer) 1 127.0.0.1:6379&gt; hget userInfoKey name # è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ã€‚ &quot;guide&quot; 127.0.0.1:6379&gt; hget userInfoKey age &quot;24&quot; 127.0.0.1:6379&gt; hgetall userInfoKey # è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼ 1) &quot;name&quot; 2) &quot;guide&quot; 3) &quot;description&quot; 4) &quot;dev&quot; 5) &quot;age&quot; 6) &quot;24&quot; 127.0.0.1:6379&gt; hkeys userInfoKey # è·å– key åˆ—è¡¨ 1) &quot;name&quot; 2) &quot;description&quot; 3) &quot;age&quot; 127.0.0.1:6379&gt; hvals userInfoKey # è·å– value åˆ—è¡¨ 1) &quot;guide&quot; 2) &quot;dev&quot; 3) &quot;24&quot; 127.0.0.1:6379&gt; hset userInfoKey name &quot;GuideGeGe&quot; # ä¿®æ”¹æŸä¸ªå­—æ®µå¯¹åº”çš„å€¼ 127.0.0.1:6379&gt; hget userInfoKey name &quot;GuideGeGe&quot;Copy to clipboardErrorCopied 4. set ä»‹ç» ï¼š set ç±»ä¼¼äº Java ä¸­çš„ HashSet ã€‚Redis ä¸­çš„ set ç±»å‹æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚å¯ä»¥åŸºäº set è½»æ˜“å®ç°äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redis å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚ å¸¸ç”¨å‘½ä»¤ï¼š sadd,spop,smembers,sismember,scard,sinterstore,sunion ç­‰ã€‚ åº”ç”¨åœºæ™¯: éœ€è¦å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤ä»¥åŠéœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†å’Œå¹¶é›†ç­‰åœºæ™¯ ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ 127.0.0.1:6379&gt; sadd mySet value1 value2 # æ·»åŠ å…ƒç´ è¿›å» (integer) 2 127.0.0.1:6379&gt; sadd mySet value1 # ä¸å…è®¸æœ‰é‡å¤å…ƒç´  (integer) 0 127.0.0.1:6379&gt; smembers mySet # æŸ¥çœ‹ set ä¸­æ‰€æœ‰çš„å…ƒç´  1) &quot;value1&quot; 2) &quot;value2&quot; 127.0.0.1:6379&gt; scard mySet # æŸ¥çœ‹ set çš„é•¿åº¦ (integer) 2 127.0.0.1:6379&gt; sismember mySet value1 # æ£€æŸ¥æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨set ä¸­ï¼Œåªèƒ½æ¥æ”¶å•ä¸ªå…ƒç´  (integer) 1 127.0.0.1:6379&gt; sadd mySet2 value2 value3 (integer) 2 127.0.0.1:6379&gt; sinterstore mySet3 mySet mySet2 # è·å– mySet å’Œ mySet2 çš„äº¤é›†å¹¶å­˜æ”¾åœ¨ mySet3 ä¸­ (integer) 1 127.0.0.1:6379&gt; smembers mySet3 1) &quot;value2&quot;Copy to clipboardErrorCopied 5. sorted set ä»‹ç»ï¼š å’Œ set ç›¸æ¯”ï¼Œsorted set å¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚æœ‰ç‚¹åƒæ˜¯ Java ä¸­ HashMap å’Œ TreeSet çš„ç»“åˆä½“ã€‚ å¸¸ç”¨å‘½ä»¤ï¼š zadd,zcard,zscore,zrange,zrevrange,zrem ç­‰ã€‚ åº”ç”¨åœºæ™¯ï¼š éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚æ¯”å¦‚åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œï¼‰ç­‰ä¿¡æ¯ã€‚ 127.0.0.1:6379&gt; zadd myZset 3.0 value1 # æ·»åŠ å…ƒç´ åˆ° sorted set ä¸­ 3.0 ä¸ºæƒé‡ (integer) 1 127.0.0.1:6379&gt; zadd myZset 2.0 value2 1.0 value3 # ä¸€æ¬¡æ·»åŠ å¤šä¸ªå…ƒç´  (integer) 2 127.0.0.1:6379&gt; zcard myZset # æŸ¥çœ‹ sorted set ä¸­çš„å…ƒç´ æ•°é‡ (integer) 3 127.0.0.1:6379&gt; zscore myZset value1 # æŸ¥çœ‹æŸä¸ª value çš„æƒé‡ &quot;3&quot; 127.0.0.1:6379&gt; zrange myZset 0 -1 # é¡ºåºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 -1 è¡¨ç¤ºè¾“å‡ºæ‰€æœ‰å…ƒç´  1) &quot;value3&quot; 2) &quot;value2&quot; 3) &quot;value1&quot; 127.0.0.1:6379&gt; zrange myZset 0 1 # é¡ºåºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 ä¸º start 1 ä¸º stop 1) &quot;value3&quot; 2) &quot;value2&quot; 127.0.0.1:6379&gt; zrevrange myZset 0 1 # é€†åºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 ä¸º start 1 ä¸º stop 1) &quot;value1&quot; 2) &quot;value2&quot; redisé›†ç¾¤æ¶æ„ Redis ä¸»ä»å¤åˆ¶ åˆ° ç›®å‰ ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€å­¦ä¹ çš„ Redis éƒ½æ˜¯ å•æœºç‰ˆ çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸€æ—¦æˆ‘ä»¬æ‰€ä¾èµ–çš„ Redis æœåŠ¡å®•æœºäº†ï¼Œæˆ‘ä»¬çš„ä¸»æµç¨‹ä¹Ÿä¼šå—åˆ°ä¸€å®šçš„å½±å“ï¼Œè¿™å½“ç„¶æ˜¯æˆ‘ä»¬ä¸èƒ½å¤Ÿæ¥å—çš„ã€‚ æ‰€ä»¥ä¸€å¼€å§‹æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼šæä¸€å°å¤‡ç”¨æœºã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨å‡ºç°é—®é¢˜çš„æ—¶å€™åˆ‡æ¢åŠ¨æ€åœ°åˆ°å¦ä¸€å°å»ï¼š å¹¸è¿çš„æ˜¯ï¼Œä¸¤ä¸ªèŠ‚ç‚¹æ•°æ®çš„åŒæ­¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis çš„ ä¸»ä»åŒæ­¥ åŠŸèƒ½å¸®åŠ©åˆ°æˆ‘ä»¬ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæœ‰ä¸ªå¤‡ä»½ï¼Œå¿ƒé‡Œå°±è¸å®å¤šäº†ã€‚ Redis å“¨å…µ åæ¥å› ä¸ºæŸç§ç¥ç§˜åŠ›é‡ï¼ŒRedis è€ä¼šåœ¨è«åå…¶å¦™çš„æ—¶é—´ç‚¹å‡ºé—®é¢˜ (æ¯”å¦‚åŠå¤œ 2 ç‚¹)ï¼Œæˆ‘æ€»ä¸èƒ½ 24 å°æ—¶æ—¶åˆ»å®ˆåœ¨ç”µè„‘æ—è¾¹åˆ‡æ¢èŠ‚ç‚¹å§ï¼Œäºæ˜¯å¦ä¸€ä¸ªæƒ³æ³•åˆå¼€å§‹äº†ï¼šç»™æ‰€æœ‰çš„èŠ‚ç‚¹æ‰¾ä¸€ä¸ª &quot;ç®¡å®¶&quot;ï¼Œè‡ªåŠ¨å¸®æˆ‘ç›‘å¬ç…§é¡¾èŠ‚ç‚¹çš„çŠ¶æ€å¹¶åˆ‡æ¢ï¼š è¿™å¤§æ¦‚å°±æ˜¯ Redis å“¨å…µ (Sentinel) çš„ç®€å•ç†è§£å•¦ã€‚ä»€ä¹ˆï¼Ÿç®¡å®¶å®•æœºäº†æ€ä¹ˆåŠï¼Ÿç›¸è¾ƒäºæœ‰å¤§é‡è¯·æ±‚çš„ Redis æœåŠ¡æ¥è¯´ï¼Œç®¡å®¶å®•æœºçš„æ¦‚ç‡å°±è¦å°å¾—å¤šå•¦.. å¦‚æœçœŸçš„å®•æœºäº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åˆ‡æ¢æˆå½“å‰å¯ç”¨çš„èŠ‚ç‚¹ä¿è¯å¯ç”¨. Redis é›†ç¾¤åŒ– å¥½äº†ï¼Œé€šè¿‡ä¸Šé¢çš„ä¸€äº›è§£å†³æ–¹æ¡ˆæˆ‘ä»¬å¯¹ Redis çš„ ç¨³å®šæ€§ ç¨å¾®æœ‰äº†ä¸€äº›åº•æ°”äº†ï¼Œä½†å•å°èŠ‚ç‚¹çš„è®¡ç®—èƒ½åŠ›å§‹ç»ˆæœ‰é™ï¼Œæ‰€è°“äººå¤šåŠ›é‡å¤§ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ å¤šä¸ªèŠ‚ç‚¹ç»„åˆ æˆ ä¸€ä¸ªå¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹ï¼Œé‚£å°±å¤§å¤§å¢åŠ äº† Redis çš„ é«˜å¯ç”¨ã€å¯æ‰©å±•ã€åˆ†å¸ƒå¼ã€å®¹é”™ ç­‰ç‰¹æ€§ï¼š ä¸Šå›¾ å±•ç¤ºäº† Redis Cluster å…¸å‹çš„æ¶æ„å›¾ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ª Redis èŠ‚ç‚¹éƒ½ äº’ç›¸ä¸¤ä¸¤ç›¸è¿ï¼Œå®¢æˆ·ç«¯ä»»æ„ ç›´è¿ åˆ°é›†ç¾¤ä¸­çš„ ä»»æ„ä¸€å°ï¼Œå°±å¯ä»¥å¯¹å…¶ä»– Redis èŠ‚ç‚¹è¿›è¡Œ è¯»å†™ çš„æ“ä½œã€‚ redisæ•°æ®ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ Redis äº”ç§åŸºæœ¬æ•°æ®ç»“æ„ redisä¸ºä»€ä¹ˆå¿«ï¼Œè¯´ä¸€ä¸‹ioå¤šè·¯å¤ç”¨åŠ å¤§ä½“ä¸Šæ¥è¯´ï¼ŒRedis 6.0 ä¹‹å‰ä¸»è¦è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ã€‚ é‚£ï¼ŒRedis6.0 ä¹‹å‰ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ æˆ‘è§‰å¾—ä¸»è¦åŸå› æœ‰ä¸‹é¢ 3 ä¸ªï¼š å•çº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ï¼› Redis çš„æ€§èƒ½ç“¶é¢ˆä¸å† CPU ï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œï¼› å¤šçº¿ç¨‹å°±ä¼šå­˜åœ¨æ­»é”ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰é—®é¢˜ï¼Œç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚ æ—¢ç„¶æ˜¯å•çº¿ç¨‹ï¼Œé‚£æ€ä¹ˆç›‘å¬å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥å‘¢ï¼Ÿ Redis é€šè¿‡IO å¤šè·¯å¤ç”¨ç¨‹åº æ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼ˆæˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ª socketï¼‰ï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶åŠç±»å‹(è¯»ã€å†™ï¼‰æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚ è¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š I/O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®© Redis ä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—ï¼ˆå’Œ NIO ä¸­çš„ Selector ç»„ä»¶å¾ˆåƒï¼‰ã€‚ å¦å¤–ï¼Œ Redis æœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†ä¸¤ç±»äº‹ä»¶ï¼š 1. æ–‡ä»¶äº‹ä»¶; 2. æ—¶é—´äº‹ä»¶ã€‚ æ—¶é—´äº‹ä»¶ä¸éœ€è¦å¤šèŠ±æ—¶é—´äº†è§£ï¼Œæˆ‘ä»¬æ¥è§¦æœ€å¤šçš„è¿˜æ˜¯ æ–‡ä»¶äº‹ä»¶ï¼ˆå®¢æˆ·ç«¯è¿›è¡Œè¯»å–å†™å…¥ç­‰æ“ä½œï¼Œæ¶‰åŠä¸€ç³»åˆ—ç½‘ç»œé€šä¿¡ï¼‰ã€‚ ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹æœ‰ä¸€æ®µè¯æ˜¯å¦‚æ˜¯ä»‹ç»æ–‡ä»¶äº‹ä»¶çš„ï¼Œæˆ‘è§‰å¾—å†™å¾—æŒºä¸é”™ã€‚ Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ® å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚ å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³ é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œè¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚ è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚ å¯ä»¥çœ‹å‡ºï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ä¸»è¦æ˜¯åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š å¤šä¸ª socketï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰ IO å¤šè·¯å¤ç”¨ç¨‹åºï¼ˆæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®ï¼‰ æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆå°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼‰ äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰ ","link":"https://ChicRingo.github.io/post/golang-mian-shi-ti/"}]}